sap.ui.define(["sap/m/Button","sap/m/Label","sap/m/Dialog","sap/m/Bar","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/VBox","sap/m/HBox","sap/m/CheckBox","sap/m/Link","sap/m/List","sap/m/CustomListItem","sap/m/TextArea","sap/m/Text","sap/m/StandardListItem","sap/m/Popover","sap/ui/layout/form/SimpleForm","sap/ui/layout/GridData","sap/ui/core/mvc/Controller","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms",'sap/ui/model/Filter',"sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/suite/ui/generic/template/AnalyticalListPage/controller/DatePickerController","sap/m/OverflowToolbarButton","sap/ui/model/json/JSONModel","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/ui/core/CustomData","sap/ui/Device","sap/m/library","sap/ui/core/library","sap/ui/model/FilterOperator","sap/m/DatePicker","sap/base/Log","sap/ui/core/InvisibleText","sap/base/util/deepEqual","sap/suite/ui/generic/template/js/StableIdHelper"],function(B,L,D,a,S,T,b,c,V,H,C,d,f,g,h,j,k,P,l,G,m,F,n,o,p,q,r,s,O,J,t,u,v,w,x,y,z,A,E,I,K,M){"use strict";var N=x.ListSeparators;var Q="_BASIC";var R="100%";var U=0.33;var W=0.5;var X=m.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController",{init:function(e){E.setLevel(E.Level.WARNING,"VisualFilter");this.oState=e;this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.bIsTimeBasedLine;this.bSortOrder;},_createForm:function(){this._searchTriggered=false;this._restoreTriggered=false;var e=new J();var i=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');this._initialFilters=this.oState.alr_visualFilterBar.getModel("_filter").getJSON();this.oConfig=JSON.parse(i.getJSON());e.setData(this.oConfig);this.filterCompList=[];this.filterChartList=[];this._buildFiltersFromConfig(true);var _=new J();_.setData(JSON.parse(this._initialFilters));this.oVerticalBox=new V();this.oVerticalBox.setModel(this.oState.oController.getView().getModel("_templPriv"),"_templPriv");this.oVerticalBox.setModel(this.oState.oController.getView().getModel());this.oVerticalBox.setModel(this.oState.oController.getView().getModel("i18n"),"i18n");this.oVerticalBox.setModel(_,"_dialogFilter");this.oVerticalBox.setModel(e,'_visualFilterDialogModel');this._addFilterSwitch();this._addGroupsAndFilters();return this.oVerticalBox;},_toggle:function(){var e=this.oState.oSmartFilterbar.getFilterDialogContent();if(e&&(e.length===2)){if(e[0].getVisible()){e[0].setVisible(false);e[1].setVisible(true);e[1].getItems()[0].getContent()[1].addCustomData(new v({key:'isToggle',value:true}));if(this.oState.alr_visualFilterBar.getLazyLoadVisualFilter()){this.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this,[true,true]);}}else{e[0].setVisible(true);e[1].setVisible(false);e[0].getToolbar().getContent()[1].addCustomData(new v({key:'isToggle',value:true}));}}},_addFilterSwitch:function(){var e=[new o({icon:"sap-icon://filter-fields",width:"inherit",key:"compact",tooltip:"{i18n>FILTER_COMPACT}"}),new o({icon:"sap-icon://filter-analytics",width:"inherit",key:"visual",tooltip:"{i18n>FILTER_VISUAL}"})];var i=new n({width:"inherit",selectedKey:"visual",items:e}).addEventDelegate({onAfterRendering:function(Z){if(Z.srcControl.getCustomData()[0]&&Z.srcControl.getCustomData()[0].getValue()){Z.srcControl.focus();Z.srcControl.removeAllCustomData();}}});i.attachSelect(function(Z){var $=Z.getSource();$.setSelectedKey("visual");this._toggle();}.bind(this));var Y=new t({design:x.ToolbarDesign.Transparent,content:[new b(),i]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogToolbar");this.oVerticalBox.addItem(Y);},_searchDialog:function(){this._searchTriggered=true;},_updateFilterBarFromDialog:function(){var e=this.oState.alr_visualFilterBar.getModel('_filter'),i=this.oVerticalBox.getModel('_dialogFilter'),Y=K(e.getJSON(),i.getJSON());if(!Y){e.setData(JSON.parse(i.getJSON()));}var Z=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),$=this._getDialogConfigModel(),_=K(Z.getJSON(),$.getJSON());if(!_){Z.setData(JSON.parse($.getJSON()));this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}if(this.oState.alr_visualFilterBar.getLazyLoadVisualFilter()){this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}},_closeDialog:function(){if(this._searchTriggered){this._updateFilterBarFromDialog();if(this._restoreTriggered){this._restoreTriggered=false;this.oState.filterBarController._afterSFBVariantLoad();}}this.oVerticalBox.destroyItems();},_restoreDialog:function(){var e=this.oState.alr_visualFilterBar._oCurrentVariant.config;if(e){this.oConfig.filterCompList.forEach(function(i){if(e[i.component.properties.parentProperty]){jQuery.extend(true,i,e[i.component.properties.parentProperty]);}});}else{this.oConfig=this.oState.alr_visualFilterBar._getStandardVariantConfig();}this._getDialogConfigModel().setData(this.oConfig);this._reloadForm();this._restoreTriggered=true;},_buildFiltersFromConfig:function(e){var i;this.filterCompList=[];this.filterChartList=[];for(i=0;i<this.oConfig.filterCompList.length;i++){var Y=this.oConfig.filterCompList[i].component.properties.sortOrder;if(Y.constructor===Object&&Y.value){this.oConfig.filterCompList[i].component.properties.sortOrder=Y.value;}this.filterCompList.push({obj:{shownInFilterBar:this.oConfig.filterCompList[i].shownInFilterBar,shownInFilterDialog:this.oConfig.filterCompList[i].shownInFilterDialog,cellHeight:this.oConfig.filterCompList[i].cellHeight,component:{type:this.oConfig.filterCompList[i].component.type,cellHeight:this.oConfig.filterCompList[i].component.cellHeight},group:{label:this.oConfig.filterCompList[i].group.label,name:this.oConfig.filterCompList[i].group.name}},searchVisible:e===true||this.oConfig.filterCompList[i].searchVisible===undefined||this.oConfig.filterCompList[i].searchVisible});}},_rebuildConfig:function(){var i;var e={filterCompList:[]};for(i=0;i<this.filterCompList.length;i++){e.filterCompList.push({shownInFilterBar:this.filterCompList[i].obj.shownInFilterBar&&this.filterCompList[i].obj.shownInFilterDialog,shownInFilterDialog:this.filterCompList[i].obj.shownInFilterDialog,cellHeight:this.filterCompList[i].obj.cellHeight,group:{label:this.filterCompList[i].obj.group.label,name:this.filterCompList[i].obj.group.name},component:{type:this.filterCompList[i].obj.component.type,cellHeight:this.filterCompList[i].obj.component.cellHeight,properties:{scaleFactor:this.filterChartList[i].getScaleFactor(),numberOfFractionalDigits:this.filterChartList[i].getNumberOfFractionalDigits(),sortOrder:this.filterChartList[i].getSortOrder(),filterRestriction:this.oConfig.filterCompList[i].component.properties.filterRestriction,entitySet:this.filterChartList[i].getEntitySet(),isDropDown:this.oConfig.filterCompList[i].component.properties.isDropDown,width:this.oConfig.filterCompList[i].component.properties.width,height:this.oConfig.filterCompList[i].component.properties.height,dimensionField:this.filterChartList[i].getDimensionField(),dimensionFieldDisplay:this.filterChartList[i].getDimensionFieldDisplay(),dimensionFieldIsDateTime:this.filterChartList[i].getDimensionFieldIsDateTime(),dimensionFilter:this.filterChartList[i].getDimensionFilter(),unitField:this.filterChartList[i].getUnitField(),isCurrency:this.filterChartList[i].getIsCurrency(),isMandatory:this.oConfig.filterCompList[i].component.properties.isMandatory,measureField:this.filterChartList[i].getMeasureField(),outParameter:this.oConfig.filterCompList[i].component.properties.outParameter,inParameters:this.oConfig.filterCompList[i].component.properties.inParameters,parentProperty:this.oConfig.filterCompList[i].component.properties.parentProperty,chartQualifier:this.oConfig.filterCompList[i].component.properties.chartQualifier}}});}return e;},_reloadForm:function(){this.oVerticalBox.destroyItems();this._buildFiltersFromConfig();this._addFilterSwitch();this._addGroupsAndFilters();},_addGroupsAndFilters:function(){var i;var e;var Y;var Z=[];var $=0;for(i=0;i<this.filterCompList.length;i++){if(!Array.isArray(this.filterCompList[i])){if(this.filterCompList[i].searchVisible===false){continue;}if(!(Z.indexOf(this.filterCompList[i].obj.group.name)>-1)){if(Y){this.oVerticalBox.addItem(Y);}e=this.filterCompList[i].obj.group.name;Z.push(e);Y=new f({showSeparators:"None",showNoData:false});Y.setWidth("100%");Y.setLayoutData(new G({span:"L12 M12 S12"}));Y.addStyleClass("sapUiSmallMarginTop");$++;this._addGroupToolbar(Y,this.filterCompList[i].obj.group.label,this.filterCompList[i].obj.group.name);}if(this.filterCompList[i].obj.shownInFilterDialog){this.filterCompList[i].toolbar=this._addChartCustomToolbar(this.oConfig.filterCompList[i],i);this.filterCompList[i].overlay=this._addChartOverlay(this.oConfig.filterCompList[i],i);var _=this,a1=new V(),b1=this.oConfig.filterCompList[i].component.properties.parentProperty;a1.setModel(this._getDialogConfigModel(),'_visualFilterDialogModel');a1.bindAggregation('items',{path:"_visualFilterDialogModel>/filterCompList",factory:function(c1,i1){var j1=i1.getProperty('component/type'),k1=i1.getProperty('component/properties'),l1=i1.getPath().split("/")[2];this.filterChartList[l1]=this._addChart(j1,k1,l1);return this.filterChartList[l1];}.bind(this),filters:new q("component/properties/parentProperty",z.EQ,b1)});var c1="visualFilterDialogInvisibleText"+this.filterChartList[i].getParentProperty();var d1=new I({id:c1});var e1=this.filterChartList[i].getParentProperty().replace(/[^\w]/gi,'')+"checkBox";var f1=[new V({items:[_.filterCompList[i].toolbar,_.filterCompList[i].overlay,a1,d1]}).setWidth("100%").addStyleClass("sapUiSmallMarginEnd")];if(w.system.desktop){f1[0].setWidth("80%");f1.splice(1,0,new V({items:[new L({text:"{i18n>SHOW_ON_FILTER_BAR}",labelFor:e1,wrapping:true}).addStyleClass("sapUiTinyMarginTop"),new C({id:e1,text:"",selected:_.oConfig.filterCompList[i].shownInFilterBar}).data("idx",i).attachSelect(null,_._onCheckBoxSelect,_)]}).setAlignItems("Center"));f1[1].setWidth("20%");}var g1=new H({items:f1}).addStyleClass("sapUiSmallMarginTop").setWidth("100%");F._updateVisualFilterAria(g1.getItems()[0]);var h1=new g({id:M.getStableId({type:"VisualFilter",subType:"CustomListItem",sContainerType:"VisualFilterDialog",sParentProperty:_.filterChartList[i].getParentProperty()}),content:g1});h1.attachBrowserEvent("keyup",F.onKeyUpVisualFilter.bind(F));Y.addItem(h1);}}if(Y){this.oVerticalBox.addItem(Y);}}if($==1&&e===Q){F.executeFunction(Y,"mAggregations.headerToolbar.setVisible",[false]);}},_onCheckBoxSelect:function(e){var i=e.getSource().data("idx");this.selectCheckBox(i,e.getSource().getSelected());},_addGroupToolbar:function(e,i,Y){var Z=new c({text:i}).addStyleClass("sapSmartTemplatesAnalyticalListPageVFDialogGroupTitle");var $=new T({content:[Z,new b()]});if(Y!=Q){$.addContent(this._createMoreFiltersLink(Y,Z));}e.setHeaderToolbar($);},selectCheckBox:function(i,e){var Y=this._getDialogConfigModel();var Z=jQuery.extend(true,{},Y);Z.setProperty('/filterCompList/'+i+'/shownInFilterBar',e);Y.setData(Z.getData());this.oConfig=Y.getData();this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_addChartOverlay:function(e,i){var Y=new V({width:"100%",height:e.component.properties.height,items:[new L({text:{path:'_visualFilterDialogModel>/filterCompList/'+i+'/overlayMessage',formatter:function(Z){return this.getModel("i18n").getResourceBundle().getText(Z);}},wrapping:true,textAlign:y.TextAlign.Center})],visible:{path:'_visualFilterDialogModel>/filterCompList/'+i+'/showChartOverlay',formatter:function(Z){return Z;}}});Y.addStyleClass("sapUiOverlay");Y.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");return Y;},_formatTitle:function(e,i){var Y=this.oVerticalBox.getModel("i18n").getResourceBundle();var Z=e.titleMD;var $=e.titleUnitCurr;if(i==="tooltipMD"){return $==""?Z:Y.getText("VIS_FILTER_TITLE_MD_WITH_UNIT_CURR",[Z,$]);}else if(i==="titleUnitCurr"){return $.length>0?"| "+$:"";}},_addChartCustomToolbar:function(e,i){var Y=this;var Z=this.oState.oController.getView().getModel("@i18n");var $=e.component.properties.parentProperty,_=e.component.properties,a1=F.getPropertyNameDisplay(this.oState.alr_visualFilterBar.getModel(),e.component.properties.entitySet,e.component.properties.dimensionField,Z),b1=$.replace(/[^\w]/gi,''),c1=this.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(e.component.properties.entitySet),d1=e.component.properties.sortOrder[0].Descending.Boolean,e1=F.readProperty(e,"component.type")==="Line"&&F.readProperty(e,"component.properties.dimensionFieldIsDateTime"),f1=this.oState.alr_visualFilterBar._resolveChartType(e.component.type),g1=this._getChartTypeIconLink(f1),rb=this.oVerticalBox.getModel("i18n").getResourceBundle(),i1=Y._getChartTitle(e,i),j1=new c({text:i1.titleMD,tooltip:this._formatTitle(i1,"tooltipMD"),titleStyle:y.TitleLevel.H6}),k1=new c({text:this._formatTitle(i1,"titleUnitCurr"),tooltip:"",titleStyle:y.TitleLevel.H6});if(this.oConfig.filterCompList[i].component.properties.isMandatory){j1.addStyleClass("sapMLabelRequired");}var l1=function(){var h1=this.oConfig.filterCompList[i].component.properties.entitySet,w1=this._getVisibleMeasureList(h1),x1=Object.keys(w1).length>1;if(!x1){E.warning("Change measure button has been disabled in the dialog as only one visible measure exists in the collection "+h1,"","VisualFilter");}return x1;};var m1=this.oState.oSmartFilterbar.getControlByKey(e.component.properties.parentProperty);this.oState.oSmartFilterbar.ensureLoadedValueHelp(e.component.properties.parentProperty);var n1=m1.getShowValueHelp&&m1.getShowValueHelp()&&!_.dimensionFieldIsDateTimeOffset,o1=m1 instanceof A,p1=m1.getMetadata().getName()==="sap.m.DateTimePicker",q1=(o1&&!p1)?"sap-icon://appointment-2":"",r1=(_.isDropDown)?"sap-icon://slim-arrow-down":"",s1=n1?"sap-icon://value-help":q1||r1,t1,u1=[new B({type:"Transparent",icon:"sap-icon://line-chart-time-axis",visible:false,press:function(h1){Y._showLineChartTimeAxisPopup(h1);}}).data("idx",i),new B({id:M.getStableId({type:"VisualFilter",subType:"F4Button",sContainerType:"VisualFilterDialog",sParentProperty:_.parentProperty}),type:"Transparent",icon:(n1||_.isDropDown||o1)?s1:"",customData:[new v({key:'isF4Enabled',value:(n1||_.isDropDown||o1)?true:false})],visible:{path:"_dialogFilter>/"+$,formatter:function(h1){if(n1||_.isDropDown||(o1&&!p1)){return true;}else{if(!h1){return false;}if(typeof h1==="object"){if(h1 instanceof Date){return true;}return(h1.value||(h1.items&&h1.items.length)||(h1.ranges&&h1.ranges.length))?true:false;}return true;}}},text:{path:"_dialogFilter>/"+$,formatter:function(h1){var w1=Y.filterChartList[i];var x1=w1.getFilterRestriction();t1=0;if(h1){if(x1==='single'){t1=1;}else{if(typeof h1==="object"){if(h1.value){t1++;}if(h1.items){t1+=h1.items.length;}if(h1.ranges){t1+=h1.ranges.length;}}else{t1++;}}}return t1?"("+t1+")":"";}},enabled:{path:'_visualFilterDialogModel>/filterCompList/'+i+'/showChartOverlay',formatter:function(h1){return!h1;}},press:function(h1){if(n1){m1.fireValueHelpRequest.call(m1);}else if(_.isDropDown){var w1=Y.oState.alr_visualFilterBar._isDimensionFieldFilterable(this.getModel(),_.entitySet,_.dimensionField),x1=this.getModel("visualFilter")||this.getModel();r.createDropdown(h1.getSource(),Y.filterChartList[h1.getSource().data("idx")],x1,a1,_,w1);}else if(o1&&!p1){s._createDatePicker(h1.getSource(),Y.filterChartList[h1.getSource().data("idx")]);}else{sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup(h1.getSource(),Y.filterChartList[h1.getSource().data("idx")],h1.getSource().getModel('i18n'));}},tooltip:{path:"_dialogFilter>/"+$,formatter:function(){return F.getTooltipForValueHelp(n1,a1,rb,t1,o1);}},layoutData:new u({priority:x.OverflowToolbarPriority.NeverOverflow})}).data("idx",i),new O({type:"Transparent",icon:(d1?"sap-icon://sort-descending":"sap-icon://sort-ascending"),visible:!e1,tooltip:"{i18n>VISUAL_FILTER_SORT_ORDER}",text:"{i18n>VISUAL_FILTER_SORT_ORDER}",press:function(h1){Y._showChartSortPopup(h1);},layoutData:new u({closeOverflowOnInteraction:false,priority:(!w.system.desktop)?x.OverflowToolbarPriority.AlwaysOverflow:x.OverflowToolbarPriority.High})}).data("idx",i),new O({type:"Transparent",icon:g1,tooltip:"{i18n>VISUAL_FILTER_CHART_TYPE}",text:"{i18n>VISUAL_FILTER_CHART_TYPE}",press:function(h1){Y._showChartTypesPopup(h1);},layoutData:new u({closeOverflowOnInteraction:false,priority:(!w.system.desktop)?x.OverflowToolbarPriority.AlwaysOverflow:x.OverflowToolbarPriority.High})}).data("idx",i),new O({id:"template::VisualFilterDialog::MeasureChangeButton::"+c1+"::"+b1,type:"Transparent",icon:"sap-icon://measure",tooltip:"{i18n>VISUAL_FILTER_MEASURE}",text:"{i18n>VISUAL_FILTER_MEASURE}",enabled:l1.apply(Y),press:function(h1){Y._showChartMeasuresPopup(h1);},layoutData:new u({closeOverflowOnInteraction:false,priority:(!w.system.desktop)?x.OverflowToolbarPriority.AlwaysOverflow:x.OverflowToolbarPriority.High})}).data("idx",i)];if((w.system.tablet||w.system.phone)&&!w.system.desktop){u1.splice(2,0,new C({tooltip:"{i18n>SHOW_ON_FILTER_BAR}",text:"{i18n>SHOW_ON_FILTER_BAR}",selected:Y.oConfig.filterCompList[i].shownInFilterBar,layoutData:new u({closeOverflowOnInteraction:false,priority:x.OverflowToolbarPriority.AlwaysOverflow})}).data("idx",i).attachSelect(null,Y._onCheckBoxSelect,Y));u1[2].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDShowInFilterBarCozy");}var v1=new t({design:x.ToolbarDesign.Transparent,content:[j1,k1,new b(),u1]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogTitleToolbar");v1.getContent()[0].addStyleClass("sapUiTinyMarginTop");v1.getContent()[0].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDialogChartTitle");v1.getContent()[1].addStyleClass("sapUiTinyMarginTop");v1.setWidth("100%");return v1;},_addChart:function(Y,Z,$){var _;var a1=this;var b1=Z.selectFilters&&Z.selectFilters.SelectOptions;var c1={selectFilters:Z.selectFilters,scaleFactor:Z.scaleFactor,numberOfFractionalDigits:Z.numberOfFractionalDigits,sortOrder:Z.sortOrder,filterRestriction:Z.filterRestriction,isDropDown:Z.isDropDown,width:R,height:Z.height,labelWidthPercent:U,entitySet:Z.entitySet,dimensionField:Z.dimensionField,dimensionFieldDisplay:Z.dimensionFieldDisplay,dimensionFieldIsDateTime:Z.dimensionFieldIsDateTime,dimensionFieldIsDateTimeOffset:Z.dimensionFieldIsDateTimeOffset,unitField:Z.unitField,isCurrency:Z.isCurrency,isMandatory:Z.isMandatory,measureField:Z.measureField,dimensionFilter:Z.dimensionFilter,outParameter:Z.outParameter,inParameters:Z.inParameters,parentProperty:Z.parentProperty,textArrangement:Z.textArrangement,chartQualifier:Z.chartQualifier,lazyLoadVisualFilter:this.oState.alr_visualFilterBar.getLazyLoadVisualFilter()};var d1="/filterCompList/"+$;if(Y==="Donut"){c1.labelWidthPercent=W;}Y=this.oState.alr_visualFilterBar._resolveChartType(Y);var _=this.oState.alr_visualFilterBar._createFilterItemOfType(Y,c1,false);_.data("isDialogFilterItem","true");_.setModel(this.oVerticalBox.getModel('_dialogFilter'),'_dialogFilter');_.setModel(this._getDialogConfigModel(),'_visualFilterDialogModel');_.data("idx",$);_.addCustomData(new v({key:'sPath',value:d1}));if(c1.dimensionFieldIsDateTime){_.addCustomData(new v({key:'stringdate',value:Z.stringdate}));}_.bindProperty('visible',{path:'_visualFilterDialogModel>/filterCompList/'+$+'/showChartOverlay',formatter:function(e){return!e;}});_.bindProperty('dimensionFilter',{path:'_dialogFilter>/'+_.getParentProperty()});var e1=_.getInParameters(),f1=[];if(e1&&e1.length>0){e1.forEach(function(e){f1.push({path:"_dialogFilter>/"+e.localDataProperty});});}if(a1.oState.alr_visualFilterBar.getEntitySet()===_.getEntitySet()){var g1=a1.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();if(g1&&g1.length>0){g1.forEach(function(e){if(!e.data("isCustomField")){f1.push({path:'_dialogFilter>/'+e.getName()});}});}}if(f1&&f1.length>0){_.bindProperty('dimensionFilterExternal',{parts:f1,formatter:function(){var e1=this.getInParameters(),j1=this.getParentProperty();var k1,l1;if(a1.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()){var g1=a1.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();g1.forEach(function(A1){var B1=A1.getName();var C1=e1&&e1.some(function(e){return e.localDataProperty===B1;});if(B1.indexOf("$Parameter")===-1&&!C1){e1.push({localDataProperty:B1,valueListProperty:B1});}});}if(!(a1.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()&&a1.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath()!=="")&&(a1.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath()===""||a1.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency")!=-1)){var m1=this.getMeasureField();var n1=a1.oState.alr_visualFilterBar.getModel();var o1=n1.getMetaModel();var p1=o1.getODataEntityType(a1.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var q1=o1.getODataEntitySet(this.getEntitySet());var r1=o1.getODataProperty(p1,m1);var s1=a1.oState.alr_visualFilterBar.getProperty("displayCurrency");var t1=r1&&r1[p.ISOCurrency];if(s1&&t1){var u1=t1.Path;for(var v1=(e1.length-1);v1>-1;v1--){var w1=e1[v1].valueListProperty;var x1=e1[v1].localDataProperty;if(w1===u1){var y1=a1.oState.alr_visualFilterBar._smartFilterContext.getFilterData();if(!y1[x1]){l1=o1.getODataProperty(p1,u1);var z1=l1&&F.isPropertyNonFilterable(q1,l1.name);if(!z1){k1=new q({aFilters:[new q({path:u1,operator:"EQ",value1:s1,value2:undefined})],and:false});}}break;}}}}return a1.oState.alr_visualFilterBar._getFiltersForFilterItem(e1,j1,k1,u1,b1);}});}else if(b1&&b1.length>0){var h1=new q({aFilters:[],bAnd:true});for(var i in b1){var i1=b1[i];h1=this.oState.alr_visualFilterBar.fnAddSelectOptionsToFilters(i1,h1);}_.setProperty('dimensionFilterExternal',h1);}_.attachBeforeRebindVisualFilter(function(e){var j1=e.getParameters();var k1=j1.sEntityType;var l1=j1.sDimension;var m1=j1.sMeasure;var n1=j1.oContext;var o1=a1.oState.oController;o1.onBeforeRebindVisualFilterExtension(k1,l1,m1,n1);});_._updateBinding();_._bAllowBindingUpdateOnPropertyChange=true;_.attachFilterChange(function(e){a1.oState.alr_visualFilterBar.fireFilterChange();});_.attachTitleChange(function(e){var $=e.getSource().data("idx");if(a1.filterCompList[$].toolbar.getContent().length>0){if(c1.isMandatory){a1.filterCompList[$].toolbar.getContent()[0].addStyleClass("sapMLabelRequired");}var j1=a1.filterCompList[$].toolbar.getContent()[0];var k1=a1.filterCompList[$].toolbar.getContent()[1];var l1=a1._getChartTitle(a1.filterCompList[$].obj,$);j1.setText(l1.titleMD);var m1=a1._formatTitle(l1,"tooltipMD");j1.setTooltip(m1);k1.setText(a1._formatTitle(l1,"titleUnitCurr"));var n1=l1.titleUnitCurr.split(" ");if(l1.titleUnitCurr==""){k1.setVisible(false);}else{k1.setVisible(true);var o1=n1.length>1?"4.15rem":"2.4rem";k1.setWidth(o1);}}if(a1.filterChartList[$].data("needsToUpdateAria")==="true"){F._updateVisualFilterAria(a1.filterChartList[$].getParent().getParent());}});return _;},_createMoreFiltersLink:function(e,Y){var Z=this;var $=0;var i;var _=new d();for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].searchVisible&&this.filterCompList[i].obj.group.name===e&&!this.filterCompList[i].obj.shownInFilterDialog){$++;}}if($>0){_.setText(this.oRb.getText("FILTER_BAR_SHOW_MORE_FILTERS",[$]));}else{_.setText(this.oRb.getText("FILTER_BAR_SHOW_CHANGE_FILTERS"));}_.attachPress(function(a1){Z._createAddRemoveFiltersDialog(e,_);});if(Y){_.addAriaLabelledBy(Y);}return _;},_showChartMeasuresPopup:function(e){var i=this;var Y=e.getSource().data("idx");var Z=this.filterChartList[Y].getProperty("entitySet");var $=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(e.getSource().getModel('i18n'),"VISUAL_FILTER_MEASURES");var _=e.getSource().getModel("@i18n");if(_){$.setModel(_,"@i18n");}var a1=new f({mode:x.ListMode.SingleSelectLeft,includeItemInSelection:true});a1.data("idx",Y);$.addContent(a1);var b1=this._getVisibleMeasureList(Z);a1.addStyleClass("sapUiSizeCompact");if(b1){for(var c1 in b1){var d1=new k({title:b1[c1].label?b1[c1].label:b1[c1].name,tooltip:(b1[c1].fieldInfo&&b1[c1].fieldInfo.quickInfo)||b1[c1].label||b1[c1].name}).data("measureName",b1[c1].name);a1.addItem(d1);if(this.filterChartList[Y].getMeasureField()===b1[c1].name){a1.setSelectedItem(d1);}}}a1.attachSelectionChange(function(e){var Y=e.getSource().data("idx"),e1=e.getSource().getSelectedItem().data("measureName");i.filterChartList[Y].setProperty("unitField",b1[e1].fieldInfo.unit);var f1=i.filterCompList[Y].toolbar.getContent()[0];var g1=i.filterCompList[Y].toolbar.getContent()[1];var h1=i._getChartTitle(i.filterCompList[Y].obj,Y);f1.setText(h1.titleMD);g1.setText(i._formatTitle(h1,"titleUnitCurr"));i.oConfig.filterCompList[Y].component.properties.measureField=e1;if(!i.filterChartList[Y]._chart.getPoints){var i1=jQuery.extend(true,[],i.filterChartList[Y].getSortOrder());i1[0].Field.String=e1;i.filterChartList[Y].setSortOrder(i1);i._updateVisualFilterConfigModel(Y,'/component/properties/sortOrder',i1);}var j1={bUpdateBinding:true,value:e1};i.filterChartList[Y].setMeasureField(j1);i._updateVisualFilterConfigModel(Y,'/component/properties/measureField',j1);i._updateVisualFilterConfigModel(Y,'/component/properties/measureField',e1);i._updateVisualFilterConfigModel(Y,'/component/properties/unitField',b1[e1].fieldInfo.unit);if($){$.close();}});$.attachAfterClose(function(){$.destroy();$=null;});$.openBy(e.getSource());},_showChartTypesPopup:function(e){var Y=this,Z=e.getSource(),$=Z.getModel('i18n'),_=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog($,"VISUAL_FILTER_CHART_TYPES"),a1=this.oState.alr_visualFilterBar._getSupportedFilterItemList(),b1=[];for(var i=0;i<a1.length;i++){var c1=a1[i];var d1=new k({title:"{i18n>"+c1.textKey+"}",icon:c1.iconLink,selected:Z.getIcon()===c1.iconLink}).data("type",c1.type);b1.push(d1);}var e1=new f({mode:x.ListMode.SingleSelectMaster,items:b1});e1.data("button",Z);e1.addStyleClass("sapUiSizeCompact");e1.setModel($,"i18n");_.addContent(e1);e1.attachSelectionChange(function(e){var f1=e.getSource().data("button").data("idx"),g1=e.getSource().getSelectedItem().data("type"),h1=Y.filterChartList[f1],i1=h1.getDimensionField(),j1=h1.getMeasureField(),k1=h1.getDimensionFieldIsDateTime(),l1=F.readProperty(Y.oConfig,"filterCompList."+f1+".component.properties.sortOrder.0.Field.String"),m1=Y._getDialogConfigModel(),n1=m1.getProperty('/filterCompList/'),o1=jQuery.extend(true,{},n1[f1]),p1=F.readProperty(o1,"component.properties.sortOrder.0.Field.String");e.getSource().data("button").setIcon(Y._getChartTypeIconLink(g1));if(l1&&p1){if(g1==="Line"){Y.oConfig.filterCompList[f1].component.properties.sortOrder[0].Field.String=i1;o1.component.properties.sortOrder[0].Field.String=i1;if(k1){Y.bSortOrder=Y.oConfig.filterCompList[f1].component.properties.sortOrder[0].Descending.Boolean;Y.oConfig.filterCompList[f1].component.properties.sortOrder[0].Descending.Boolean=true;o1.component.properties.sortOrder[0].Descending.Boolean=true;Y.bIsTimeBasedLine=true;}}else{Y.oConfig.filterCompList[f1].component.properties.sortOrder[0].Field.String=j1;o1.component.properties.sortOrder[0].Field.String=j1;if(Y.bIsTimeBasedLine){Y.oConfig.filterCompList[f1].component.properties.sortOrder[0].Descending.Boolean=Y.bSortOrder;o1.component.properties.sortOrder[0].Descending.Boolean=Y.bSortOrder;Y.bIsTimeBasedLine=false;}}}o1.component.type=g1;m1.setProperty('/filterCompList/'+f1,o1);Y.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);Y.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(Y,[true,true]);if(_){_.close();}});_.attachAfterClose(function(){_.destroy();_=null;});_.openBy(e.getSource());},_showLineChartTimeAxisPopup:function(e){var i=e.getSource().data("idx");var Y=e.getSource();var Z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(e.getSource().getModel('i18n'),"VISUAL_FILTER_LINE_CHART_TIME_LINE");var $=new f({mode:x.ListMode.SingleSelectLeft,items:[new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_DAYS}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_MONTH}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_QUARTERS}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_YEARS}"}).data("idx",i)]});$.data("button",Y);$.addStyleClass("sapUiSizeCompact");Z.addContent($);$.attachSelectionChange(function(e){Z.close();});Z.attachAfterClose(function(){Z.destroy();Z=null;});Z.openBy(e.getSource());},_showChartSortPopup:function(e){var i=this;var Y=e.getSource().data("idx");var Z=e.getSource();var $=e.getSource().getModel('i18n');var _=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog($,"VISUAL_FILTER_SORTING");var a1=new f({mode:x.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new k({title:$.getResourceBundle().getText("VISUAL_FILTER_SORTING_ASCENDING")}).data("idx",Y),new k({title:$.getResourceBundle().getText("VISUAL_FILTER_SORTING_DESCENDING")}).data("idx",Y)]});a1.data("button",Z);a1.addStyleClass("sapUiSizeCompact");if(this.filterChartList[Y].getSortOrder()[0].Descending.Boolean){a1.setSelectedItem(a1.getItems()[1],true);}else{a1.setSelectedItem(a1.getItems()[0],true);}_.addContent(a1);a1.attachSelectionChange(function(e){var Z=e.getSource().data("button");var Y=Z.data("idx");var b1=jQuery.extend(true,[],i.filterChartList[Y].getSortOrder());b1[0].Descending.Boolean=e.getSource().getItems()[1].isSelected();if(b1[0].Descending.Boolean){Z.setIcon("sap-icon://sort-descending");}else{Z.setIcon("sap-icon://sort-ascending");}var c1={bUpdateBinding:true,value:b1};i.filterChartList[Y].setSortOrder(c1);i._updateVisualFilterConfigModel(Y,'/component/properties/sortOrder',c1);i._updateVisualFilterConfigModel(Y,'/component/properties/sortOrder',b1);if(_){_.close();}});_.attachAfterClose(function(){_.destroy();_=null;});_.openBy(e.getSource());},_createAddRemoveFiltersDialog:function(e,Y){var i;var Z=this;var $=new D();$.setTitle(this.oRb.getText("SELECT_FILTER_FIELDS"));$.addStyleClass("sapUiPopupWithPadding");$.addStyleClass("sapUiCompAddRemoveFilterDialog");$.addStyleClass("sapUiSizeCompact");$.setVerticalScrolling(true);var _=new a();var a1=new S({placeholder:this.oRb.getText("FILTER_BAR_SEARCH")});this._oSearchField=a1;a1.attachLiveChange(function(f1){Z._onAddRemoveFiltersSearch(f1);});_.addContentRight(a1);$.setSubHeader(_);this.addRemoveList=new f({mode:x.ListMode.MultiSelect});this.addRemoveList.setShowSeparators(N.None);$.addContent(this.addRemoveList);for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].obj.group.name===e&&this.filterCompList[i].searchVisible){var b1=this._getChartTitle(this.filterCompList[i].obj,i,true);var c1=new k({title:b1.titleMD}).data("idx",i);this.addRemoveList.addItem(c1);if(this.filterCompList[i].obj.shownInFilterDialog){this.addRemoveList.setSelectedItem(c1,true);}}}this.addRemoveList.attachSelectionChange(function(f1){if(f1){var g1=f1.getParameters();if(g1){var c1=g1.listItem;var h1=c1.data("idx");if(c1){var i1={bVisible:g1.selected,propertyName:Z.oConfig.filterCompList[h1].component.properties.parentProperty};Z.oState.alr_visualFilterBar.fireFilterChange(i1);}}}});var d1=new B({text:this.oRb.getText("FORM_PERS_DIALOG_OK")});d1.attachPress(function(){var i;var f1=Z.addRemoveList.getItems();var g1=Z._getDialogConfigModel(),h1=jQuery.extend(true,{},g1);for(i=0;i<f1.length;i++){var i1=f1[i].data("idx");var j1=f1[i].isSelected();h1.setProperty('/filterCompList/'+i1+'/shownInFilterBar',j1);h1.setProperty('/filterCompList/'+i1+'/shownInFilterDialog',j1);}g1.setData(h1.getData());Z.oConfig=JSON.parse(g1.getJSON());Z.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this,[true,true]);Z.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);Z._reloadForm();$.close();});$.addAggregation("buttons",d1);$.setInitialFocus(this._oSearchField);$.setContentHeight("23.25rem");var e1=new B({text:this.oRb.getText("FORM_PERS_DIALOG_CANCEL"),press:function(){$.close();}});$.addAggregation("buttons",e1);$.attachAfterClose(function(){$.destroy();$=null;});$.open();},_onAddRemoveFiltersSearch:function(e){var i;if(!e){return;}var Y=e.getParameters();if(!Y){return;}var Z=(Y.newValue?Y.newValue:"").toLowerCase();var $=this.addRemoveList.getItems();for(i=0;i<$.length;i++){var _=($[i].getTitle()).toLowerCase();$[i].setVisible(_.indexOf(Z)>=0);}},_getChartTypeIconLink:function(i){var e=this.oState.alr_visualFilterBar._getSupportedFilterItemMap();var Y=e[i];return!Y?"":Y.iconLink;},_getChartTitle:function(e,i,Y){var Z=this.oState.oController.getView().getModel("@i18n");var $="";if(this.filterChartList[i]){if(Y){e.component.properties=this.filterChartList[i].getP13NConfig();$=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(e);}else{$=this.filterChartList[i].getTitle(Z);}}else{e.component.properties=this.oConfig.filterCompList[i].component.properties;$=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(e);}return $;},_adjustToolbarIcons:function(i){if(this.filterCompList[i].obj.component.type==="Line"){this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(true);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(false);}else{this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(false);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(true);}},_updateVisualFilterConfigModel:function(i,e,Y,Z){var $=this._getDialogConfigModel();$.setProperty('/filterCompList/'+i+e,Y);if(Z){var _=jQuery.extend(true,{},$.getProperty('/filterCompList/'+i));$.setProperty('/filterCompList/'+i,_);this.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this,[true,true]);}this.oConfig=$.getData();this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_getVisibleMeasureList:function(e){var i={},Y=this.oState.alr_visualFilterBar._getMeasureMap()[e];for(var Z in Y){var $=Y[Z];if(!($.fieldInfo[p.Hidden]&&$.fieldInfo[p.Hidden].Bool==="true")){i[$.name]=$;}}return i;},_triggerSearchInFilterDialog:function(e){var i;if(!e){return;}var Y=e.getParameters();if(!Y){return;}var Z=(Y.newValue?Y.newValue:"").toLowerCase();for(i=0;i<this.oConfig.filterCompList.length;i++){var $=this.oConfig.filterCompList[i].component.properties;var _=this._getChartTitle(this.oConfig.filterCompList[i],i).titleMD.toLowerCase();var a1=this._getLabelForDimensionsAndMeasures($,$.parentProperty),b1=this._getLabelForDimensionsAndMeasures($,$.measureField),c1=(a1.indexOf(Z)>=0)||(b1.indexOf(Z)>=0)||(_.indexOf(Z)>=0);this.oConfig.filterCompList[i].searchVisible=c1;}this._reloadForm();},_getDialogConfigModel:function(){return this.oVerticalBox.getModel('_visualFilterDialogModel');},_getLabelForDimensionsAndMeasures:function(e,i){var Y=this.oState.alr_visualFilterBar._oMetadataAnalyser,Z=this.oVerticalBox.getModel().getMetaModel(),$=Y.getEntityTypeNameFromEntitySetName(e.entitySet),_=Z.getODataEntityType($),a1=Z.getODataProperty(_,i)[p.Label];a1=a1&&a1.String?a1.String:"";return a1;}});sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog=function(i,e){if(this._oPopoverDialog){this._oPopoverDialog.destroy();}this._oPopoverDialog=new P();this._oPopoverDialog.setTitle(i.getResourceBundle().getText(e));this._oPopoverDialog.setPlacement(sap.m.PlacementType.PreferredBottomOrFlip);this._oPopoverDialog.addStyleClass("sapUiPopupWithPadding");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList=function(e,Y){var Z=new f({mode:x.ListMode.Delete}),$,_=e.getFilterRestriction();Z.data("chart",e);if(_==='multiple'){$=jQuery.extend(true,{},e.getDimensionFilter());var a1=($&&$.items)?$.items:undefined,b1=($&&$.ranges)?$.ranges:undefined,c1=($&&$.value)?$.value:null;$=jQuery.extend(true,{},e.getDimensionFilter());if(a1){for(var i=0;i<a1.length;i++){var d1=new k({title:a1[i].text?a1[i].text:a1[i].key});if(d1){d1.addCustomData(new v({key:'items',value:i}));}Z.addItem(d1);}}if(b1){for(var i=0;i<b1.length;i++){var d1=new k({title:b1[i].tokenText?b1[i].tokenText:F.createTitleFromCode(b1[i])});d1.addCustomData(new v({key:'ranges',value:i}));Z.addItem(d1);}}if(c1){var d1=new k({title:c1});d1.addCustomData(new v({key:'value'}));Z.addItem(d1);}}else{Z.addItem(new k({title:e.getDimensionFilter()}));}Z.attachDelete(function(e1){var f1=e1.getParameter("listItem"),g1=Z.data('chart'),h1;if(_==='single'){h1=null;}else{h1=jQuery.extend(true,{},g1.getDimensionFilter());var i1=f1.getCustomData()[0],j1=i1.getKey(),k1=h1[j1];if(j1!=='value'){var l1=i1.getValue();k1.splice(l1,1);}else{h1.value=null;}}Z.removeItem(f1);g1.setDimensionFilter(h1);g1.fireFilterChange();Y.removeContent(Z);var m1=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(g1,Y);if(m1.getItems().length>0){Y.addContent(m1);Y.focus();}else{Y.close();}});return Z;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup=function(e,i,Y){var Z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(Y,"VISUAL_FILTER_ALL_SELECTED_FILTERS"),$=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(i,Z);Z.addContent($);Z.addStyleClass("sapUiSizeCompact");Z.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");var _=new a();var a1=new B({text:Y.getResourceBundle().getText("CLEAR_FILTERS_ALL"),press:function(b1){var c1=$.data('chart'),d1=c1.getFilterRestriction(),e1;if(d1==='multiple'){e1=jQuery.extend(true,{},c1.getDimensionFilter());e1.items=[];e1.ranges=[];e1.value=null;}else{e1=null;}Z.removeContent($);c1.setDimensionFilter(e1);c1.fireFilterChange();Z.close();}});_.addContentRight(a1);Z.setFooter(_);Z.attachAfterClose(function(){Z.destroy();Z=null;});Z.openBy(e);};return X;});
