sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/js/AnnotationHelper"],function(A,C,a){"use strict";var D={},b="com.sap.vocabularies.UI.v1.DataPoint",c="com.sap.vocabularies.UI.v1.Chart",d="com.sap.vocabularies.UI.v1.DataFieldForAnnotation";D.ignoreAllProperties=function(m){var o=m.getMetadata().getAllProperties(),p={};for(var k in o){p[k]={ignore:true};}return p;};D.getButtonProperties=function(B){var p=D.ignoreAllProperties(B);var P={visible:{ignore:false}};return jQuery.extend(true,{},p,P);};D.getTableProperties=function(t){var p=D.ignoreAllProperties(t);var P={mode:{ignore:false},sticky:{ignore:false}};return jQuery.extend(true,{},p,P);};D.modifyDataPointForChart=function(t,e,n,f){var o={},O,N,s,q;var g=n.DataPointAnnotationPath&&n.DataPointAnnotationPath.AnnotationPath;if(g){q=g.split("#").reverse()[0];}else{if(n.Measure&&n.Measure.PropertyPath&&n.Measure.PropertyPath!==""){q=n.Measure.PropertyPath;}else{if(!n.DataPoint||jQuery.isEmptyObject(n.DataPoint)){return;}var i=0;for(var k in e){if(k.indexOf(b)===0){var q=k.split("#")[1];if(q.indexOf("Chart")>-1){var E=parseInt(q.split("Chart")[1],10);if(isNaN(E)){E=0;}i=Math.max(E,i);}}}i++;q="Chart"+i;}}s=b+"#"+q;O=e[s];if(O){N=jQuery.extend(true,{},O,n.DataPoint);}else{N=jQuery.extend(true,D.createNewDataPointForChart(),n.DataPoint);}if(!N.Value&&n.Measure&&n.Measure.PropertyPath&&n.Measure.PropertyPath!==""){N.Value={Path:n.Measure.PropertyPath};}n.DataPoint=N;o=A.createCustomAnnotationTermChange(t,N,O,s);f.push(o);return q;};D.createNewContact=function(){return{"RecordType":"com.sap.vocabularies.Communication.v1.ContactType"};};D.createNewAddress=function(){return{"RecordType":"com.sap.vocabularies.Communication.v1.AddressType"};};D.createNewChart=function(){var n={"ChartType":{"EnumMember":"com.sap.vocabularies.UI.v1.ChartType/Area"},"Measures":[{"PropertyPath":""}],"MeasureAttributes":[{"Measure":{"PropertyPath":""},"Role":{"EnumMember":"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1"},"RecordType":"com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"}],"RecordType":"com.sap.vocabularies.UI.v1.ChartDefinitionType"};return n;};D.createNewDataPointForChart=function(){return{"CriticalityCalculation":{"ImprovementDirection":{"EnumMember":"com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"},"RecordType":"com.sap.vocabularies.UI.v1.CriticalityCalculationType"},"RecordType":"com.sap.vocabularies.UI.v1.DataPointType"};};D._setP13nData=function(o,n){var p=o.data("p13nData");if(n.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){p.columnKey=n.Value&&n.Value.Path;}else{p.columnKey=a.createP13NColumnKey(n);}if(!p.columnKey){p.columnKey="";}if(n.Value&&n.Value.Path){p.leadingProperty=n.Value.Path;}else{p.leadingProperty="";}o.data("p13nData",p);};D.getChartFromColumn=function(o){var r=C.getLineItemRecordForColumn(o),e;if(r&&r.RecordType===d&&r.Target&&r.Target.AnnotationPath.indexOf("Chart")>=0){var q;if(r.Target.AnnotationPath.indexOf("#")!==-1){q=r.Target.AnnotationPath.split("#").reverse()[0];}var s=q?c+"#"+q:c,f=C.getEntityTypeFromAnnotationPath(o,r.Target.AnnotationPath);if(f){e={chartID:s,entityType:f};}}return e;};D.getChartFromFacet=function(e){var t=C.getTemplatingInfo(e);var T=t&&t.value;if(T){var E=C.getEntityTypeFromAnnotationPath(e,T);var q=T.search("#");var Q=T.substring(q+1);var s=Q?c+"#"+Q:c;var o={chartID:s,entityType:E};return o;}};D.getChartFromParent=function(e){var o;if(e&&e.getMetadata){if(e.getMetadata().getElementName()==="sap.m.Column"){o=D.getChartFromColumn(e);}else{o=D.getChartFromFacet(e);}}return o;};D.addSettingsHandler=function(t,p,e,s){return new Promise(function(r,f){var m=sap.ui.fl.Utils.getAppComponentForControl(t).getModel().getMetaModel();var E=m.getODataEntityContainer();var F=E.functionImport;var o={};var M=new sap.ui.model.json.JSONModel(F);var g=sap.ui.xmlfragment("sap.suite.ui.generic.template.changeHandler.customSelectDialog.SelectDialog",this);g.attachConfirm(function(l){var n=l.getParameter("selectedContexts");var q=[],u;for(var i=0;i<n.length;i++){u=E.namespace+"."+E.name+"/"+n[i].getObject().name;q[i]={selectorControl:t,changeSpecificData:{changeType:s,content:{newFunctionImport:u}}};}r(q);});g.attachSearch(function(l){var v=l.getParameter("value");var S=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var n=new sap.ui.model.Filter({filters:[S,o],and:true});var B=l.getSource().getBinding("items");B.filter(n);});g.setModel(M);var B=g.getBinding("items");var h=[];for(var i in e){var j=C.getCustomDataObject(e[i]);if(j&&j.Action){var k=j.Action.substring(j.Action.lastIndexOf("/")+1);h.push(new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,k));}}o=new sap.ui.model.Filter({filters:h,and:true});B.filter(o);g.addStyleClass(p.styleClass);g.open();});};D.getFacetIndexFromID=function(s,f){var I;for(var i=0;i<f.length;i++){I=f[i].ID&&f[i].ID.String;if(I===s){return i;}I=f[i].Target&&f[i].Target.AnnotationPath;I=I&&I.replace(/@/g,"").replace(/\//g,"::").replace(/#/g,"::");if(I===s){return i;}}};D.fixQualifierForAnnotationPath=function(e,t,B,i){var f=B,F,m=-1,I,q,p,o,s;if(e&&i>-1){for(var j=0;j<e.length;j++){if(j===i){continue;}q=-1;s=e[j].Target&&e[j].Target.AnnotationPath;if(s&&s.indexOf(t)!==-1){p=s.split("/");o=p[p.length-1].substr(1);if(!B&&o.indexOf("#")===-1){q=0;}else if(!B&&o.indexOf("#")>-1){q=o.split("#")[1];}else if(o.indexOf(B)>-1){q=o.split(B)[1];}I=parseInt(q,10);if(isNaN(I)){I=0;}m=Math.max(I,m);}}}if(m!==-1){m++;f=B?B+m.toString():m.toString();}F=f?t+"#"+f:t;return F;};return D;});
