sap.ui.define(['sap/ui/core/mvc/Controller','sap/ui/model/Filter','sap/ui/model/json/JSONModel',"sap/m/Button","sap/m/StandardListItem","sap/m/List","sap/m/ToolbarSpacer","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/ResponsivePopover","sap/m/Label","sap/m/ToggleButton","sap/m/SearchField","sap/m/Toolbar","sap/ui/core/Icon","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/library"],function(C,F,J,B,S,L,T,a,R,b,c,d,e,I,f,g,h){"use strict";var s=false,t={},o={},u="",D=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController",{});sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createDropdown=function(i,k,m,l,p,n){u=(p.filterRestriction=='multiple')?jQuery.extend(true,{items:[],ranges:[],value:null},k.getDimensionFilter()):k.getDimensionFilter();var q=i.getModel('i18n'),r=sap.ui.getCore().byId(k.getSmartFilterId()),v={"descriptionAndId":p.dimensionFieldDisplay,"descriptionOnly":p.dimensionFieldDisplay,"idAndDescription":p.dimensionField,"idOnly":p.dimensionField},v=(Object.keys(v).indexOf(p.textArrangement)!==-1)?v[p.textArrangement]:p.dimensionFieldDisplay,w=new c({icon:"sap-icon://menu",type:"Transparent",iconFirst:true,enabled:(u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u),tooltip:q.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED")}),x=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createStandardListItem(m,k,q,l,p,w,r,v),y=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createPopoverWithList(m,k,q,p,l,x,v,w,n,r),O=new B({text:q.getResourceBundle().getText("OK"),press:function(E){k.setDimensionFilter(u);k.fireFilterChange();y.close();},type:i.getModel("ui").getData().bEnableFiori3?"Emphasized":"Default"}),z=new B({text:q.getResourceBundle().getText("CANCEL"),press:function(){y.close();}});s=false;y.addContent(x);x.attachSelectionChange(function(E){var A=x.getModel().getData(E.mParameters.listItem.getBindingContext().sPath);A=A[p.dimensionField];var G=E.getParameters().listItem.mProperties.selected;if(p.filterRestriction==='multiple'){if(u.items&&u.items.length){for(var j=0;j<u.items.length;j++){if(u.items[j].key===A){u.items.splice(j,1);}else if(G){u.items.push({key:A});break;}}}else if(u.items){u.items.push({key:A});}else{u.items=[];}if(u.items.length){t.setVisible(true);o.setText(q.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[l,u.items.length]));}t.setVisible(Boolean(u.items.length));w.setEnabled(this.bUpdateToolbarButton||Boolean(u.items.length));}else if(p.filterRestriction==='single'){u=A;if(u){t.setVisible(true);o.setText(q.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[l,+Boolean(u)]));}w.setEnabled(Boolean(u));}}.bind(this));y.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");y.setBeginButton(O);y.setEndButton(z);y.openBy(i);};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createPopoverWithList=function(m,i,j,p,k,l,n,q,r,v){if(this._oPopoverDialog&&this._oPopoverDialog.isOpen){this._oPopoverDialog.close();}if(l){var A=function(E){if(E.getParameter("clearButtonPressed")){return;}var w=this.fnApplyFilterFromSearchField(n,E.getSource().getValue());var x=l.getBinding("items");s=false;q.setPressed(false);q.setTooltip(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));x.filter(w);}.bind(this);this.oSearchField=new d({liveChange:A,search:A,enabled:r,initialFocus:true});this._oPopoverDialog=new R('',{placement:h.PlacementType.Bottom,verticalScrolling:true,title:k,subHeader:[new e({content:[this.oSearchField,q]})],content:[l]});if(v.isDialogOpen()){this._oPopoverDialog.setModel(i.getModel("_dialogFilter"),"_dialogFilter");}else{this._oPopoverDialog.setModel(i.getModel("_filter"),"_filter");}}this._oPopoverDialog.setInitialFocus(this.oSearchField);this._oPopoverDialog.setContentWidth("320px");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createStandardListItem=function(m,i,j,k,p,l,n,q){var r="/"+p.entitySet,v=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.standardListItemTemplateCreation(i,p,n);o=new b({text:j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[k,typeof(i.getDimensionFilter())==="object"&&i.getDimensionFilter()!==null?i.getDimensionFilter().items.length:+Boolean(i.getDimensionFilter())])});t=new e({content:[o,new T(),new I({src:"sap-icon://sys-cancel",tooltip:j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_CLEAR_SELECTION"),decorative:false,press:function(E){t.setVisible(false);z.getParent().getDomRef().focus();s=false;l.setTooltip(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));l.setEnabled(false);l.setPressed(false);z.removeSelections(true);(u&&u.hasOwnProperty("items"))?u.items=[]:u="";o.setText(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[k,(u&&u.hasOwnProperty("items"))?u.items.length:+Boolean(u)]));z.getBinding("items").filter(this.fnApplyFilterFromSearchField(q,this.oSearchField.getValue()));}.bind(this)}).addStyleClass("sapSmartTemplatesAnalyticalListPageDropdownDialogCancelButton")],"visible":(u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u)});if(i.getSmartFilterId()){var w=sap.ui.getCore().byId(i.getSmartFilterId());if(w&&w.getEntitySet()===p.entitySet){r=i.considerAnalyticBinding(r,w);}}var x=a.getVisualFilterSelectFields(p.measureField,p.dimensionField,p.dimensionFieldDisplay),y=a.IsNavigationProperty(i.getModel(),p.entitySet,p.dimensionFieldDisplay)?p.dimensionFieldDisplay.split("/")[0]:null,U={select:x.join(",")};if(y){Object.assign(U,{"expand":y});}var z=new L({mode:p.filterRestriction==="single"?h.ListMode.SingleSelectMaster:h.ListMode.MultiSelect,growing:true,growingThreshold:15,showNoData:false,infoToolbar:t,items:{path:r,template:v,sorter:sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.getSortObject(p),parameters:U}});if(n.isDialogOpen()){v.setModel(i.getModel("_dialogFilter"),"_dialogFilter");}else{v.setModel(i.getModel("_filter"),"_filter");}z.setModel(m);l.attachPress(function(E){if(p.filterRestriction=="multiple"&&u.items.length||u&&u.hasOwnProperty('items')&&!u.items.length&&s){sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings(z,l,j,p.filterRestriction,p.dimensionField);}else if(p.filterRestriction=="single"&&u!=null||u==null&&s){sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings(z,l,j,p.filterRestriction,p.dimensionField);}});return z;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.selectedVisibilityUpdateFormatter=function(u,j){for(var i=0;i<u.items.length;i++){if(u.items[i].key===j){return true;}}return false;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.standardListItemTemplateCreation=function(j,p,k){var l=p.textArrangement,m=[];m.push({path:p.measureField});var n=k.isDialogOpen()?["_dialogFilter>/"+j.getParentProperty(),p.dimensionField]:["_filter>/"+j.getParentProperty(),p.dimensionField];p.unitField?m.push({path:p.unitField}):"";var q=new S({title:{parts:[p.dimensionFieldDisplay,p.dimensionField],formatter:function(i,r){return a.getTextArrangement(i,r,l);}},description:{parts:m,formatter:function(i,r){return sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroChart.prototype._getFormattedNumberWithUoM(i,r);}},selected:{parts:n,formatter:function(r,v){if(s){return true;}else{if(typeof(u)==="object"&&u!==null){for(var i=0;i<u.items.length;i++){if(u.items[i].key===v){return true;}}}else{return(u!==null&&u===v)?true:false;}}}}});return q;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.getSortObject=function(p){if(p.sortOrder&&p.sortOrder.length){return new f((p.sortOrder[0].Field)?p.sortOrder[0].Field.String:"",p.sortOrder[0].Descending.Boolean);}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings=function(l,j,k,m,n){var p=[];s=!s;this.bUpdateToolbarButton=s;if(s){j.setTooltip(k.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_ALL"));j.setEnabled(true);if(m==='multiple'){for(var i=0;i<u.items.length;i++){var q=new F(n,g.EQ,(m==="multiple")?u.items[i].key:u);p.push(q);}}else if(m==='single'){var q=new F(n,g.EQ,u);p.push(q);}l.getBinding("items").filter(p);}else{j.setTooltip(k.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));j.setEnabled((u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u));l.getBinding("items").filter(p);}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.fnApplyFilterFromSearchField=function(i,q){var j=[];if(q&&q.length>0){var k=new F(i,g.Contains,q);j.push(k);}return j;};return D;});
