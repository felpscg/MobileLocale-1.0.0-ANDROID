sap.ui.define(["sap/ui/base/Object","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/testableHelper"],function(B,M,a,F,b,c,t){"use strict";F=t.observableConstructor(F,true);var p=new F({path:"persistent",operator:b.EQ,value1:false});var s=new F({path:"technical",operator:b.EQ,value1:false});var v=new F({path:"validation",operator:b.EQ,value1:true});var I=new F({filters:[v,new F({path:"validation",operator:b.EQ,value1:false})],and:true});function g(T,h,d){var C=h.controller;var A=false;var m=C.byId("showMessages");var o;function e(i){return!!(i&&T.oCommonUtils.getPositionableControlId(i));}var f;var j=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.fragments.MessagePopover",{beforeOpen:function(){if(h.prepareAllMessagesForNavigation){var P=f.getCurrentContexts();for(var i=0;i<P.length;i++){var Q=P[i].getObject();if(!e(Q.controlIds)){h.prepareAllMessagesForNavigation();return;}}}},isPositionable:e,titlePressed:function(i){c.navigateFromMessageTitleEvent(T.oCommonUtils,i);}});j.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");f=j.getBinding("items");var E;(function(){var i=C.getOwnerComponent();E=new F({path:"target",operator:b.EQ,value1:"/"+i.getEntitySet()});var P=i.getModel("_templPriv");P.setProperty("/generic/messageCount",0);var Q=T.oCommonUtils.getText("MESSAGE_BUTTON_TOOLTIP_P",0);P.setProperty("/generic/messageButtonTooltip",Q);f.attachChange(function(){var U=f.getLength();P.setProperty("/generic/messageCount",U);Q=T.oCommonUtils.getText(U===1?"MESSAGE_BUTTON_TOOLTIP_S":"MESSAGE_BUTTON_TOOLTIP_P",U);P.setProperty("/generic/messageButtonTooltip",Q);});})();var l=new F({filters:[v,new F({path:"controlIds",test:function(i){return!!T.oCommonUtils.getPositionableControlId(i);},caseSensitive:true})],and:true});var k=[];var n;var q=0;var N;var r;var u;function w(P){if(Array.isArray(P)){var Q=false;for(var i=0;i<P.length;i++){Q=w(P[i])||Q;}return Q;}if(P instanceof Promise){P.then(N);return false;}u.push(P);return true;}function x(i){r=i;f.filter(r);}function y(){if(A){o=new F({filters:u,and:false});var P=[o,p];if(T.oServices.oApplication.needsToSuppressTechnicalStateMessages()){P.push(s);}var i=new F({filters:P,and:true});x(new F({filters:[i,l],and:false}));}}function R(i,P){if(i===q&&w(P)){y();}}function z(P){var i=P();return w(i);}function D(){k.forEach(z);}function G(i){n=i;q++;N=R.bind(null,q);u=d?[new F({path:"fullTarget",operator:b.StartsWith,value1:n}),E]:[];D();y();}function H(P){k.push(P);if(n!==undefined&&z(P)){y();}}var S;function J(){S=S||function(){if(f.getLength()>0){j.openBy(m);}};setTimeout(S,0);}function K(i){A=i;if(i){if(u){y();}}else{u=null;x(I);}}function L(i){return i?l:r;}function O(){return o;}return{adaptToContext:G,toggleMessagePopover:j.toggle.bind(j,m),showMessagePopover:J,registerMessageFilterProvider:H,setEnabled:K,getMessageFilters:L,getContextFilter:O};}return B.extend("sap.suite.ui.generic.template.lib.MessageButtonHelper",{constructor:function(T,h,i){Object.assign(this,(t.testableStatic(g,"MessageButtonHelper"))(T,h,i));}});});
