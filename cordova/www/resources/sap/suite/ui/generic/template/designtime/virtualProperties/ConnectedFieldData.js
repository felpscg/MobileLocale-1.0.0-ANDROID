sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/suite/ui/generic/template/designtime/virtualProperties/ColumnType","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/designtime/virtualProperties/ChartMeasures","sap/suite/ui/generic/template/designtime/utils/DesigntimeUtils"],function(A,C,a,b,D){"use strict";var c={},I="DataField",d="DataFieldForAction",e="DataFieldForIntentBasedNavigation",f="DataFieldWithNavigationPath",g="DataFieldForAnnotationContact",h="DataFieldForAnnotationChartWithDimensions",j="DataFieldForAnnotationRating",k="DataFieldForAnnotationProgress",U="com.sap.vocabularies.UI.v1.DataField",l="com.sap.vocabularies.UI.v1.DataPoint",m="com.sap.vocabularies.UI.v1.Chart",n="com.sap.vocabularies.Communication.v1.Contact",o="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath",p="com.sap.vocabularies.UI.v1.DataFieldForAnnotation",q="com.sap.vocabularies.UI.v1.DataFieldForAction",r="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation",s="com.sap.vocabularies.UI.v1.ChartType/Area",t="com.sap.vocabularies.UI.v1.ChartType/Donut",u="com.sap.vocabularies.UI.v1.ChartType/Bullet";c.getFieldGroupOfConnectedField=function(i){var R=a.getLineItemRecordForColumn(i),F;if(R&&R.RecordType===p&&R.Target&&R.Target.AnnotationPath.indexOf("FieldGroup")>=0){var v=R.Target.AnnotationPath,w=a.getEntityTypeFromAnnotationPath(i,v);if(w){v=v.substring(1);F={target:w.namespace+"."+w.name,fieldGroup:v,data:w[v]};}}return F;};c.fixQualifierForNewItem=function(i,T,v,B){var E=a.getODataEntityType(i),F,M,Q,w,x=-1;for(var K in E){if(K.indexOf("FieldGroup")!==-1){var y=E[K],z=y.Data;w=z.length+1;F=D.fixQualifierForAnnotationPath(z,T,B,w);Q=isNaN(parseInt(F.split("#")[1].substring(2),10))?0:parseInt(F.split("#")[1].substring(2),10);if(Q>x){x=Q;M=F;}}}return M;};c.createNewDataPointForItem=function(i,Q,T,v){var V="com.sap.vocabularies.UI.v1.VisualizationType/"+Q,L=c.getFieldGroupOfConnectedField(i).data.Data;var N={TargetValue:{String:T},Visualization:{EnumMember:V},RecordType:l+"Type",Title:{String:Q}};if(L[v]&&L[v].Value&&L[v].Value.Path&&(L[v].RecordType===U||L[v].RecordType===r)){N.Value={Path:L[v].Value.Path};}return N;};c.getItemType=function(E,i){var F=c.getFieldGroupOfConnectedField(E),v=F.data,w=[],x;if(v){w=JSON.parse(JSON.stringify(v.Data));}var y=w[i].RecordType;switch(y){case U:x=I;break;case q:x=d;break;case r:x=e;break;case o:x=f;break;case n:x=g;break;case p:var z=w[i].Target&&w[i].Target.AnnotationPath;if(z){if(z.indexOf(l)>=0){var B=a.getEntityTypeFromAnnotationPath(E,z);var Q=z.search("#");var G=z.substring(Q);var H=G?l+G:l;var J=B[H];if(J){if(J.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){x=j;}if(J.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Progress"){x=k;}}}else if(z.indexOf(n)>=0){x=g;}else if(z.indexOf(m)>=0){x=h;}}break;default:break;}return x;};c.setData=function(v,N,w){var x,y,z=[],F=c.getFieldGroupOfConnectedField(v),B=F.data;if(!B||jQuery.isEmptyObject(B)||!F||!N){return z;}var E=jQuery.extend(true,{},B),T=F.target;x=w.metadataPath.replace('vData/children/','');y=parseInt(x,10);if(w.propertyContent.propertyValue===undefined&&w.propertyContent.propertyName==="vData"){var G={RecordType:U};E.Data.push(G);}else if(w.propertyContent.propertyValue==="-1"){E.Data.splice(y,1);}else{var H;if(w.propertyContent.propertyName==="vItemType"){var R,J=w.propertyContent.propertyValue,K={};var L=w.metadataPath.match(/\d+/g).map(Number);var O=c.getItemType(v,L);if(J===O){return;}T=a.getEntityType(a.getComponent(v));switch(J){case I:R=U;break;case d:R=q;break;case e:R=r;break;case f:R=o;break;case h:H=c.fixQualifierForNewItem(v,m,w,"FE");var Q=H.split("#")[1];var M=Q?"#Chart"+Q:"#Chart";var P=D.createNewChart();K=A.createCustomAnnotationTermChange(T,P,{},H);z.push(K);var S=D.createNewDataPointForChart();K=A.createCustomAnnotationTermChange(T,S,{},l+M);z.push(K);R=p;break;case j:H=c.fixQualifierForNewItem(v,l,w,"FE");S=C.createNewDataPointForColumn(v,"Rating","4");K=A.createCustomAnnotationTermChange(T,S,{},H);z.push(K);R=p;break;case k:H=c.fixQualifierForNewItem(v,l,w,"FE");S=c.createNewDataPointForItem(v,"Progress","100",L);K=A.createCustomAnnotationTermChange(T,S,{},H);z.push(K);R=p;break;case g:H=c.fixQualifierForNewItem(v,n,w,"FE");var V=D.createNewContact();K=A.createCustomAnnotationTermChange(T,V,{},H);z.push(K);R=p;break;default:break;}if(!R){return;}var W=B.Data[L];var X=C.createNewColumn(R,W);switch(J){case k:X.Target={AnnotationPath:"@"+H};X.Criticality={Path:""};break;case j:case h:X.Target={AnnotationPath:"@"+H};break;case g:X.Target={AnnotationPath:"@"+H};if(!X.Label){X.Label={"String":"New Contact"};}break;default:break;}E.Data.splice(L,1,X);w.noRefreshOnChange=true;w.refreshPropertiesPane=true;K=A.createCustomAnnotationTermChange(T,E,B,F.fieldGroup);z.push(K);return z;}if(w.propertyContent.propertyName==="vChartType"){w.noRefreshOnChange=true;w.refreshPropertiesPane=true;var Y=[],Z={},$,_=w.newValue,a1=F.data;if(a1){Y=JSON.parse(JSON.stringify(a1.Data));}var b1=Y[y].Target&&Y[y].Target.AnnotationPath;var P;var c1=a.getEntityTypeFromAnnotationPath(v,b1);T=c1.namespace?c1.namespace+"."+c1.name:c1.name;if(b1.search("/")>=0){var d1=b1.search("/");var e1=b1.substring(d1);$=e1.substr(2);P=c1[$];}else{P=c1[b1.substr(1)];}Z.Description=P.Description;Z.Measures=P.Measures;Z.MeasureAttributes=P.MeasureAttributes;switch(_){case"Area":Z.ChartType={EnumMember:"com.sap.vocabularies.UI.v1.ChartType/Area"};Z.Dimensions=P&&P.Dimensions;break;case"Bullet":Z.ChartType={EnumMember:"com.sap.vocabularies.UI.v1.ChartType/Bullet"};break;case"Donut":Z.ChartType={EnumMember:"com.sap.vocabularies.UI.v1.ChartType/Donut"};break;default:return z;}K=A.createCustomAnnotationTermChange(T,Z,P,$);z.push(K);return z;}if(w.propertyContent.rootProperty&&w.propertyContent.rootProperty==="vData"){var f1=this._getMetadataPathParts(w),y=f1[0],g1=f1[1],h1={},i1=N.slice();for(var i=0;i<f1.length;i++){var j1=f1[i];i1=i1[j1];h1=i1;}if(g1==="DataPointRating"||g1==="DataPointProgress"){var b1=B.Data[y].Target&&B.Data[y].Target.AnnotationPath;var k1=a.getEntityTypeFromAnnotationPath(v,b1);var d1=b1.search("#");var e1=b1.substring(d1);var l1=e1?l+e1:l;var m1=k1[l1];var K=A.createCustomAnnotationTermChange(T,h1,m1,l1);z.push(K);return z;}else{if(w.propertyContent.propertyName==="Target"){var n1=w.propertyContent,o1="(New)";if(n1.propertyType!=="AnnotationPath"||(n1.valueTargetElement!==null&&n1.valueTargetElement.indexOf(o1)===-1)||!n1.refersTo){E=jQuery.extend(true,{},B);E.Data[y]=h1;w.refreshPropertiesPane=true;}else{var p1=sap.ui.getCore().byId(w.stableId);var b1=n1.propertyValue.replace(o1," "),q1=a.getEntityTypeFromAnnotationPath(p1,b1);if(!q1){n1.propertyValue=n1.propertyValue.replace(o1,"");return;}var r1=q1.namespace+'.'+q1.name,J=w.metadataPath;if(J.search("DataFieldForAnnotationRating")>=1||J.search("DataFieldForAnnotationProgress")>=1){H=c.fixQualifierForNewItem(v,l,w,"FE");}else if(J.search("DataFieldForAnnotationChart")>=1){H=c.fixQualifierForNewItem(v,m,w,"FE");}else{H=c.fixQualifierForNewItem(v,n,w,"FE");}var s1,t1,u1=F.data.Data[y],v1=u1&&u1.Target.AnnotationPath;if(v1.search("/")>0){s1=v1.substr(v1.search("/")+2);}else{s1=v1.substr(1);}t1=jQuery.extend(true,{},q1[s1]);var K=A.createCustomAnnotationTermChange(r1,t1,{},H);n1.valueTargetElement=H;n1.propertyValue=n1.propertyValue.replace(o1,"@"+H);w.refreshPropertiesPane=true;if(K){z.push(K);w.delayRefresh=false;}E=jQuery.extend(true,{},B);E.Data[y]=h1;h1.Target.AnnotationPath=n1.propertyValue;}}else{E=jQuery.extend(true,{},B);E.Data[y]=h1;}}}}var K=A.createCustomAnnotationTermChange(T,E,B,F.fieldGroup);z.push(K);return z;};c._getMetadataPathParts=function(v){var P=[];var w=v.metadataPath.split("/");if(w){for(var i=0;i<w.length;i++){var x=w[i];if(x==="vData"||x==="children"||x===v.propertyContent.propertyName){continue;}else{P.push(x);}}}return P;};c.getData=function(E){var v=[],w=[],V={},F=c.getFieldGroupOfConnectedField(E);if(!F){return w;}var x=F.data;if(x){v=JSON.parse(JSON.stringify(x.Data));}for(var i=0;i<v.length;i++){var R=v[i].RecordType;switch(R){case U:V={vItemType:{EnumMember:I},DataField:v[i]};break;case q:V={vItemType:{EnumMember:d},DataFieldForAction:v[i]};break;case r:V={vItemType:{EnumMember:e},DataFieldForIntentBasedNavigation:v[i]};break;case o:V={vItemType:{EnumMember:f},DataFieldWithNavigationPath:v[i]};break;case p:V={};var y=v[i].Target&&v[i].Target.AnnotationPath;if(y){if(y.indexOf(l)>=0){var z=a.getEntityTypeFromAnnotationPath(E,y);var Q=y.search("#");var B=y.substring(Q);var G=B?l+B:l;var H=jQuery.extend({},z[G]);if(H){if(H.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){V.vItemType={EnumMember:j};V.DataFieldForAnnotationRating=v[i];V.DataPointRating=H;}if(H.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Progress"){V.vItemType={EnumMember:k};V.DataFieldForAnnotationProgress=v[i];V.DataPointProgress=H;}}}else if(y.indexOf(n)>=0){var J=a.getEntityTypeFromAnnotationPath(E,y);var K=J[y.substr(1)];V.vItemType={EnumMember:g};V.DataFieldForAnnotationContact=v[i];V.Contact=K;}else if(y.indexOf(m)>=0){var M=b.getMeasures(E,i);var L;var N;var J=a.getEntityTypeFromAnnotationPath(E,y);if(y.search("/")>=0){var Q=y.search("/");var B=y.substring(Q);N=J[B.substr(2)];}else{N=J[y.substr(1)];}if(N.ChartType.EnumMember===s){L="Area";}else if(N.ChartType.EnumMember===t){L="Donut";}else if(N.ChartType.EnumMember===u){L="Bullet";}V.vItemType={EnumMember:h};V.vChartType={EnumMember:L};if(N.Dimensions){V.DataFieldForAnnotationChartWithDimensions=v[i];V.ChartWithDimensions=N;V.vDimensions={value:N.Dimensions};}else{V.DataFieldForAnnotationChartNoDimensions=v[i];V.ChartNoDimensions=N;}V.vMeasures={value:M};}}break;default:break;}w.push(V);}return w;};c.getPossibleValues=function(E){var v={vItemType:{displayName:"Field Type",virtual:true,type:"EnumType",whiteList:{properties:["vItemType"]},possibleValues:{DataField:{displayName:"Data Field"},DataFieldForAction:{displayName:"DataField For Action"},DataFieldForIntentBasedNavigation:{displayName:"Data Field For Intent Based Navigation"},DataFieldWithNavigationPath:{displayName:"Data Field With Navigation Path"},DataFieldForAnnotationContact:{displayName:"Contact"},DataFieldForAnnotationRating:{displayName:"Rating Indicator"},DataFieldForAnnotationProgress:{displayName:"Progress Indicator"},DataFieldForAnnotationChartWithDimensions:{displayName:"Chart"}}},vChartType:{displayName:"Chart Type",virtual:true,type:"EnumType",whiteList:{properties:["vChartType"]},possibleValues:{Area:{displayName:"Smart Area Micro Chart"},Bullet:{displayName:"Smart Bullet Micro Chart"},Donut:{displayName:"Smart Radial Micro Chart"}}},DataField:{displayName:"Data Field",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataField",type:"ComplexType",whiteList:{properties:["vItemType","Value","Label","Criticality","CriticalityRepresentation"],mandatory:["vItemType","Value"],expressionTypes:{Value:["Path"],Criticality:["Path"]}}},DataFieldForAction:{displayName:"Data Field For Action",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAction",type:"ComplexType",whiteList:{properties:["vItemType","Action","Label","Criticality","InvocationGrouping"],mandatory:["vItemType","Action"],expressionTypes:{Criticality:["Path"]}}},DataFieldForIntentBasedNavigation:{displayName:"Data Field For Intent Based Navigation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForIntentBasedNavigation",type:"ComplexType",whiteList:{properties:["vItemType","SemanticObject","Action","RequiresContext","Label"],mandatory:["vItemType","SemanticObject","RequiresContext"]}},DataFieldWithNavigationPath:{displayName:"Data Field With Navigation Path",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldWithNavigationPath",type:"ComplexType",whiteList:{properties:["vItemType","Target","Value","Label"],mandatory:["vItemType","Target","Value"]}},DataFieldForAnnotationContact:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label"],mandatory:["Target"]},refersTo:[{annotation:"Contact",referredBy:"Target"}]},Contact:{namespace:"com.sap.vocabularies.Communication.v1",annotation:"Contact",type:"ComplexType",whiteList:{properties:["fn","n","tel","email","photo","title","org","role"],expressionTypes:{fn:["Path"],photo:["Path"],title:["Path"],org:["Path"],role:["Path"]}},appliesTo:["vItemType"]},DataFieldForAnnotationRating:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},DataPointRating:{displayName:"Data Point",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",type:"ComplexType",whiteList:{properties:["Value","TargetValue"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"]}}},DataFieldForAnnotationProgress:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label","Criticality","DataPointProgress"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},DataPointProgress:{displayName:"Data Point",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",target:["EntityType"],type:"ComplexType",whiteList:{properties:["Value","TargetValue"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"]}}},DataFieldForAnnotationChartWithDimensions:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label","ChartWithDimensions"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},ChartWithDimensions:{displayName:"Chart",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",type:"ComplexType",whiteList:{properties:["Description","vDimensions","vMeasures"],mandatory:["vMeasures"]}},DataFieldForAnnotationChartNoDimensions:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label","ChartNoDimensions"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},ChartNoDimensions:{displayName:"Chart",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",target:["EntityType"],type:"ComplexType",whiteList:{properties:["Description","vMeasures"],mandatory:["vMeasures"]}},vDimensions:{displayName:"Dimensions",virtual:true,type:"Collection",nullable:false,visible:false,multiple:true,possibleValues:{},whiteList:{properties:["Dimensions"]}},vMeasures:{displayName:"Measures and Attributes",virtual:true,type:"Collection",nullable:false,visible:false,multiple:true,possibleValues:{Measure:{displayName:"Measure",type:"Edm.PropertyPath",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",nullable:false},Role:{displayName:"Role",type:"EnumType",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",possibleValues:{Axis1:{displayName:"Axis 1"},Axis2:{displayName:"Axis 2"},Axis3:{displayName:"Axis 3"}}},DataPointAnnotationPath:{displayName:"Data Point Reference",type:"Edm.AnnotationPath",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",nullable:false},DataPoint:{displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","ForecastValue","MinimumValue","MaximumValue","Criticality","CriticalityCalculation"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"],ForecastValue:["Path","String","Int","Decimal"],Criticality:["Path"]},CriticalityCalculation:{properties:["ImprovementDirection","DeviationRangeLowValue","DeviationRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue"]}}},DataPointDonut:{displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","Criticality","CriticalityCalculation"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"],Criticality:["Path"]},CriticalityCalculation:{properties:["ImprovementDirection","DeviationRangeLowValue","DeviationRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue"]}}},DataPointArea:{displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","CriticalityCalculation"],mandatory:["Value","TargetValue"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"]},CriticalityCalculation:{properties:["ImprovementDirection","DeviationRangeLowValue","DeviationRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue"]}}}},whiteList:{properties:["DataPoint","DataPointAnnnotationPath","Measure","Role"],mandatory:["Measure"]}}};return v;};return c;});
