sap.ui.define(["sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library"],function(B,F,f){"use strict";var L=f.LayoutType;var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return c[i]?i:d;}function g(i){return c[t(i)]+"ColumnPages";}function a(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function b(v){return m[t(v)];}function e(i){return c[t(i)];}function h(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function j(T){var i=h(T);var R=i?i[0]:false;return R;}function k(s){return(s&&(Array.isArray(s.FCLLayout)?s.FCLLayout.sort()[0]:s.FCLLayout))||"";}function l(o,n){var M=n.oTemplateContract.oAppComponent.getConfig();var p=M.settings.flexibleColumnLayout;var q=F.getInstanceFor(o,p);var u;var C;var s;var v=-1;var T=n.oTemplateContract;var w=sap.ui.Device.system.phone?1:(p.maxColumnsCount||3);var x=w>1&&p.initialColumnsCount===2;var D=(function(){var i=q.getDefaultLayouts();return[x?i.defaultTwoColumnLayoutType:i.defaultLayoutType,i.defaultTwoColumnLayoutType,i.defaultThreeColumnLayoutType];})();var y=p.displayNextObjectAfterDelete===true;function z(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&x);}function A(i){if(i.fCLLevel===3||(i.fCLLevel===0&&i.level>0)){return 1;}var u1=p.initialColumnsCount||1;var v1=Math.max(i.fCLLevel+1,u1);return sap.ui.Device.system.tablet&&v1>2?2:v1;}function E(i,u1,v1,w1){var x1=A(w1);i.showBeginColumn=w1.fCLLevel===0||x1>1;i.showMidColumn=w1.fCLLevel===1||x1>1;i.showEndColumn=w1.fCLLevel>1;if(x1===1){i.target=u1;}else if(w1.level===0){i.target=[u1,i.pages[0].entitySet];}else{i.target=v1.concat([u1]);}return g(w1.fCLLevel);}function G(i,u1){if(i===L.OneColumn&&x){return false;}var v1=u1&&T.mRoutingTree[u1];var w1=v1&&v1.defaultLayoutType;if(w1){return i===w1;}return i===D[0]||i===D[1]||i===D[2];}function H(i,u1,v1){var w1=T.mRouteToTemplateComponentPromise[v1];if(w1){return w1.then(function(x1){return n.activateOneComponent(u1,i,x1);});}return r;}function I(){var i=n.getCurrentIdentity();if(!i){return null;}var u1={};var v1=true;for(var w1=i.treeNode;v1;w1=T.mRoutingTree[w1.parentRoute]){var x1=w1.fCLLevel;var y1=e(x1);u1[y1]={route:w1.sRouteName,path:n.determinePathForKeys(w1,i.keys)||"",isVisible:x1>2||u.columnsVisibility[y1+"Column"]};v1=x1===1||x1===2;}return u1;}function J(i,u1){var v1=I();if(!v1){return Promise.resolve();}var w1=[];u1=u1||v1;for(var x1 in u1){var y1=v1[x1];if(y1.isVisible){w1.push(H(i,y1.path,y1.route));}else{var z1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var A1=T.mRoutingTree[y1.route];var B1=(z1===A1.level)?2:(3+U(C));n.setVisibilityOfRoute(y1.route,B1);}}return Promise.all(w1).then(n.afterActivation);}function K(i){var u1=n.getActivationInfo();J(u1,i);}function N(){return!(u.columnsVisibility.beginColumn?u.columnsVisibility.midColumn:u.columnsVisibility.midColumn&&u.columnsVisibility.endColumn);}function O(i){if(!u&&!i){return;}var u1=q.getCurrentUIState();var v1={};v1.end=u&&(u.columnsVisibility.endColumn!==u1.columnsVisibility.endColumn);v1.mid=u&&(u.columnsVisibility.midColumn!==u1.columnsVisibility.midColumn);v1.begin=u&&(u.columnsVisibility.beginColumn!==u1.columnsVisibility.beginColumn);u=u1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:u.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:u.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.endColumn.closeColumn!==null});var w1=n.getCurrentIdentity();var x1=w1&&w1.treeNode;if(w1){var y1=N();var z1=x1.level-(x1.fCLLevel===2&&!u.columnsVisibility.endColumn);var A1=z1-(z1>1&&!y1)-(u.columnsVisibility.endColumn&&u.columnsVisibility.beginColumn&&z1>2);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",y1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",z1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",A1);}if(w1&&C!==u.layout){var B1=G(u.layout,x1.sRouteName)?null:u.layout;n.navigateByExchangingQueryParam("FCLLayout",B1);}else if((v1.begin||v1.mid||v1.end)&&!i){K(v1);}}function P(i){if(z(i.treeNode)){C=R(i);if(!C){switch(i.treeNode.fCLLevel){case 0:var u1=q.getNextUIState(0).columnsVisibility;if(u1.midColumn){C=D[1];}else{C=D[0];n.navigateByExchangingQueryParam("FCLLayout",C);}break;case 1:C=D[1];break;case 2:C=D[2];}}}else{C=i.treeNode.fCLLevel===0?D[0]:L.EndColumnFullScreen;}o.setLayout(C);if(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2){var v1=q.getCurrentUIState();if(v1.columnsVisibility.midColumn){var w1=1-v1.columnsVisibility.beginColumn;for(var x1=i.treeNode;x1.fCLLevel>w1;){x1=T.mRoutingTree[x1.parentRoute];i.componentsDisplayed[x1.sRouteName]=1;}}}}function Q(i){v=-1;O(true);return J(i);}function R(i){return k(i.appStates)||i.treeNode.defaultLayoutType||D[t(i.treeNode.fCLLevel)];}function S(i,u1,v1){if(!G(u1,v1)){i.FCLLayout=u1;}}function U(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function V(i){return i===L.ThreeColumnsBeginExpandedEndHidden||i===L.ThreeColumnsMidExpandedEndHidden;}function W(i,u1,v1,w1){if(!i.componentId){return;}var x1=null;var y1=n.getApplicableStateForComponentAddedPromise(i.componentId,x1,w1);v1.push(y1);}function X(i,u1,v1,w1){S(i,v1,u1.sRouteName);var x1=[];if(!V(v1)){W(u1,w1,x1,i);}if(!U(v1)){for(var y1=u1;y1.fCLLevel>0;){y1=T.mRoutingTree[y1.parentRoute];W(y1,w1,x1,i);}}return Promise.all(x1);}function Y(i,u1){var v1=i.fCLLevel===1?u.actionButtonsInfo.endColumn.closeColumn:L.OneColumn;var w1=n.getCurrentIdentity();var x1=w1.keys.slice(0,i.level+1);return X(u1,i,v1,x1);}function Z(i){return U(C)?b1(i.fCLLevel):(i.defaultLayoutType||q.getNextUIState(i.fCLLevel).layout);}function $(i,u1,v1){var w1=Z(i);return X(u1,i,w1,v1);}function _(i,u1){var v1=(u1.treeNode.fCLLevel===1&&i.treeNode.parentRoute===u1.treeNode.sRouteName)?u.actionButtonsInfo.endColumn.closeColumn:Z(u1.treeNode);return X(u1.appStates,u1.treeNode,v1,u1.keys);}function a1(i,u1,v1){var w1;if(i.treeNode.fCLLevel===u1.treeNode.fCLLevel){w1=C;}else if(i.treeNode.fCLLevel===2){w1=u.actionButtonsInfo.endColumn.closeColumn;}else{w1=Z(u1.treeNode);}return X(v1,u1.treeNode,w1,u1.keys);}function b1(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function c1(u1,v1){var w1=T.mRoutingTree[u1];if(!z(w1)){return null;}var x1=s||w1.defaultLayoutType||q.getNextUIState(w1.fCLLevel).layout;S(v1,x1,u1);s=null;if(U(x1)){return null;}var y1=[];for(var i=w1.fCLLevel;i>0;i--){var z1=w1.parentRoute;y1.push(n.addUrlParameterInfoForRoute(z1,v1));w1=T.mRoutingTree[z1];}return Promise.all(y1);}function d1(i,u1){if(i.treeNode.fCLLevel===0||i.treeNode.fCLLevel===3){return true;}var v1=R(i);var w1=R(u1);return U(v1)===U(w1);}function e1(i,u1,v1){T.oApplicationProxy.performAfterSideEffectExecution(function(){var w1=e(i.fCLLevel);var x1=u.actionButtonsInfo[w1+"Column"][u1];var y1=v1?T.mRoutingTree[i.parentRoute]:i;var z1=n.getCurrentIdentity();var A1=Object.create(null);var B1=X(A1,y1,x1,z1.keys);var C1=B1.then(function(){n.navigateToIdentity({treeNode:y1,keys:(y1===z1.treeNode)?z1.keys:z1.keys.slice(0,y1.level+1),appStates:A1});});T.oBusyHelper.setBusy(C1);},true);}function f1(i){return{onCloseColumnPressed:e1.bind(null,i,"closeColumn",true),onFullscreenColumnPressed:e1.bind(null,i,"fullScreen",false),onExitFullscreenColumnPressed:e1.bind(null,i,"exitFullScreen",false)};}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function g1(i){var u1=T.mEntityTree[i.entitySet];var v1=T.oNavigationControllerProxy.getCurrentIdentity();var w1=v1.treeNode;return u1.level>w1.level;}function h1(i){C=q.getNextUIState(i).layout;o.setLayout(C);}function i1(){return!N();}function j1(i,u1){var v1=0;for(var w1 in u1){var x1=T.mRoutingTree[w1];if(x1.level>=i.viewLevel&&u1[w1]===1){if(x1.level===i.viewLevel){v1=x1.fCLLevel;}u1[w1]=5+(x1.level>i.viewLevel);}}v=t(v1);h1(v1);var y1=n.oRouter.getTargets();var z1=b(v1);y1.display(z1);}function k1(i){if(i<v||v<0){return u.columnsVisibility[e(i)+"Column"];}return false;}function l1(i,u1){if(!z(u1)){return;}var v1=b1(u1.fCLLevel);if(G(v1,u1.sRouteName)){return;}i.FCLLayout=v1;}function m1(i){return i.treeNode.fCLLevel!==0&&i.treeNode.fCLLevel!==3&&!U(R(i));}function n1(){return w;}function o1(i,u1){if(!x){return;}var v1=false;var w1=q.getNextUIState(0).columnsVisibility;if(w1.midColumn){var x1=n.getCurrentIdentity();var y1=x1&&x1.treeNode;v1=y1&&y1.level===0&&k(x1.appStates)!==L.OneColumn;}if(v1){if(i){u1(i);}else{n.navigateByExchangingQueryParam("FCLLayout",L.OneColumn);}}}function p1(){return y;}function q1(){return x;}function r1(i,u1){var v1=j(i);o1(v1,u1);}function s1(i){if(i>2){s="";}else{s=b1(i);}}function t1(i){var u1={};if(i.fCLLevel===1||i.fCLLevel===2){u1.oActionButtonHandlers=f1(i);}if(i.level===0){u1.handleDataReceived=(q1&&q1())?r1:jQuery.noop;u1.isListAndFirstEntryLoadedOnStartup=q1;}return u1;}o.attachStateChange(O.bind(null,false));return{adaptRoutingInfo:E,createMessagePageTargets:a,displayMessagePage:j1,isLevelActive:k1,handleBeforeRouteMatched:P,handleRouteMatched:Q,areIdentitiesLayoutEquivalent:d1,getAppStatesPromiseForColumnClose:Y,getAppStatesPromiseForColumnOpen:$,getAppStatesPromiseForNavigation:_,getSpecialDraftCancelPromise:a1,getFCLAppStatesPromise:c1,isNewHistoryEntryRequired:g1,adaptBreadCrumbUrlParameters:l1,isAppTitlePrefered:i1,hasNavigationMenuSelfLink:m1,getFullscreenLayout:b1,getMaxColumnCountInFCL:n1,isNextObjectLoadedAfterDelete:p1,getFclProxy:t1,isListAndFirstEntryLoadedOnStartup:q1,setStoredTargetLayoutToFullscreen:s1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(o,n){Object.assign(this,l(o,n));}});});
