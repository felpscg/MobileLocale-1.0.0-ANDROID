sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/detailUtils","sap/suite/ui/generic/template/ObjectPage/controller/SideContentHandler","sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI","sap/suite/ui/generic/template/js/AnnotationHelper","sap/m/Table","sap/ui/layout/DynamicSideContent","sap/suite/ui/generic/template/lib/ShareUtils","sap/ui/dom/jquery/Selectors","sap/base/Log","sap/suite/ui/generic/template/ObjectPage/controller/MultipleViewsHandler","sap/suite/ui/generic/template/lib/MessageUtils","sap/ui/events/KeyCodes","sap/base/util/merge","sap/ui/model/FilterProcessor"],function(C,M,F,S,a,t,d,b,E,A,R,D,c,f,L,g,h,K,m,l){"use strict";var n=25;function s(O){O.setSelectedSection(null);}function I(e){return e.data("inlineCreate")==="true";}function o(B,e){if(B.getBindings){var j=B.getBindings();for(var i=0;i<j.length;i++){o(j[i],e);}}else{var T=B.getType();B.setType(T,e);}}var r=/[A-Za-z].*[A-Za-z]/;var p={getMethods:function(v,T,q){var u={"oMultipleViewsHandler":{}};var B=d.getControllerBase(v,T,q);v.oController=q;var w;var O;var y=new b(q,T,B.stateChanged);var z=null;var G=[];var H=[];var J=null;function N(e){var i=e.getParameter("bindingParams");i.parameters=i.parameters||{};i.parameters.usePreliminaryContext=true;i.parameters.batchGroupId="facets";return i;}function P(){L.info("Activate object","sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");var e=B.state.saveScenarioHandler;var i=T.oServices.oCRUDManager.activateDraftEntity(e);i.then(function(k){f1();h.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_SAVED"),T.oServices);var x=q.getOwnerComponent();T.oServices.oViewDependencyHelper.setAllPagesDirty([x.getId()]);T.oServices.oViewDependencyHelper.unbindChildren(x);T.oServices.oApplication.invalidatePaginatorInfo();var Z1=x.getNavToListOnSave();T.oServices.oApplication.navigateAfterActivation(!Z1&&k.context);},jQuery.noop);var j={activationPromise:i};T.oComponentUtils.fire(q,"AfterActivate",j);}function Q(){var e=q.getView();var i=e.getModel().hasPendingChanges();var j=e.getModel().getPendingChanges();T.oCommonEventHandlers.submitChangesForSmartMultiInput();var k=T.oServices.oCRUDManager.saveEntity();k.then(function(Z1){var $1=T.oComponentUtils.getTemplatePrivateModel();$1.setProperty("/objectPage/displayMode",1);v.setEditable(false);U(Z1,e,i,j);});var x={saveEntityPromise:k};T.oComponentUtils.fire(q,"AfterSave",x);}function U(e,i,j,k,x){var Z1=T.oComponentUtils.isNonDraftCreate();T.oServices.oViewDependencyHelper.setRootPageToDirty();T.oServices.oViewDependencyHelper.unbindChildren(q.getOwnerComponent());if(Z1){if(x==="SaveAndContEdit"){e=e?e:i.getBindingContext();}if(e&&e.getPath()!=="/undefined"){T.oServices.oNavigationController.navigateToContext(e,undefined,true);}else{T.oServices.oNavigationController.navigateBack();}h.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_CREATED"),T.oServices);}else{if(j){h.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_SAVED"),T.oServices);}else{h.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_NOT_MODIFIED"),T.oServices);}if(!T.oComponentUtils.isDraftEnabled()&&!w){T.oServices.oNavigationController.navigateBack();}}if(k){var $1;var _1;var a2=[];var b2;for(var c2 in k){if(k.hasOwnProperty(c2)){$1=i.getModel().getContext("/"+c2);_1=k&&k[$1.getPath().replace("/","")]||{};a2=Object.keys(_1)||[];b2=a2.indexOf("__metadata");if(b2>-1){a2.splice(b2,1);}T.oServices.oApplicationController.executeSideEffects($1,a2);}}}}function V(){var e=q.getView();var i=e.getModel().hasPendingChanges();var j=e.getModel().getPendingChanges();T.oCommonEventHandlers.submitChangesForSmartMultiInput();var k=T.oServices.oCRUDManager.saveEntity();k.then(function(Z1){v.setEditable(true);U(Z1,e,i,j,"SaveAndContEdit");});var x={saveEntityPromise:k};T.oComponentUtils.fire(q,"AfterSave",x);}function W(e){var i=e.getSource().getId();X("SaveAndContEdit",i);}function X(e,i){var j;var k;var x;if(T.oComponentUtils.isDraftEnabled()){j=1;k=P;x="activate";}else{j=3;if(e==="SaveAndContEdit"){k=V;x=i;}else{k=Q;x="save";}}T.oCommonUtils.executeIfControlReady(B.state.saveScenarioHandler.handleSaveScenario.bind(null,j,k),x);}function Y(e){if(I(e.getSource())){var i=e.getParameter("bindingParams");if(i.filters&&i.filters.length){var j=l.groupFilters(i.filters);i.filters=new F({filters:[new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:true}),j],and:true}),new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:false}),new F({filters:[j,new F({path:"HasActiveEntity",operator:"EQ",value1:false})],and:false})],and:true})],and:false});}var k=i.sorter[0]&&i.sorter[0].getGroupFunction();var x=k&&function(Z1){var $1=Z1.getObject();if($1.IsActiveEntity||$1.HasActiveEntity){var _1=Object.assign({},k(Z1));_1.key=_1.key.charAt(0)==="ยง"?"ยง"+_1.key:_1.key;return _1;}return{key:"ยง",text:T.oCommonUtils.getText("NEW_ENTRY_GROUP")};};if(e.getSource().data("disableInlineCreateSort")==="false"){i.sorter.unshift(new S("HasActiveEntity",false,x));}}}function Z(){return O.getHeaderTitle();}function $(e){var i=T.oComponentUtils.getTemplatePrivateModel();var j={shareEmailPressed:function(){var k=i.getProperty("/objectPage/headerInfo/objectTitle");var x=i.getProperty("/objectPage/headerInfo/objectSubtitle");if(x){k=k+" - "+x;}var Z1=document.URL.replace(/\(/g,'%28').replace(/\)/g,'%29');sap.m.URLHelper.triggerEmail(null,k,Z1);},shareJamPressed:function(){c.openJamShareDialog(i.getProperty("/objectPage/headerInfo/objectTitle")+" "+i.getProperty("/objectPage/headerInfo/objectSubtitle"));},getModelData:function(){return{title:i.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:i.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:c.getCustomUrl()};}};c.openSharePopup(T.oCommonUtils,e.getSource(),j);}function _(){var e=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(i){var j=i.getSource();var k=j.getBindingContext("buttons");var x=k.getProperty("link");var Z1=k.getProperty("param");var $1=x.intent;var _1=$1.split("#")[1].split("-")[0];var a2=$1.split("-")[1].split("?")[0].split("~")[0];var b2={target:{semanticObject:_1,action:a2},params:Z1};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(b2);}},"buttons");return e;}var a1;function b1(){a1=function(e){var i=e.getSource().getParent();var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var k=q.getOwnerComponent();var x=k.getModel("_templPrivGlobal");var Z1={objectPage:{currentEntitySet:k.getProperty("entitySet")}};x.setProperty("/generic/multipleViews",Z1);var $1=T.oServices.oCRUDManager.deleteEntity();var _1=k.getBindingContext().getPath();var a2=Object.create(null);a2[_1]=$1;T.oServices.oApplication.prepareDeletion(a2);var e={deleteEntityPromise:$1};j.setBusy($1);T.oComponentUtils.fire(q,"AfterDelete",e);i.close();};return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(e){var i=e.getSource().getParent();i.close();},onDelete:function(e){a1(e);}},"delete");}function c1(){var e=T.oServices.oApplication.getBusyHelper();if(e.isBusy()){return;}var i=T.oCommonUtils;var j=T.oComponentUtils.getTemplatePrivateModel();var k=(j.getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var x=j.getProperty("/objectPage/headerInfo/objectSubtitle");var Z1;var $1={};$1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");if(k){if(x){Z1=[" ",k,x];$1.text=i.getText("DELETE_WITH_OBJECTINFO",Z1);}else{Z1=[k];$1.text=i.getText("DELETE_WITH_OBJECTTITLE",Z1);}}else{$1.text=i.getText("ST_GENERIC_DELETE_SELECTED");}var _1=Promise.resolve(q.beforeDeleteExtension());_1.then(function(a2){Object.assign($1,a2);var b2=b1();var c2=b2.getModel("delete");c2.setData($1);b2.open();},jQuery.noop);}function d1(e){var i=e.getParameter("columnInfos");var j=i&&i.length-1;while(j>=0){if(i[j].ignore){i.splice(j,1);}j-=1;}var k=i.reduce(function(Z1,$1){if(!$1.type&&!$1.customParseFunction){Z1.push($1);}return Z1;},[]);if(k.length>0){var x=T.oCommonUtils.getText("DATA_PASTE_UNSUPPORTED_FORMAT_MESSAGE");M.show(x,{icon:M.Icon.ERROR,title:T.oCommonUtils.getText("ST_ERROR"),actions:[sap.m.MessageBox.Action.CLOSE]});}}function e1(e){var j;var n1=e.getSource();var k=n1.getId();var x=k.split("::Table")[0]+"::addEntry";var Z1=q.byId(x);if(!Z1){return;}var $1=e.getParameter("result");if($1){if($1.errors){var _1=$1.errors.map(function(i2){return i2.message;});var a2=T.oCommonUtils.getText("DATA_PASTE_ERROR_MESSAGE",[_1.length]);var b2=T.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_MESSAGE");var c2=T.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_NOTE");_1.unshift("");_1.unshift(c2);_1.unshift(b2);M.show(a2,{icon:M.Icon.ERROR,title:T.oCommonUtils.getText("ST_ERROR"),actions:[sap.m.MessageBox.Action.CLOSE],details:_1.join("<br />")});}else if($1.parsedData){j=$1.parsedData;if(j&&j.length){var d2=j.length;var e2;var f2,g2=[];var h2=sap.m.DraftIndicatorState.Saved;for(var i=0;i<d2;i++){e2=i<d2-1;f2=T.oCommonEventHandlers.addEntry(Z1,true,undefined,j[i],e2);g2.push(f2);}Promise.all(g2).then(function(){var i2=q.getOwnerComponent();var j2=i2.getAppComponent();var k2=j2.getModel("_templPrivGlobal");k2.setProperty("/generic/draftIndicatorState",h2);});}}}}function f1(){var e=T.oComponentUtils.getTemplatePrivateModel();var i=e.getProperty("/objectPage/aPasteAttachedTables");var j=i.length;var k;var x;var Z1;while(j>=0){k=i[j];x=q.byId(k+"::Table");Z1=q.byId(k+"::pasteEntries");if(x&&x.isA("sap.ui.comp.smarttable.SmartTable")&&x.hasListeners("paste")){Z1.setVisible(false);x.detachBeforePaste(d1);x.detachPaste(e1);i.splice(j,1);}j-=1;}}function g1(e){T.oServices.oApplication.performAfterSideEffectExecution(c1);}function h1(e,i){var j,k;if(e){k=e.context||e;if(T.oServices.oDraftController.getDraftContext().hasDraft(k)){T.oServices.oViewDependencyHelper.setRootPageToDirty();j=k.context||k;}}if(j){T.oServices.oApplication.invalidatePaginatorInfo();T.oServices.oApplication.switchToDraft(j);}else{var x=T.oComponentUtils.getTemplatePrivateModel();x.setProperty("/objectPage/displayMode",2);}v.setEditable(true);}var i1;function j1(e){T.oServices.oCRUDManager.editEntity(e).then(function(i){if(i.draftAdministrativeData){i1(i.draftAdministrativeData.CreatedByUserDescription||i.draftAdministrativeData.CreatedByUser);}else{h1(i.context,false);}});}i1=function(e){var i=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){i.close();j1(true);},onCancel:function(){i.close();}},"Dialog");var j=i.getModel("Dialog");var k=T.oCommonUtils.getText("DRAFT_LOCK_EXPIRED",[e]);j.setProperty("/unsavedChangesQuestion",k);i.open();};function k1(){var j="{\"SelectionVariantID\":\"\"}";var k=q.getOwnerComponent();var Z1=k.getEntitySet();var $1=k.getModel();var _1=$1.getMetaModel();var a2=_1.getODataEntitySet(Z1);var b2=_1.getODataEntityType(a2.entityType);var c2=b2.property;var d2=[];for(var x in c2){var e2=c2[x]["com.sap.vocabularies.Common.v1.FieldControl"]&&c2[x]["com.sap.vocabularies.Common.v1.FieldControl"].Path;if(e2&&d2.indexOf(e2)<0){d2.push(e2);}}var f2=q.getView().getBindingContext();var g2=f2.getObject();var h2=new a();for(var i in c2){var i2=c2[i].type;var j2=c2[i].name;var k2=g2[c2[i].name];if(d2.indexOf(j2)>-1){continue;}if(j2&&(k2||i2==="Edm.Boolean")){if(i2==="Edm.Time"&&k2.ms!==undefined){k2=k2.ms;}if(typeof k2!=="string"){try{k2=k2.toString();}catch(e){k2=k2+"";}}h2.addParameter(j2,k2);}}j=h2.toJSONString();return j;}function l1(e,n1){var i=true;var j=n1.getModel();n1=n1 instanceof R?n1.getParent():n1;var k=T.oCommonUtils.getDeleteRestrictions(n1);var x=k&&k.Deletable&&k.Deletable.Path;if(x){i=j.getProperty(x,e);}return i;}var m1;var n1;function o1(e,j){m1=e;n1=j instanceof R?j.getParent():j;var k=[];a1=function(x){var Z1=T.oServices.oApplication.getBusyHelper();var $1=x.getSource().getParent();var _1=T.oCommonUtils.getSelectedContexts(n1);k=[];var a2;var b2;var c2=q.getView().getModel().getObject(_1[0].getPath());for(var i=0;i<_1.length;i++){if(l1(_1[i],n1)){k.push(_1[i].getPath());}}var d2=T.oServices.oCRUDManager.deleteEntities(k);Z1.setBusy(d2);T.oServices.oApplicationController.executeSideEffects(n1.getBindingContext(),[],[n1.getTableBindingPath()]);var e2=m1.getParent().getParent().getId();d2.then(function(g2){T.oCommonUtils.refreshSmartTable(n1);if(c2.IsActiveEntity===false){b2=0;}else{b2=g2.length;}a2=k.length-b2;var h2="";if(a2>0){if(T.oCommonUtils.isUiTable(n1.getTable())){var i2=n1.getTable().getPlugin("sap.ui.table.plugins.SelectionPlugin");i2&&i2.clearSelection();}if(a2>1){h2=T.oCommonUtils.getContextText("DELETE_SUCCESS_PLURAL_WITH_COUNT",n1.getId(),null,[a2]);}else{if(b2>0){h2=T.oCommonUtils.getContextText("DELETE_SUCCESS_WITH_COUNT",n1.getId(),null,[a2]);}else{h2=T.oCommonUtils.getContextText("ITEM_DELETED",n1.getId());}}}if(b2>0){if(b2>1){h2+=h2&&h2+"\n";h2+=T.oCommonUtils.getContextText("DELETE_ERROR_PLURAL_WITH_COUNT",n1.getId(),null,[b2]);}else{if(a2>0){h2+="\n";h2+=T.oCommonUtils.getContextText("DELETE_ERROR_WITH_COUNT",n1.getId(),null,[b2]);}else{h2+=T.oCommonUtils.getContextText("DELETE_ERROR",n1.getId());}}}if(h2){if(b2>0){M.error(h2);}else{h.showSuccessMessageIfRequired(h2,T.oServices);}}});var f2={deleteEntitiesPromise:d2,sUiElementId:e2,aContexts:_1};T.oComponentUtils.fire(q,"AfterLineItemDelete",f2);$1.close();};return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(i){var x=i.getSource().getParent();x.close();},onDelete:function(i){a1(i);}},"delete");}function p1(e){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var m1=e.getSource();var n1=T.oCommonUtils.getOwnerControl(m1);if(!T.oCommonUtils.isSmartTable(n1)){n1=n1.getParent();}var k=T.oCommonUtils.getSelectedContexts(n1);if(k.length===0){M.error(T.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:T.oCommonUtils.getContentDensityClass()});return;}var x=[];var Z1=[];for(var i=0;i<k.length;i++){if(l1(k[i],n1)){x.push(k[i].getPath());}else{Z1.push(k[i]);}}var $1={};if(k.length>1){$1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE_WITH_COUNT",[k.length]);$1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEMS",n1.getId());}else{var _1=T.oCommonEventHandlers.getSelectedItemContextForDeleteMessage(n1,k[0]);$1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");$1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEM",n1.getId(),null,_1);}if(Z1.length>0){$1.undeletableText=T.oCommonUtils.getContextText("DELETE_UNDELETABLE_ITEMS",n1.getId(),null,[Z1.length,k.length]);}var a2={sUiElementId:m1.getParent().getParent().getId(),aContexts:k};var b2=Promise.resolve(q.beforeLineItemDeleteExtension(a2));b2.then(function(c2){Object.assign($1,c2);var d2=o1(m1,n1);if(!Z1.length){$1.undeletableText=undefined;}var e2=d2.getModel("delete");e2.setData($1);d2.open();},jQuery.noop);}function q1(){var i=q.byId("imageDialog")||T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.ImageDialog",{onImageDialogClose:function(){i.close();}},"headerImage");return i;}function r1(){var e=T.oComponentUtils.getTemplatePrivateModel();e.setProperty("/objectPage/isHeaderExpanded",true);var i=q.byId("template::ObjectPage::TitleImage");if(!i){return;}var j=q.getView().byId("template::ObjectPage::ObjectPageHeader");j.attachStateChange(function(k){var x=k.getParameter("isExpanded");e.setProperty("/objectPage/isHeaderExpanded",x);});}function s1(){var e;var j=T.oComponentUtils.getTemplatePrivateModel();var k=function(i){return function(x){var Z1=x.getSource();var $1=Z1.getExternalValue();j.setProperty("/objectPage/headerInfo/"+i,$1);if(i==="objectTitle"){T.oComponentUtils.setText($1);if(!$1){var _1=T.oComponentUtils.getHeaderDataAvailablePromise();_1.then(function(a2){$1=Z1.getExternalValue();if($1){return;}var b2=q.getView();var c2=a2.getObject();var d2=b2.getModel("ui");var e2=d2.getProperty("/createMode");if(e2&&c2&&(c2.IsActiveEntity===undefined||c2.IsActiveEntity===false||c2.HasActiveEntity===false)){e=e||T.oCommonUtils.getText("NEW_OBJECT");j.setProperty("/objectPage/headerInfo/objectTitle",e);T.oComponentUtils.setText(e);}});}}};};O.getCustomData().forEach(function(x){var Z1=x.getKey();if(Z1==="objectTitle"||Z1==="objectSubtitle"){var $1=x.getBinding("value");var _1=!$1&&x.getBindingInfo("value");if(!$1&&!_1){j.setProperty("/objectPage/headerInfo/"+Z1,x.getValue());return;}var a2=k(Z1);if($1){$1.attachChange(a2);o($1,"string");}else{_1.events={change:a2};for(var i=0;i<_1.parts.length;i++){_1.parts[i].targetType="string";}}}});}function t1(e){e.preventDefault();var i=T.oCommonUtils.getControlInformation(e,null,true);if(i){T.oCommonUtils.processDataLossConfirmationIfNonDraft(i.navigate,jQuery.noop,B.state);}}function u1(e,i){L.info("Set binding context to "+e,"Subsection: "+i.getId(),"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");i.setBindingContext(e);}function v1(e,i,j,k){if(i){var x=e?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();x.then(function(){u1(undefined,j);var Z1=j.getId();L.info("Start refreshing of Subsection: "+Z1,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");k.refresh(null,true);L.info("End refreshing of Subsection: "+Z1,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");});}else{u1(null,j);}}var w1={lazyLoading:v1.bind(null,false),lazyLoadingAfterHeader:v1.bind(null,true),reuseComponent:function(i,e){var j=e.getBlocks()[0];var k=i?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();k.then(T.oComponentUtils.onVisibilityChangeOfReuseComponent.bind(null,i,j));}};function x1(e,i,j){if(j instanceof D){j=j.getMainContent()[0];}else if(!j.getContent){return;}j.getContent().forEach(function(k){if(T.oCommonUtils.isSmartTable(k)){if(i||e[k.getEntitySet()]){if(k.isInitialised()){T.oCommonUtils.refreshSmartTable(k);}else{k.attachInitialise(function(){T.oCommonUtils.refreshSmartTable(k);});}if(!i){T.oServices.oApplicationController.executeSideEffects(q.getOwnerComponent().getBindingContext(),[],[k.getTableBindingPath()]);}}}});}function y1(e){return T.oCommonUtils.getControlInformation(e);}function z1(e){G.push(e);T.oCommonUtils.getControlInformation(e,function(i,j){var k=e.getBlocks();y.initSideContentInfoObject(k[0]);var x=k.concat(e.getMoreBlocks());i.refresh=function(_1,a2){var b2=x1.bind(null,_1,a2);x.forEach(b2);};var Z1=T.oCommonUtils.getElementCustomData(e).strategyForVisibilityChange;var $1=w1[Z1];i.strategyForVisibilityChange=$1||jQuery.noop;if($1){j.push("subSectionListeningToVisibilityChange");}});}function A1(e){var i,j;i=e?e.getParameter("section"):undefined;j=i?i.getId():O.getSelectedSection();if(j!==z){L.info("Selected Section: "+j,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");}if(!i&&j){O.getSections().some(function(k){if(k.getId()===z){i=k;return true;}return false;});}return{sectionId:j,section:i};}function B1(e){var j=0,k;var x=A1(e);z=x.sectionId;k=x.section;if(k){var Z1=k.getSelectedSubSection();if(Z1!==J){L.info("Selected Subsection: "+J,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");J=Z1;G.some(function(c2,d2){if(c2.getId()===J){j=d2;return true;}return false;});H=[];}}if(H.length===0){var $1=0;var _1=2;var a2=O.getUseIconTabBar();if(a2&&k){var b2=k.getSubSections();_1=b2.length>_1?_1:b2.length;}for(var i=j;$1<_1&&i<G.length;i++){var c2=G[i];if(c2.getVisible()){$1++;H.push(c2.getId());}}}}function C1(i,e,j){e=e||y1(j);i=i||D1(j);if(e.isVisible===i){return;}e.isVisible=i;e.strategyForVisibilityChange(i,j,e);}function D1(e){var i=e.getId();return H.some(function(j){if(j===i){L.info("Initially Visible Subsection: "+i,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");return true;}return false;});}function E1(i){T.oCommonUtils.executeForAllInformationObjects("subSectionListeningToVisibilityChange",C1.bind(null,i));}function F1(e){var j=[];for(var i=0;i<e.length;i++){if(e[i].getVisible()){j.push(e[i]);}}return j;}function G1(){var e=[];var i=O.getSections();e=F1(i);if(e.length===1){return H1(e[0]);}return false;}function H1(e){if(e){var G=e.getSubSections();var i=F1(G);return i.length===1;}return false;}function I1(n1){var e=n1.getParent();var i=e.getParent();if(e&&e.isA("sap.ui.layout.Grid")&&i&&i.isA("sap.uxap.ObjectPageSubSection")){e.addStyleClass("sapSmartTemplatesObjectPageSubSectionGridExpand");i.addStyleClass("sapUxAPObjectPageSubSectionFitContainer");n1.setFitContainer(true);}}function J1(e,i){var j="sapUiSizeCompact",k="sapUiSizeCondensed",x;if(!e){return;}x=jQuery(document.body);if(x.hasClass(j)){i.addStyleClass(k);}}function K1(n1,e,i){if(e.isA("sap.m.Table")){e.setGrowingThreshold(n);e.setGrowingScrollToLoad(true);}else if(e.isA("sap.ui.table.Table")){I1(n1);J1(i,e);}}function L1(n1,e,i){var j;var k=q.getOwnerComponent().mProperties;if(k&&k.sections){var x=k.sections[i];if(x&&x.hasOwnProperty("condensedTableLayout")){j=x.condensedTableLayout;}else{j=k.condensedTableLayout;}}else{j=k.condensedTableLayout;}if(O.getUseIconTabBar()){var Z1=e.getParent();while(Z1&&Z1.sParentAggregationName!=="sections"){Z1=Z1.getParent();}if(H1(Z1)){K1(n1,e,j);}}else if(G1()){K1(n1,e,j);}}function M1(e){B1(e);B.stateChanged();}function N1(e,i,j,k,x){var Z1=A.createP13NColumnKey(x);var $1=A.getBindingForHiddenPath(x);if($1==="{= !${} }"){e.push(Z1);return false;}if(typeof($1)==="string"){var _1=$1.match(r)&&$1.match(r)[0];if(_1&&_1.indexOf("/")>0&&k.navigationProperty){var a2=q.getOwnerComponent().getEntitySet();var b2=_1.split("/",1)[0];if(j.getODataAssociationSetEnd(k,b2).entitySet===a2){i[Z1]=_1.split("/").slice(1).join("/");return true;}}}else if(!$1){e.push(Z1);}return false;}function O1(n1,e,j,k,x,Z1){var $1=[];var _1=Object.create(null);var a2=false;for(var i=0;i<Z1.length;i++){var b2=Z1[i];a2=N1($1,_1,k,x,b2)||a2;}if(a2){e.dynamicHideInfos={staticHiddenColumns:$1,columnKeyToHiddenPath:_1};j.push("smartTableWithDynamicColumnHide");}if($1.length){n1.deactivateColumns($1);}}function P1(e,j,n1){j.push("smartTable");n1=T.oCommonUtils.isMTable(n1)?n1.getParent():n1;var k=n1.getModel().getMetaModel();var x=k.getODataEntitySet(n1.getEntitySet());var Z1=k.getODataEntityType(x.entityType);var $1=Z1["com.sap.vocabularies.UI.v1.LineItem"];var _1=n1.getCustomData();for(var i=0;i<_1.length;i++){if(_1[i].getKey()==="lineItemQualifier"){$1=Z1["com.sap.vocabularies.UI.v1.LineItem#"+_1[i].getValue()];break;}}O1(n1,e,j,k,Z1,$1||[]);}function Q1(n1){return T.oCommonUtils.getControlInformation(n1,P1);}function R1(e,i){var j,k;j=i.split(e)[1];k=j&&j.substring(0,j.lastIndexOf("::Table"));return k;}function S1(e,i,j){i.push("searchField");var k=T.oCommonUtils.isMTable(j.getParent().getParent())?j.getParent().getParent().getParent():j.getParent().getParent();e.table=k;var x=Q1(k);x.searchField=j;}function T1(e){return T.oCommonUtils.getControlInformation(e,S1);}function U1(e){T1(e);}function V1(e){var i=T1(e);i.searchString=e.getSource().getValue();i.table.rebindTable();}function W1(e,i){i.setValue("");if(e.searchString){e.searchString="";e.table.rebindTable();}}function X1(){T.oCommonUtils.executeForAllInformationObjects("searchField",W1);}v.refreshFacets=function(e){var i=function(j){var k=y1(j);k.refresh(e,false);};O.getSections().forEach(function(j){j.getSubSections().forEach(i);});};v.onComponentActivate=B.onComponentActivate;v.getCurrentState=function(){var e=Object.create(null);if(z){e.section={data:z,lifecycle:{permanent:true,pagination:true}};}if(J){e.subSection={data:J,lifecycle:{permanent:true,pagination:true}};}e.sideContent=y.getCurrentState();var i=Object.create(null);q.provideCustomStateExtension(i);for(var j in i){e["$custom$"+j]=i[j];}var k=true;var x=function(Z1,$1){if(!(Z1 instanceof C)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!k){throw new Error("State must always be provided synchronously");}var _1=Z1.getMetadata().getNamespace();if($1){for(var a2 in $1){e["$extension$"+_1+"$"+a2]=$1[a2];}}};q.templateBaseExtension.provideExtensionStateData(x);k=false;return e;};v.applyState=function(u,i){var e=T.oComponentUtils.getHeaderDataAvailablePromise()||Promise.resolve();e.then(function(){var k=Object.create(null);var x=Object.create(null);for(var Z1 in u){if(Z1.indexOf("$custom$")===0){k[Z1.substring(8)]=u[Z1];}else if(Z1.indexOf("$extension$")===0){var $1=Z1.substring(11,Z1.indexOf("$",11));var _1=x[$1];if(!_1){_1=Object.create(null);x[$1]=_1;}var a2=Z1.substring(Z1.indexOf("$",11)+1,Z1.length);_1[a2]=u[Z1];}}q.applyCustomStateExtension(k,i);var b2=true;var c2=function(d2){if(!(d2 instanceof C)){throw new Error("State must always be retrieved with respect to a ControllerExtension");}if(!b2){throw new Error("State must always be restored synchronously");}var $1=d2.getMetadata().getNamespace();return x[$1];};q.templateBaseExtension.restoreExtensionStateData(c2,i);b2=false;});y.applyState(u.sideContent,i);if(i){if(z!==(u.section||"")){B.stateChanged();}return;}X1();if(u.section){z=u.section;L.info("Restoring Selected Section: "+z,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");O.setSelectedSection(z);if(u.subSection){var j;G.some(function(k){if(k.getId()===u.subSection){j=k;return true;}return false;});if(j){j.getParent().setSelectedSubSection(j);}J=u.subSection;L.info("Restoring Selected Subsection: "+J,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");}}else{Promise.all([T.oComponentUtils.getHeaderDataAvailablePromise(),T.oComponentUtils.getNavigationFinishedPromise()]).then(s.bind(null,O));z="";}};v.beforeRebind=function(){E1(false);};v.afterRebind=function(){L.info("Call of _triggerVisibleSubSectionsEvents","","sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");O._triggerVisibleSubSectionsEvents();};v.applyHeaderContextToSmartTablesDynamicColumnHide=function(e){var i=function(j,n1){var k=j.dynamicHideInfos.staticHiddenColumns.slice();for(var x in j.dynamicHideInfos.columnKeyToHiddenPath){var Z1=j.dynamicHideInfos.columnKeyToHiddenPath[x];if(e.getProperty(Z1)){k.push(x);}}n1.deactivateColumns(k);};T.oCommonUtils.executeForAllInformationObjects("smartTableWithDynamicColumnHide",i);};var j1=t.testable(j1,"editEntity");var l1=t.testable(l1,"isEntryDeletable");var P=t.testable(P,"onActivateImpl");var Q=t.testable(Q,"onSaveImpl");var Y1={onInit:function(){O=q.byId("objectPage");var e=q.getOwnerComponent();var i=O.getSections();for(var k=0;k<i.length;k++){var j=i[k];var G=j.getSubSections();G.forEach(z1);}B1();var x=Z();var Z1=e.getAppComponent().getConfig();var $1=!!(Z1.settings&&(Z1.settings.objectPageDynamicHeaderTitleWithVM||Z1.settings.objectPageHeaderType==='Dynamic'));v.aBreadCrumbs=x&&($1?x.getBreadcrumbs().getLinks():x.getBreadCrumbsLinks());if($1){r1();}B.onInit(null,E1.bind(null,true));s1();T.oCommonUtils.executeGlobalSideEffect();O.attachEvent("subSectionEnteredViewPort",function(c2){var d2=c2.getParameter("subSection");L.info("Viewport entered ","Subsection: "+d2.getId(),"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");C1(true,null,d2);});var _1=q.getOwnerComponent()&&q.getOwnerComponent().getSections();for(var a2 in _1){if(_1.hasOwnProperty(a2)){_1[a2]["key"]=a2;u.oMultipleViewsHandler[a2]=new g(u,q,T,_1[a2]);u.oMultipleViewsHandler[a2]["oSmartTable"]=q.byId(a2+"::Table");}}var b2=T.oComponentUtils.getTemplatePrivateModel();b2.setProperty("/objectPage/aPasteAttachedTables",[]);},handlers:{onEditAndActiveToggle:function(e,i){T.oServices.oApplication.performAfterSideEffectExecution(function(){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var k=e.getBindingContext();var x=T.oServices.oApplication.getDraftSiblingPromise(k);j.setBusy(x.then(function(Z1){if(i){L.info("Navigating to draft entity","sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");h1(Z1,true);}else{L.info("Navigating to active entity","sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");T.oServices.oNavigationController.navigateToContext(Z1,null,true,1,true);}f(':focus').blur();}));});},addEntry:function(e){var m1=e.getSource();var n1=T.oCommonUtils.getOwnerControl(m1);n1=T.oCommonUtils.isMTable(n1)?n1.getParent():n1;var i=I(n1);if(!m1.data("CrossNavigation")&&i){T.oCommonEventHandlers.addEntry(m1,true);return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.addEntry(m1,false);},jQuery.noop,B.state);},submitChangesForSmartMultiInput:function(){if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.submitChangesForSmartMultiInput();}},deleteEntries:p1,onSelectionChange:function(e){T.oCommonUtils.setEnabledToolbarButtons(e.getSource());},onMultiSelectionChange:function(e){T.oCommonEventHandlers.onMultiSelectionChange(e);},onCancel:function(e){var i=e.getSource();var j=B.state.onCancel(i);j.then(function(){f1();});},onContactDetails:function(e){T.oCommonEventHandlers.onContactDetails(e);},onPressDraftInfo:function(e){var i=q.getView().getBindingContext();var j=sap.ui.getCore().byId(e.getSource().getId()+(e.getId()==="markChangesPress"?"-changes":"-lock"));T.oCommonUtils.showDraftPopover(i,j);},onPressDraftInfoObjectPageDynamicHeaderTitle:function(e){var i=q.getView().getBindingContext();var j=q.byId("template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle");T.oCommonUtils.showDraftPopover(i,j);},onShareObjectPageActionButtonPress:$,onRelatedApps:function(e){var x,Z1,$1,_1,a2,b2,c2;var d2,e2,f2,g2,h2;x=e.getSource();f2=sap.ushell&&sap.ushell.Container;Z1=f2&&f2.getService("URLParsing");$1=Z1.parseShellHash(document.location.hash);g2=$1.semanticObject;h2=$1.action;_1=q.getView&&q.getView().getBindingContext();var i2=q.getOwnerComponent().getModel().getMetaModel();var j2=_1.getObject();var k2=j2.__metadata.type;var l2=i2.getODataEntityType(k2);var m2=l2["com.sap.vocabularies.Common.v1.SemanticKey"];var n2={};if(m2&&m2.length>0){for(var j=0;j<m2.length;j++){var o2=m2[j].PropertyPath;if(!n2[o2]){n2[o2]=[];n2[o2].push(j2[o2]);}}}else{for(var k in l2.key.propertyRef){var p2=l2.key.propertyRef[k].name;if(!n2[p2]){n2[p2]=[];n2[p2].push(j2[p2]);}}}a2=q.getOwnerComponent().getAppComponent();b2=f2&&f2.getService("CrossApplicationNavigation");c2=b2.getLinks({semanticObject:g2,params:n2,ui5Component:a2});d2=_();e2=d2.getModel("buttons");e2.setProperty("/buttons",[]);d2.openBy(x);c2.done(function(q2){var r2=[];q2.sort(function(v2,w2){if(v2.text<w2.text){return-1;}if(v2.text>w2.text){return 1;}return 0;});for(var i=0;i<q2.length;i++){var s2=q2[i];var t2=s2.intent;var u2=t2.split("-")[1].split("?")[0];if(u2!==h2){r2.push({enabled:true,text:s2.text,link:s2,param:n2});}}if(r2.length===0){r2.push({enabled:false,text:T.oCommonUtils.getText("NO_RELATED_APPS")});}e2.setProperty("/buttons",r2);});},onSemanticObjectLinkPopoverLinkPressed:function(e){T.oCommonEventHandlers.onSemanticObjectLinkPopoverLinkPressed(e,B.state);},onEdit:function(e){var m1=e.getSource();if(m1.data("CrossNavigation")){T.oCommonEventHandlers.onEditNavigateIntent(m1);return;}w=true;j1();},onSave:X,onSaveAndContinueEdit:W,onSmartFieldUrlPressed:function(e){T.oCommonEventHandlers.onSmartFieldUrlPressed(e,B.state);},onBreadCrumbUrlPressed:t1,onDelete:g1,onCallActionFromToolBar:function(e){T.oCommonEventHandlers.onCallActionFromToolBar(e,B.state);},onCallAction:function(e,i,j){T.oServices.oApplication.performAfterSideEffectExecution(function(){var k=q.getView().getBindingContext();if(k){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var x=q.getOwnerComponent();var Z1=x.getEntitySet();var $1={functionImportPath:e,contexts:[k],sourceControl:"",label:i,operationGrouping:j};T.oServices.oCRUDManager.callAction($1).then(function(_1){var a2=_1&&_1[0];if(a2&&a2.response&&a2.response.context&&(!a2.actionContext||a2.actionContext&&a2.response.context.getPath()!==a2.actionContext.getPath())){T.oServices.oViewDependencyHelper.setParentToDirty(x,Z1,1);}});},jQuery.noop,B.state,"Proceed");}},true);},onDataFieldForIntentBasedNavigation:function(e){e=m({},e);T.oServices.oApplication.performAfterSideEffectExecution(function(){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);});},true);},onDataFieldWithIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,B.state);},onDataFieldWithNavigationPath:function(e){T.oCommonEventHandlers.onDataFieldWithNavigationPath(e);},onChartInit:function(e){e.getSource().getChartAsync().then(function(i){var j=q._templateEventHandlers.onSelectionChange;i.attachSelectData(j).attachDeselectData(j);var k=i.getParent();T.oCommonUtils.checkToolbarIntentsSupported(k);});},onDataRequested:function(i){L.info("Data requested","SmartTable: "+i,"sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");var e=(q&&q.getView()&&q.getView().getId())+"--";var j=R1(e,i);u.oMultipleViewsHandler[j]&&u.oMultipleViewsHandler[j].onDataRequested();},onDataReceived:function(e){T.oCommonEventHandlers.onDataReceived(e);},onBeforeRebindDetailTable:function(e){var i,j,k;var n1=e.getSource();var x=N(e);var Z1=Q1(n1);var $1=Z1.searchField;if($1){var _1=T.oCommonUtils.getControlInformation($1);if(_1.searchString){x.parameters.custom={search:_1.searchString};}}T.oCommonEventHandlers.onBeforeRebindTable(e,{ensureExtensionFields:q.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:q.templateBaseExtension.addFilters});q.onBeforeRebindTableExtension(e);k=q&&typeof q.getView==="function"&&q.getView()&&typeof q.getView().getId==="function"&&q.getView().getId();if(k){k=k+"--";j=n1&&n1.getId();i=R1(k,j);u.oMultipleViewsHandler[i]&&u.oMultipleViewsHandler[i].onRebindContentControl(e);}Y(e);if(T.oCommonUtils.isAnalyticalTable(n1.getTable())){x.parameters.entitySet=n1.getEntitySet();}},onListNavigate:function(e){T.oCommonEventHandlers.onListNavigate(e,B.state,q.onListNavigationExtension.bind(q));},onBeforeSemanticObjectLinkPopoverOpens:function(e){var i=e.getParameters();T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=k1();T.oCommonUtils.semanticObjectLinkNavigation(i,j,q);},jQuery.noop,B.state,jQuery.noop);},onSemanticObjectLinkNavigationPressed:function(e){var i=e.getParameters();var m1=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(m1,i);},onSemanticObjectLinkNavigationTargetObtained:function(e){var i=e.getParameters();var m1=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(m1,i,B.state);},onSemanticObjectLinkNavigationTargetObtainedSmartLink:function(e){var i,m1;i=e.getParameters();m1=e.getSource();m1=m1.getParent().getParent().getParent().getParent();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(m1,i,B.state);},onHeaderImagePress:function(e){if(e.getSource().getSrc()===""){return;}var i=q1();var j=e.getSource().getId();i.addAriaLabelledBy(j);var k=i.getModel("headerImage");k.setProperty("/src",e.getSource().getSrc());if(sap.ui.Device.system.phone){i.setProperty("stretch",true);}i.open();},sectionNavigate:M1,onInlineDataFieldForAction:function(e){T.oCommonEventHandlers.onInlineDataFieldForAction(e,B.state);},onInlineDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),B.state);},onDeterminingDataFieldForAction:function(e){T.oCommonEventHandlers.onDeterminingDataFieldForAction(e);},onBeforeRebindChart:function(e){N(e);var i=e.getSource();i.getChartAsync().then(function(k){i.oModels=k.oPropagatedProperties.oModels;});var j={ensureExtensionFields:jQuery.noop,addExtensionFilters:q.templateBaseExtension.addFilters};T.oCommonUtils.onBeforeRebindTableOrChart(e,j);},onToggleDynamicSideContent:y.onToggleDynamicSideContent,sideContentBreakpointChanged:y.sideContentBreakpointChanged,onTableInit:function(e){var i;var n1=e.getSource();var j=n1.getTable();Q1(n1);T.oCommonUtils.checkToolbarIntentsSupported(n1);var k=(q&&typeof q.getView==="function"&&q.getView()&&q.getView().getId())+"--";var x=n1&&n1.getId();i=R1(k,x);u.oMultipleViewsHandler[i]&&u.oMultipleViewsHandler[i].init(e);if(j.isA("sap.m.Table")){var Z1=function(){L1(n1,j,i);};j.attachUpdateStarted(Z1,this);}else if(j.isA("sap.ui.table.Table")){L1(n1,j,i);}if(I(n1)&&!n1.data("CrossNavigation")){j.addEventDelegate({onkeyup:function(e){if(e.ctrlKey&&e.keyCode===K.ENTER&&n1.getEditable()){T.oCommonEventHandlers.addEntry(n1,true);e.preventDefault();e.setMarked();}}});}var $1=x.split("::Table")[0]+"::pasteEntries";var _1=T.oComponentUtils.getTemplatePrivateModel();if(I(n1)){j.addEventDelegate({onAfterRendering:function(e){var a2;if(n1.getEditable()&&!n1.hasListeners("paste")){q.byId($1)&&q.byId($1).setVisible(true);n1.attachBeforePaste(d1);n1.attachPaste(e1);a2=_1.getProperty("/objectPage/aPasteAttachedTables");if(a2){a2.push(i);}}}});}},onPasteButtonPress:function(e){var i=T.oCommonUtils.getText("DATA_PASTE_ACTION_MESSAGE");M.information(i);},onSearchObjectPage:V1,onSearchLiveChange:U1,onSmartTablePaste:e1,onUITableExpand:I1,onSingleVisibleSection:G1,onSingleVisibleSubSection:H1},formatters:{sideContentActionButtonText:y.formatSideContentActionButtonText,setNoDataTextForSmartTable:function(e){if(T.oCommonUtils&&e){var i=T.oCommonUtils.getContextText("NOITEMS_SMARTTABLE",e);if(i!=="NOITEMS_SMARTTABLE"){return i;}return"";}},setVMVisibilityForVendor:function(){var e=jQuery.sap.getUriParameters();if(e.mParams["sap-ui-layer"]){var j=e.mParams["sap-ui-layer"];for(var i=0;i<j.length;i++){if(j[i].toUpperCase()==="VENDOR"){return true;}}}return false;},formatItemTextForMultipleView:function(i){var e=i&&i.facetId;return u.oMultipleViewsHandler[e]?u.oMultipleViewsHandler[e].formatItemTextForMultipleView(i):"";}},extensionAPI:new E(T,q,B)};Y1.handlers=Object.assign(B.handlers,Y1.handlers);return Y1;}};return p;});
