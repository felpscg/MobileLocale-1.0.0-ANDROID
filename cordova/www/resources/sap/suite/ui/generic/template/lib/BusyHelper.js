sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/testableHelper","sap/base/Log"],function(B,M,t,L){"use strict";function g(T){var b={};var i=false;var a=false;var c=0;T.oNavigationHost.setBusyIndicatorDelay(0);var u=Promise.resolve();var U=jQuery.noop;var o={};function d(){return c!==0||!jQuery.isEmptyObject(b);}var A;function f(I){var e=d();if(e||I){a=false;T.oNavigationHost.setBusy(e);L.info("Physical busy state has been changed to "+e);if(e!==i){i=e;if(!i){var n=T&&T.oNavigationControllerProxy&&T.oNavigationControllerProxy.getActiveComponents();if(n){for(var p=0;p<n.length;p++){var q=n[p];if(!q){continue;}var C=T.componentRegistry&&T.componentRegistry[q]&&T.componentRegistry[q].oController;C&&C.adaptTransientMessageExtension&&C.adaptTransientMessageExtension();}}u=Promise.resolve();u=M.handleTransientMessages(T.oApplicationProxy.getDialogFragment,o.actionLabel);o={};u.then(U);}}}else{var N=T.oNavigationObserver.getProcessFinished(true);N.then(A,A);}}A=f.bind(null,true);function E(I){if(I){f();}else if(!a){a=true;setTimeout(f,0);}}function h(){c--;if(!c){E(false);}}function m(){if(i){return;}i=true;u=new Promise(function(r){U=r;});M.removeTransientMessages();}function l(n,p,r){var S=[],C="",q=T.oNavigationHost.getId(),v="sap.suite.ui.generic.template.busyHandling";try{throw new Error("Get the stack");}catch(e){S=e.stack.split(n,2);if(S.length>=2){S=S[1].split("\n");S.shift();}if(S.length){C=S[0].trim();}}if(L.getLevel(v)<L.Level.INFO){L.setLevel(L.Level.INFO,v);}L.info("busyHandling: "+n,r+" called",v,function(){var w={method:n,reason:r,promise:p,promisePending:true,caller:C,callStack:S,elementId:q,type:v};function P(){w.promisePending=false;}w.promise.then(P,P);return w;});}function s(r,I,e,S){var n;if(I){Object.assign(o,S);m();if(!b[r]){n=new Promise(function(p){b[r]=p;});if(sap.ui.support){l("setBusyReason",n,r);}}}else{if(b[r]){b[r]();}delete b[r];}E(I&&e);}function j(e,I,S){Object.assign(o,S);c++;m();e.then(h,h);E(I);if(sap.ui.support){l("setBusy",e,"");}}function k(){return 0;}return{setBusyReason:s,setBusy:j,isBusy:d,getUnbusy:function(){return u;},getBusyDelay:k};}return B.extend("sap.suite.ui.generic.template.lib.BusyHelper",{constructor:function(T){Object.assign(this,(t.testableStatic(g,"BusyHelper"))(T));}});});
