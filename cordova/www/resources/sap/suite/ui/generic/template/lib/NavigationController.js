/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/ComponentContainer","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/core/library","sap/suite/ui/generic/template/lib/ProcessObserver","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/testableHelper","sap/ui/fl/ControlPersonalizationAPI","sap/base/Log","sap/base/util/merge"],function(B,C,H,a,c,P,r,T,t,b,L,m){"use strict";var d=c.routing.HistoryDirection;var h=a.getInstance();var o=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");function f(R){var e=R.substring(R.length-5,R.length);if(e==="query"){return R.substring(0,R.length-5);}return R;}function n(s){if(s.indexOf("/")===0){return s;}return"/"+s;}function A(e){var D="";var R="";var j=Object.keys(e).sort();j.forEach(function(s){var v=e[s];if(Array.isArray(v)){var V=v.sort();for(var i=0;i<V.length;i++){var u=V[i];R=R+D+s+"="+u;D="&";}}else{R=R+D+s+"="+v;D="&";}});return R;}function g(s,e){s=s||"";var D=(s.charAt(s.length-1)==="/")?"?":"/?";return s+(e?D+e:"");}function k(s,e){var i=A(e);return g(s,i);}function l(i,R,j){var s=i.mRoutingTree[R.name];var u=R.template;var E=R.entitySet;var v=s.level;var O=-1;if(i.oFlexibleColumnLayoutHandler){O=v<3?v:0;}var w=O<0?i.oNavigationObserver:i.aNavigationObservers[O];var x=new P();var y=O<0?i.oHeaderLoadingObserver:i.aHeaderLoadingObservers[O];y.addObserver(x);var z={};var S={appComponent:i.oAppComponent,isLeaf:!R.pages||!R.pages.length,entitySet:E,navigationProperty:R.navigationProperty,componentData:{registryEntry:{oAppComponent:i.oAppComponent,componentCreateResolve:j,route:R.name,routeConfig:R,viewLevel:s.level,routingSpec:R.routingSpec,oNavigationObserver:w,oHeaderLoadingObserver:x,preprocessorsData:z}}};if(R.component.settings){Object.assign(S,R.component.settings);}var D;i.oAppComponent.runAsOwner(function(){try{var F=sap.ui.core.Component.create({name:u,settings:S,handleValidation:true,manifest:true});var G;D=new C({propagateModel:true,width:"100%",height:"100%",settings:S});G=F.then(function(I){D.setComponent(I);var s=i.mRoutingTree[R.name];s.componentId=I.getId();return D;});D.loaded=function(){return G;};}catch(e){throw new Error("Component "+u+" could not be loaded");}});return D;}function p(e,s){t.testable(l,"fnCreateComponentInstance");var u=!o||o.isInitialNavigation();var M={};var v={iHashChangeCount:0,backTarget:0,aCurrentKeys:[],componentsDisplayed:Object.create(null)};var w=[];var x=Promise.resolve();function G(){var i=s.oRouter,j=i.getTargets()._mTargets,Z1=[];Object.keys(j).forEach(function($1){var _1=j[$1],a2=_1._oOptions,b2=i.getRoute(a2.viewName),c2=b2&&b2._oConfig;if(c2&&(!c2.navigation||!c2.navigation.display)){Z1.push({oConfig:c2});}});return Z1;}t.testable(G,"fnGetAllPages");function y(i){var j=i||G();if(!Array.isArray(j)){j=[j];}j.forEach(function(Z1){Z1.oComponentContainer=l(e,Z1.oConfig,function(){});});return j;}t.testable(y,"fnCreatePages");function z(){var i=s.oRouter.getViews();i.getView({viewName:"root"});return e.mRouteToTemplateComponentPromise.root;}function D(){return s.oAppComponent.getManifestEntry("sap.app").title;}function E(i,j,Z1){var $1=i&&e.componentRegistry[i];var _1=$1&&$1.methods.getUrlParameterInfo;return _1?$1.viewRegistered.then(function(){var a2=j&&n(j);return _1(a2,v.componentsDisplayed[$1.route]===1).then(function(b2){Object.assign(Z1,b2);});}):Promise.resolve();}function F(i,j,Z1){var $1=e.mRoutingTree[i];return E($1.componentId,Z1,j);}function S(i,j){var Z1;if(!i&&j instanceof T){var $1=j&&e.componentRegistry[j.getId()];var _1=$1&&$1.methods.getTitle;Z1=_1&&_1();}else if(!i&&j&&j.title){Z1=j.title;}Z1=Z1||D();e.oShellServicePromise.then(function(a2){a2.setTitle(Z1);}).catch(function(){L.warning("No ShellService available");});}function I(i){var j=[e.oPagesDataLoadedObserver.getProcessFinished(true)];var Z1=null;var $1=v.iHashChangeCount;delete Q.componentsDisplayed;var _1=-1;for(var a2 in e.componentRegistry){var b2=e.componentRegistry[a2];var c2=b2.oControllerUtils&&b2.oControllerUtils.oServices.oTemplateCapabilities.oMessageButtonHelper;var d2=v.componentsDisplayed[b2.route]===1;var e2=b2.utils.getTemplatePrivateModel();e2.setProperty("/generic/isActive",d2);if(d2){j.push(b2.oViewRenderedPromise);if(b2.viewLevel>_1){_1=b2.viewLevel;Z1=b2.oComponent;}}else{b2.utils.suspendBinding();}if(c2){c2.setEnabled(d2);}}var f2=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.isAppTitlePrefered();S(f2,i||Z1);Promise.all(j).then(function(){if($1===v.iHashChangeCount&&jQuery.isEmptyObject(M)){e.oAppComponent.firePageDataLoaded();}});}var J=I.bind(null,null);function K(i,j){var Z1=[];for(var $1=i;$1.level>=j;$1=e.mRoutingTree[$1.parentRoute]){Z1.push($1);}return Z1.reverse();}function O(j,Z1,$1){if(j.level===0){return null;}var _1=$1?j.pattern:j.contextPath;if(!_1){return null;}if(_1.indexOf("/")!==0){_1="/"+_1;}for(var i=1;i<=j.level;i++){_1=_1.replace("{keys"+i+"}",Z1[i]);}return _1;}var R;var Q;var U;t.testable(function(i){Q=i;w.push(v);v={backTarget:0,componentsDisplayed:Object.create(null)};},"setCurrentIdentity");function V(){return Q;}function W(j,Z1){if(Array.isArray(j)&&j.length<2){j=j[0];}if(Array.isArray(Z1)&&Z1.length<2){Z1=Z1[0];}if(Array.isArray(j)){if(Array.isArray(Z1)){if(j.length===Z1.length){j=j.sort();Z1=Z1.sort();return j.every(function($1,i){return $1===Z1[i];});}return false;}return false;}return Z1===j;}function X(i){if(!Q||Q.treeNode!==i.treeNode){return false;}for(var j=i.treeNode;j.level>0;j=e.mRoutingTree[j.parentRoute]){if(!j.noKey&&i.keys[j.level]!==Q.keys[j.level]){return false;}}if(jQuery.isEmptyObject(i.appStates)!==jQuery.isEmptyObject(Q.appStates)){return false;}if(jQuery.isEmptyObject(i.appStates)){return true;}var Z1=Object.assign(Object.create(null),i.appStates,Q.appStates);for(var $1 in Z1){if(!W(i.appStates[$1],Q.appStates[$1])){return false;}}return true;}function Y(i,j,Z1){var $1=Object.create(null);for(var _1=i;_1.level>0;_1=e.mRoutingTree[_1.parentRoute]){if(!_1.noKey){$1["keys"+_1.level]=j[_1.level];}}var a2=!jQuery.isEmptyObject(Z1);var b2=i.sRouteName+(a2?"query":"");if(a2){$1["query"]=Z1;}return{route:b2,parameters:$1};}function Z(i){var j=Y(R.identity.treeNode,R.identity.keys,R.identity.appStates);s.oRouter.navTo(j.route,j.parameters,i);}function $(i){if(!i||!R.identity){return;}var j=function($1,_1,a2){a2=_1?_1.getId():a2;var b2=e.componentRegistry[a2];(b2.methods.presetDisplayMode||jQuery.noop)(i,$1);};for(var Z1=R.identity.treeNode;Z1;Z1=Z1.parentRoute&&e.mRoutingTree[Z1.parentRoute]){if(Z1.componentId){j(v.componentsDisplayed[Z1.sRouteName]===1,null,Z1.componentId);}else{e.mRouteToTemplateComponentPromise[Z1.sRouteName].then(j.bind(null,false));}if(Z1.fCLLevel===0||Z1.fCLLevel===3){break;}}}function _(i){var j;if(i){if(R||(Q&&Q.preset)){R={identity:i.identity,followUpNeeded:true};$(i.displayMode);return;}if(i.identity&&X(i.identity)){return;}j=i.mode;R=i;$(i.displayMode);delete R.displayMode;}else{j=1;}R.followUpNeeded=j<0;e.oBusyHelper.setBusyReason("HashChange",true);R.displayMode=0;if(j<0){window.history.go(j);}else{Z(j===1);}}function a1(i,j){i.text=((i.headerTitle!==j)&&j)||"";if(U&&U.linkInfos.length>i.level){U.adjustNavigationHierarchy();}}function b1(i,j){var Z1=Object.create(null);var $1=O(i,Q.keys);if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(Z1,i);}var _1={treeNode:i};var a2=E(i.componentId,$1,Z1).then(function(){var b2=Y(i,Q.keys,Z1);_1.fullLink=s.oRouter.getURL(b2.route,b2.parameters);});j.push(a2);_1.navigate=function(b2){e.oBusyHelper.setBusy(a2.then(function(){var c2={treeNode:i,keys:Q.keys.slice(0,i.level+1),appStates:Z1};m1(c2,false,b2);}));};_1.adaptBreadCrumbLink=function(b2){a2.then(function(){var g2=s.oHashChanger.hrefForAppSpecificHash?s.oHashChanger.hrefForAppSpecificHash(_1.fullLink):"#/"+_1.fullLink;b2.setHref(g2);});var c2=function(){a1(i,b2.getText());};if(!_1.bLinkAttached){_1.bLinkAttached=true;var d2=b2.getBindingInfo("text")||{};d2.events={change:c2};}var e2=b2.getElementBinding();var f2=e2&&e2.getPath();if(f2===$1){c2();}else{b2.bindElement({path:$1,canonicalRequest:!e.bCreateRequestsCanonical});}};return _1;}function c1(i,j){var Z1={title:j.treeNode.headerTitle||"",icon:j.treeNode.titleIconUrl||"",subtitle:j.treeNode.text,intent:i+j.fullLink};return Z1;}function d1(){var j=[];var Z1=[];var $1=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.hasNavigationMenuSelfLink(Q);for(var _1=$1?Q.treeNode:e.mRoutingTree[Q.treeNode.parentRoute];_1;_1=e.mRoutingTree[_1.parentRoute]){var a2=b1(_1,Z1);j[_1.level]=a2;}var b2=Promise.all(Z1);var c2=location.hash;var d2=c2.indexOf("?");var e2=(d2!==-1&&d2<c2.indexOf("&"))?"?":"&";var f2=c2.split(e2)[0]+"&/";var g2=function(){e.oShellServicePromise.then(function(h2){h2.setHierarchy([]);b2.then(function(){var i2=[];for(var i=j.length-1;i>=0;i--){i2.push(c1(f2,j[i]));}h2.setHierarchy(i2);});}).catch(function(){L.warning("No ShellService available");});};U={linkInfos:j,adjustNavigationHierarchy:g2};g2();}function e1(){return U.linkInfos;}function f1(i){var j=Q;if(R&&R.identity&&!R.followUpNeeded){Q=R.identity;}else{Q=Object.create(null);var Z1=i.getParameter("config");var $1=f(Z1.name);Q.treeNode=e.mRoutingTree[$1];var _1=i.getParameter("arguments");Q.appStates=_1["?query"]||Object.create(null);Q.keys=[""];for(var a2=Q.treeNode;a2.level>0;a2=e.mRoutingTree[a2.parentRoute]){Q.keys[a2.level]=a2.noKey?"":_1["keys"+a2.level];}}Q.previousIdentity=j;Q.componentsDisplayed=Object.create(null);Q.componentsDisplayed[Q.treeNode.sRouteName]=1;d1();}function g1(i,j){var Z1={identity:{treeNode:Q.treeNode,keys:Q.keys,appStates:Object.assign(Object.create(null),Q.appStates)},mode:1};if(Array.isArray(j)&&j.length<2){j=j[0];}if(j){Z1.identity.appStates[i]=j;}else{delete Z1.identity.appStates[i];}_(Z1);}var h1;function i1(i,j,Z1,$1){if(!i){z1(j);return;}var _1=n1(i);if(!_1){return;}_1.appStates=Object.create(null);var a2;if(_1.treeNode.fCLLevel===0||_1.treeNode.fCLLevel===3){var b2=O(_1.treeNode,_1.keys);a2=E(_1.treeNode.componentId,b2,_1.appStates);}else{a2=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(Q,_1);}if(!j&&$1&&$1.bIsCreate&&$1.bIsDraft&&!$1.bIsDraftModified){h1={index:w.length,path:i.getPath(),identity:_1,displayMode:r1()};}e.oBusyHelper.setBusy(a2.then(function(){m1(_1,j,Z1);}));}function j1(j){if(!h1||h1.path!==j.getPath()){return null;}var Z1;var $1=function(e2,i){return e2!==Z1.identity.keys[i];};for(var i=h1.index+1;i<w.length;i++){Z1=w[i];if(Z1.identity.treeNode.level<h1.identity.treeNode.level||h1.identity.keys.some($1)){return null;}}var _1=0;for(var a2=v;a2.iHashChangeCount!==h1.index;a2=w[a2.backTarget]){if(a2.iHashChangeCount<h1.index){return null;}_1--;}var b2=w[h1.index].identity;var c2={treeNode:b2.treeNode,keys:b2.keys,appStates:Object.create(null)};var d2=_.bind(null,{identity:c2,mode:_1,displayMode:h1.displayMode});if(b2.treeNode.fCLLevel===0||b2.treeNode.fCLLevel===3){Object.assign(c2.appStates,b2.appStates);return Promise.resolve(d2);}return e.oFlexibleColumnLayoutHandler.getSpecialDraftCancelPromise(Q,b2,c2.appStates).then(function(){return d2;});}function k1(i,Z1){var $1=r.determineNavigationPath(i);var _1={keys:["",$1.key],appStates:Object.create(null)};var a2=m1.bind(null,_1,true,Z1);if(Q.treeNode.level===1){_1.treeNode=Q.treeNode;Object.assign(_1.appStates,Q.appStates);return Promise.resolve(a2);}var b2=K(Q.treeNode,2);var c2=b2.map(function(j){if(j.noKey){return Promise.resolve(true);}if(!j.isDraft){return Promise.resolve(Q.keys[j.level]);}var e2=O(j,Q.keys);var f2=e.oApplicationProxy.getSiblingPromise(e2);return f2.then(function(i){$1=r.determineNavigationPath(i,j.navigationProperty);return $1.key;},jQuery.noop);});var d2=Promise.all(c2);return d2.then(function(e2){var f2=e.mEntityTree[$1.entitySet];for(var j=0;e2[j];j++){f2=b2[j];_1.keys.push(f2.noKey?"":e2[j]);}_1.treeNode=f2;if(f2===Q.treeNode){Object.assign(_1.appStates,Q.appStates);return a2;}var g2=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(f2,_1.appStates);return g2.then(function(){return a2;});});}function l1(i,j){if((i&&i.treeNode)!==j.treeNode){return Promise.resolve(false);}if(e.oFlexibleColumnLayoutHandler&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(i,j)){return Promise.resolve(false);}var Z1=true;var $1=i.treeNode.sRouteName;for(var _1=i.treeNode;_1.level>0;_1=e.mRoutingTree[_1.parentRoute]){var a2=_1.noKey||i.keys[_1.level]===j.keys[_1.level];if(!a2&&_1.noOData){return Promise.resolve(false);}Z1=Z1&&a2;if(_1.noOData){$1=_1.parentRoute;}}if(Z1){return Promise.resolve(true);}var b2=e.mRoutingTree[$1];var c2=i.keys.slice(0,b2.level+1);var d2=j.keys.slice(0,b2.level+1);var e2=O(b2,c2);var f2=O(b2,d2);return e.oApplicationProxy.areTwoKnownPathesIdentical(e2,f2,b2.level===1);}function m1(i,j,Z1){var $1=w[v.backTarget];var _1=-1;if(i.treeNode.level===0||(e.oFlexibleColumnLayoutHandler&&i.treeNode.fCLLevel===0)){for(;$1.backTarget>0&&$1.identity.treeNode.level>i.treeNode.level;_1--){$1=w[$1.backTarget];}}var a2=l1($1&&$1.identity,i);var b2=a2.then(function(c2){var d2=c2?_1:(0+!!j);var e2={identity:i,mode:d2,displayMode:Z1};_(e2);});e.oBusyHelper.setBusy(b2);return b2;}function n1(i){if(i){var j=r.determineNavigationPath(i);var Z1=e.mEntityTree[j.entitySet];var $1=Q.treeNode;for(;$1.level>Z1.level-1;){$1=e.mRoutingTree[$1.parentRoute];}if($1.sRouteName!==Z1.parentRoute){L.error("Navigation to context from entity set "+j.entitySet+" not possible while being on route "+Q.treeNode.sRouteName);return null;}var _1=Q.keys.slice(0,$1.level+1);_1.push(j.key);return{treeNode:Z1,keys:_1};}return{treeNode:e.mRoutingTree["root"],keys:[""]};}function o1(i,j,Z1){if(i.fCLLevel===0||i.fCLLevel===3){return E(i.componentId,null,j);}return e.oFlexibleColumnLayoutHandler[(i.level>Q.treeNode.level)?"getAppStatesPromiseForColumnOpen":"getAppStatesPromiseForColumnClose"](i,j,Z1);}function p1(i){var j=n1(i);j.appStates=Object.create(null);var Z1;if(j.treeNode===Q.treeNode){Object.assign(j.appStates,Q.appStates);Z1={identity:j,mode:1,displayMode:1};_(Z1);return;}var $1=o1(j.treeNode,j.appStates);e.oBusyHelper.setBusy($1.then(m1.bind(null,j,true,1)));}function q1(i){var j;var Z1=0;for(j=v;j.backTarget>0&&(!j.identity||j.identity.treeNode.level>i);Z1++){j=w[j.backTarget];}if(!u&&(Z1===0||j.identity.treeNode.level>i)){window.history.go(-Z1-1);return;}var $1=-Z1||1;var _1=Q1(i);var a2={treeNode:_1,keys:Q.keys.slice(0,_1.level+1),appStates:Object.create(null)};var b2=o1(a2.treeNode,a2.appStates).then(function(){if($1<0&&(a2.treeNode.fCLLevel===1||a2.treeNode.fCLLevel===2)&&j.identity.treeNode===a2.treeNode){for(;j.backTarget>0&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(j.identity,a2);$1--){j=w[j.backTarget];if(j.identity.treeNode!==a2.treeNode){break;}}}var c2={identity:a2,mode:$1,displayMode:a2.treeNode.isDraft?6:1};_(c2);});e.oBusyHelper.setBusy(b2);}function r1(){var i=e.componentRegistry[Q.treeNode.componentId];var j=i.utils.getTemplatePrivateModel();var Z1=j.getProperty("/objectPage/displayMode")||0;return Z1;}function s1(Z1,$1,_1,a2){var b2;var c2=true;for(var i=0;i<Q.treeNode.children.length&&!b2;i++){var d2=Q.treeNode.children[i];var e2=e.mEntityTree[d2];if(e2[Q.treeNode.level?"navigationProperty":"sRouteName"]===Z1){b2=e2.sRouteName;c2=!e2.noKey;}}var f2=!b2&&$1&&Q.treeNode.embeddedComponents[$1];if(f2){for(var j=0;j<f2.pages.length&&!b2;j++){var g2=f2.pages[j];if(g2.navigationProperty===Z1){b2=Q.treeNode.sRouteName+"/"+$1+"/"+Z1;c2=!(g2.routingSpec&&g2.routingSpec.noKey);}}}if(b2){var h2=e.mRoutingTree[b2];var i2=Q.keys.concat([c2?_1:""]);var j2=Object.create(null);var k2=o1(h2,j2,i2);k2.then(function(){var l2=r1();var m2={treeNode:h2,keys:i2,appStates:j2};m1(m2,a2,l2);});}}function t1(){return!!R;}function u1(i){L.info("Navigate back");if(v.backTarget&&n(h.getPreviousHash()||"")!==n(v.hash)){e.oBusyHelper.setBusyReason("HashChange",true);}v.LeaveByBack=!v.forwardingInfo;if(v.LeaveByBack){v.backSteps=i;}window.history.go(-i);}function v1(j,Z1,$1,_1){var a2=e.oAppComponent.getConfig();var b2=a2&&a2.settings&&a2.settings.objectPageDynamicHeaderTitleWithVM;if(!b2){if(a2&&a2.settings&&a2.settings.objectPageHeaderType==="Dynamic"){b2=(a2&&a2.settings&&a2.settings.objectPageVariantManagement==="VendorLayer")?true:false;}}var c2;var d2=jQuery.sap.getUriParameters();if(d2.mParams["sap-ui-layer"]){var e2=d2.mParams["sap-ui-layer"];for(var i=0;i<e2.length;i++){if(e2[i].toUpperCase()==="VENDOR"){c2=true;break;}}}j=n(j||"");L.info("Navigate to hash: "+j);if(j===v.hash){L.info("Navigation suppressed since hash is the current hash");return;}v.targetHash=j;if(v.backTarget&&n(h.getPreviousHash()||"")===j){u1(1);return;}if(v.oEvent){var f2=v.oEvent.getParameter("config").viewLevel;}if(b2&&c2){if(!_1){if(!e.oFlexibleColumnLayoutHandler){b.clearVariantParameterInURL();}else{if(f2>=$1){if($1===1){b.clearVariantParameterInURL();}else if($1===2){var g2;for(var h2 in e.componentRegistry){if(e.componentRegistry[h2].viewLevel===2){g2=e.componentRegistry[h2];break;}}var i2=g2.oController.byId("template::ObjectPage::ObjectPageVariant");b.clearVariantParameterInURL(i2);}}}}}e.oBusyHelper.setBusyReason("HashChange",true);v.LeaveByReplace=Z1;if(Z1){s.oHashChanger.replaceHash(j);}else{s.oHashChanger.setHash(j);}}function w1(i,j,Z1,$1,_1,a2){var b2=j.then(function(c2){i=g(i,c2);if(_1){v.backwardingInfo={count:_1.count,index:_1.index,targetHash:n(i)};u1(_1.count);}else{v1(i,$1,Z1,a2);}return i;});e.oBusyHelper.setBusy(b2);return b2;}function x1(i,j){var Z1,$1,_1,a2,b2,c2;Z1=0;$1=v.iHashChangeCount;_1=null;for(a2=v;a2.oEvent;Z1++){b2=a2.oEvent.getParameter("config");c2=b2?b2.viewLevel:-1;if(c2===0||(i&&n(a2.hash).indexOf(j)!==0)){_1={count:Z1,index:$1,routeName:b2?b2.name:undefined};break;}if(a2.backTarget===0){if(i){_1={count:Z1+1,index:$1,routeName:undefined};}break;}$1=a2.backTarget;a2=w[$1];}return _1;}function y1(i,j,Z1){if(Z1===0){return x1();}var $1=w[v.backTarget];return $1&&$1.hash&&n($1.hash.split("?")[0])===n(j)&&{count:1,index:v.backTarget};}function z1(i){if(Q.treeNode.level===0){return;}var j={treeNode:e.mRoutingTree["root"],keys:[""],appStates:Object.create(null)};var Z1=e.oFlexibleColumnLayoutHandler?e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(j.treeNode,j.appStates):F("root",j.appStates);Z1.then(m1.bind(null,j,i));e.oBusyHelper.setBusy(Z1);}function A1(i){var j=e.mEntityTree[i.entitySet].sRouteName;var Z1=e.mRouteToTemplateComponentPromise[j];return[Z1];}function B1(j,Z1){var $1=v.componentsDisplayed;var _1=function(b2){var c2=e.componentRegistry[b2.getId()];(c2.methods.presetDisplayMode||jQuery.noop)(Z1,$1[c2.route]===1);};for(var i=0;i<j.length;i++){var a2=j[i];a2.then(_1);}}function C1(i){var j=i&&e.mEntityTree[i.entitySet];var Z1=j?j.level:1;return Z1;}function D1(j,Z1){var $1=e.oApplicationProxy.getHierarchySectionsFromCurrentHash();var _1=j;for(var i=Z1-2;i>=0;i--){_1=$1[i]+"/"+_1;}return"/"+_1;}function E1(i,j,Z1,$1,_1){var a2={};var b2=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.getFCLAppStatesPromise(i,a2);var c2=F(i,a2,j);var d2=(b2?Promise.all([b2,c2]):c2).then(A.bind(null,a2));var e2=y1($1,j,Z1);var f2=w1(j,d2,Z1,$1,e2,_1);e.oBusyHelper.setBusy(f2);return f2;}function F1(j,Z1,$1,_1,a2,b2){var c2;var d2,e2,f2;var g2=[];if(typeof j==="string"){c2=j;var h2=n(c2);if(h2==="/"){d2=0;}else{f2=h2.split("/");d2=f2.length-1;}switch(d2){case 0:e2="root";break;case 1:e2=f2[1].split("(")[0];break;default:e2="";var i2="";for(var i=0;i<d2;i++){var j2=f2[i+1];var k2=j2.indexOf("(");if(k2>0){j2=j2.substring(0,k2);}e2=e2+i2+j2;i2="/";}e2=e2.replace("---","/");}}else{var l2=r.determineNavigationPath(j,Z1);d2=C1(l2);c2=l2.path;g2=A1(l2);e2=e.mEntityTree[l2.entitySet].sRouteName;}if(Z1){c2=D1(c2,d2);}B1(g2,_1||0);if(a2){c2=k(c2,a2);v1(c2,$1,d2,b2);return Promise.resolve(c2);}else{return E1(e2,c2,d2,$1,b2);}}function G1(i,j,Z1,$1,_1){return F1(i,j,Z1,$1,undefined,_1);}function H1(i,j){v.componentsDisplayed[i]=j;var Z1=e.mRoutingTree[i];var $1=Z1.componentId;if($1){var _1=e.componentRegistry[$1];var a2=_1.utils.getTemplatePrivateModel();a2.setProperty("/generic/isActive",j===1);}}function I1(i){var j,Z1,$1,_1,a2,b2=null,c2,d2;if(i){j=i.entitySet;Z1=i.text;b2=i.icon;d2=i.description;}if(j){c2=e.oAppComponent.getModel().getMetaModel();if(c2){$1=c2.getODataEntitySet(j);_1=c2.getODataEntityType($1.entityType);a2=_1["com.sap.vocabularies.UI.v1.HeaderInfo"];}if(a2&&a2.TypeImageUrl&&a2.TypeImageUrl.String){b2=a2.TypeImageUrl.String;}}e.oShellServicePromise.then(function(g2){if(g2.setBackNavigation){g2.setBackNavigation(undefined);}}).catch(function(){L.warning("No ShellService available");});e.oTemplatePrivateGlobalModel.setProperty("/generic/messagePage",{text:Z1,icon:b2,description:d2});if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.displayMessagePage(i,v.componentsDisplayed);}else{var e2=s.oRouter.getTargets();e2.display("messagePage");for(var f2 in v.componentsDisplayed){H1(f2,5);}}I(i);}function J1(){if(!jQuery.isEmptyObject(M)){var j=null;for(var i=0;!j;i++){j=M[i];}M={};I1(j);}}function K1(i){if(s.oTemplateContract.oFlexibleColumnLayoutHandler){i.viewLevel=i.viewLevel||0;M[i.viewLevel]=i;var j=Promise.all([x,s.oTemplateContract.oPagesDataLoadedObserver.getProcessFinished(true)]);j.then(J1);j.then(e.oBusyHelper.setBusyReason.bind(null,"HashChange",false));return;}I1(i);e.oBusyHelper.setBusyReason("HashChange",false);}function L1(){var i=[];var j=Q.componentsDisplayed||v.componentsDisplayed;for(var Z1 in e.componentRegistry){var $1=e.componentRegistry[Z1];if(j[$1.route]===1){i.push(Z1);}}return i;}function M1(){var i=[];for(var j in e.componentRegistry){i.push(j);}return i;}function N1(i){return Q.keys.slice(0,i+1);}function O1(j){var Z1="";var $1=v.hash;var _1=$1.split("/");var a2="";for(var i=0;i<=j;i++){Z1=Z1+a2+_1[i];a2="/";}return Z1;}function P1(){return v;}function Q1(i){var j=Q.treeNode;for(;j.level>i;){j=e.mRoutingTree[j.parentRoute];}return j;}function R1(i,j,Z1){var $1=Z1.getId();var _1=e.componentRegistry[$1];var a2=_1.route;var b2=j.componentsDisplayed[a2];var c2=b2===1;v.componentsDisplayed[a2]=1;var d2=Z1.onActivate(i,c2)||Promise.resolve();return Promise.all([d2,_1.viewRegistered]).then(function(){_1.aKeys=N1(_1.viewLevel);});}function S1(i,j,Z1){return R1(i,j,Z1).then(J);}function T1(i,j,Z1){var $1={};if(j||Z1){var _1=i.level;for(var a2=0;a2<_1;a2++){$1[a2]=e.oPaginatorInfo[a2];}}e.oPaginatorInfo=$1;}function U1(i){return e.oApplicationProxy.getAlternativeContextPromise(i);}function V1(i){f1(i);Q.preset=true;if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.handleBeforeRouteMatched(Q);}}function W1(j){if(R&&R.followUpNeeded&&R.identity&&!X(R.identity)){_();return;}e.oBusyHelper.setBusyReason("HashChange",false);var Z1=Q.treeNode.level;var $1=n(s.oHashChanger.getHash()||"");L.info("Route matched with hash "+$1);var _1;if(v.backwardingInfo){_1=v;_1.identity=Q.previousIdentity;delete Q.previousIdentity;w.push(_1);var a2=_1.iHashChangeCount+1;v={iHashChangeCount:a2,forwardingInfo:{bIsProgrammatic:true,bIsBack:true,iHashChangeCount:a2,targetHash:_1.backwardingInfo.targetHash,componentsDisplayed:_1.componentsDisplayed},backTarget:w[_1.backwardingInfo.index].backTarget,componentsDisplayed:Object.create(null)};}if(v.forwardingInfo&&v.forwardingInfo.targetHash&&v.forwardingInfo.targetHash!==$1){v.hash=$1;var b2=v.forwardingInfo.targetHash;delete v.forwardingInfo.targetHash;v1(b2,true);return;}var c2=false;for(var i=0;i<e.aStateChangers.length;i++){var d2=e.aStateChangers[i];if(d2.isStateChange(Q.appStates)){c2=true;}}if(c2){R=null;v.hash=$1;return;}e.oTemplatePrivateGlobalModel.setProperty("/generic/routeLevel",Z1);var e2=v.forwardingInfo;delete v.forwardingInfo;if(!e2){e2={componentsDisplayed:v.componentsDisplayed};var f2=v.iHashChangeCount;e2.iHashChangeCount=f2+1;var g2=h.getDirection();if(R){e2.bIsProgrammatic=!!R.identity;e2.bIsBack=R.mode<0;if(e2.bIsBack){v.backSteps=0-R.mode;}e2.bIsForward=!e2.bIsBack&&(g2===d.Forwards);v.LeaveByReplace=R.mode===1;}else{e2.bIsProgrammatic=($1===v.targetHash);e2.bIsBack=!!(v.LeaveByBack||(!e2.bIsProgrammatic&&(g2===d.Backwards)));e2.bIsForward=!e2.bIsBack&&(g2===d.Forwards);v.LeaveByReplace=e2.bIsProgrammatic&&v.LeaveByReplace;}v.LeaveByBack=e2.bIsBack;_1=v;_1.identity=Q.previousIdentity;delete Q.previousIdentity;w.push(_1);v={iHashChangeCount:e2.iHashChangeCount,componentsDisplayed:Object.create(null)};if(_1.LeaveByReplace){v.backTarget=_1.backTarget;}else if(e2.bIsBack){var h2=_1.backTarget;for(var i2=_1.backSteps||1;i2>0;i2--){h2=w[h2].backTarget;}v.backTarget=h2;}else{v.backTarget=f2;}}R=null;v.oEvent=j;v.hash=$1;var j2=function(l2){var m2=j.getParameter("arguments");if(l2){var n2=m2["?query"];v.forwardingInfo=e2;F1(l2.context,null,true,l2.iDisplayMode,n2||{});return;}T1(Q.treeNode,e2.bIsProgrammatic,e2.bIsBack);if(e.oFlexibleColumnLayoutHandler){x=e.oFlexibleColumnLayoutHandler.handleRouteMatched(e2);}else{if(Z1===0||e2.bIsBack||!e2.bIsProgrammatic){e.oApplicationProxy.setEditableNDC(false);}var o2=e.mRouteToTemplateComponentPromise[Q.treeNode.sRouteName];x=o2.then(function(p2){return S1(O(Q.treeNode,Q.keys),e2,p2);});}e.oBusyHelper.setBusy(x);};if(e2.bIsBack){var k2=O(Q1(1),Q.keys);e.oBusyHelper.setBusy(U1(k2).then(j2));}else{j2();}}function X1(i){if(Q&&Q.preset){delete Q.preset;}else{f1(i);}i=m({},i);var j=e.oStatePreserversAvailablePromise.then(W1.bind(null,i),e.oBusyHelper.setBusyReason.bind(null,"HashChange",false));e.oBusyHelper.setBusy(j);}function Y1(){Q={appStates:Object.create(null),keys:[]};K1({title:e.getText("ST_ERROR"),text:e.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:""});}if(e.sRoutingType==="f"){s.oRouter.attachBeforeRouteMatched(V1);}s.oRouter.attachRouteMatched(X1);s.oRouter.attachBypassed(Y1);s.concatPathAndAppStates=k;s.navigate=v1;s.activateOneComponent=R1;s.afterActivation=J;s.addUrlParameterInfoForRoute=F;s.getApplicableStateForComponentAddedPromise=E;s.setVisibilityOfRoute=H1;s.getActiveComponents=L1;s.getAllComponents=M1;s.getRootComponentPromise=z;s.getActivationInfo=P1;s.getCurrentKeys=N1;s.getCurrentHash=O1;s.getAppTitle=D;s.navigateByExchangingQueryParam=g1;s.navigateToSubContext=i1;s.getSwitchToSiblingPromise=k1;s.getSpecialDraftCancelPromise=j1;s.getCurrentIdentity=V;s.navigateToIdentity=m1;s.navigateAfterActivation=p1;s.navigateUpAfterDeletion=q1;s.navigateToChild=s1;s.isNavigating=t1;s.getLinksToUpperLayers=e1;s.setTextForTreeNode=a1;s.determinePathForKeys=O;s.createComponentInstance=l;return{navigateToRoot:z1,navigateToContext:G1,navigateToMessagePage:K1,navigateBack:u1.bind(null,1)};}function q(e,i){var j={oAppComponent:i.oAppComponent,oRouter:i.oAppComponent.getRouter(),oTemplateContract:i,oHashChanger:H.getInstance(),mRouteToComponentResolve:{}};i.oNavigationControllerProxy=j;var F=new Promise(function(R){j.fnInitializationResolve=R;});i.oBusyHelper.setBusy(F);Object.assign(e,p(i,j));Object.assign(j,e);j.oRouter._oViews._getViewWithGlobalId=function(v){v.viewName=v.name||v.viewName;for(var s in i.componentRegistry){if(i.componentRegistry[s].route===v.viewName){return i.componentRegistry[s].oComponent.getComponentContainer();}}var R=j.oRouter.getRoute(v.viewName);var u;if(R&&R._oConfig){u=l(i,R._oConfig,j.mRouteToComponentResolve[v.viewName]);}else{u=sap.ui.view({viewName:v.viewName,type:v.type,height:"100%"});}if(v.viewName==="root"){i.rootContainer=u;}return u.loaded();};r.startupRouter(j);}var N=B.extend("sap.suite.ui.generic.template.lib.NavigationController",{metadata:{library:"sap.suite.ui.generic.template"},constructor:function(e){B.apply(this,arguments);t.testableStatic(q,"NavigationController")(this,e);}});N._sChanges="Changes";return N;});
