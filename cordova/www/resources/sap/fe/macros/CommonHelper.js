/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/macros/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/base/Log","./StableIdHelper"],function(R,O,L,S){"use strict";var H={getStableId:S.generate,getTargetCollection:function(c,n){var p=c.getPath(),P,e,a;if(c.getObject("$kind")==="EntitySet"){return p;}P=p.split("/").filter(Boolean);e="/"+P[0];a=typeof n==="undefined"?P[P.length-1]:n;return e+"/$NavigationPropertyBinding/"+a;},isPropertyFilterable:function(p,i){var e,P,I=false,m=i.context.getModel(),s=i.context.getPath();if(m.getObject(s+"@com.sap.vocabularies.UI.v1.Hidden")){return false;}if(m.getObject(s+"@com.sap.vocabularies.UI.v1.HiddenFilter")){return false;}e=H._getEntitySetPath(m,s);if(typeof p==="string"){P=p;}else{P=m.getObject(s+"@sapui.name");}if(P.indexOf("/")<0){I=H._isInNonFilterableProperties(m,e,P);}else{I=H._isContextPathFilterable(m,e,P);}return!I;},_isInNonFilterableProperties:function(m,e,c){var i=false;var a=m.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");if(a&&a.NonFilterableProperties){i=a.NonFilterableProperties.some(function(p){return p.$NavigationPropertyPath===c||p.$PropertyPath===c;});}return i;},_isContextPathFilterable:function(m,e,c){var C=c.split("/"),i=false,s="";C.some(function(a,b,d){if(s.length>0){s+="/"+a;}else{s=a;}if(b===d.length-1){i=H._isInNonFilterableProperties(m,e,s);}else if(m.getObject(e+"/$NavigationPropertyBinding/"+a)){i=H._isInNonFilterableProperties(m,e,s);s="";e="/"+m.getObject(e+"/$NavigationPropertyBinding/"+a);}return i===true;});return i;},replaceSpecialCharsInId:function(i){if(i.indexOf(" ")>=0){L.error("Annotation Helper: Spaces are not allowed in ID parts. Please check the annotations, probably something is wrong there.");}return i.replace(/@/g,"").replace(/\//g,"::").replace(/#/g,"::");},formatDraftLockText:function(I,a,b){if(!I){return R.getText("draft.DRAFT_OBJECT");}else if(a){if(b){return R.getText("draft.LOCKED_OBJECT");}else{return R.getText("draft.UNSAVED_CHANGES");}}else{return"";}},_getEntitySetPath:function(m,p){var l;var e=p.slice(0,p.indexOf("/",1));if(m.getObject(e+"/$kind")==="EntityContainer"){l=e.length+1;e=p.slice(l,p.indexOf("/",l));}return e;},_resolveValueHelpField:function(c){var v=c.getModel();var V=v.getObject("/");return V.$model.getMetaModel().createBindingContext("/"+V.CollectionPath+"/"+c.getObject());},gotoTargetEntitySet:function(c){var p=H.getTargetCollection.call(H,c);return p+"/$";},gotoActionParameter:function(c){var p=c.getPath(),P=c.getObject(p+"/$Name"),C=p.indexOf("@$ui5.overload")>-1?p.split("@$ui5.overload"):p.split("0");return C[0]+P;},getEditMode:function(a,d,f,D,e,p,r,s){if(s){return false;}if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return e;}var c,i,b,g,E,C,h,I,j;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(a&&a["@com.sap.vocabularies.Common.v1.SemanticObject"]&&!(a["@com.sap.vocabularies.Common.v1.ValueListReferences"]||a["@com.sap.vocabularies.Common.v1.ValueListMapping"]||a["@com.sap.vocabularies.Common.v1.ValueList"]||a["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]))){return"Display";}if(a&&a["@Org.OData.Core.V1.Computed"]){c=a["@Org.OData.Core.V1.Computed"].Bool?a["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(a&&a["@Org.OData.Core.V1.Immutable"]){i=a["@Org.OData.Core.V1.Immutable"].Bool?a["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}b=c||i;h=typeof c==="undefined"?typeof i==="undefined"||i:!c;if(f){if(f.indexOf("{")===0){I="$"+f+" === '1'";j="$"+f+" === '0'";}else{b=b||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}}var k;var l;var m;if(p==="Form"){l=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly' : 'Display'";m=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}else{l="'Display'";m="'Display'";}C=e&&e.indexOf("{")===0?"$"+e:"'"+e+"'";if(b){if(!h||!D){if(e&&e.indexOf("{")===0&&p==="Form"){return r?false:"{= "+l+"}";}l=l.split("'")&&l.split("'")[1];return r?false:l;}else{if(I){return("{= !%{IsActiveEntity} && !%{HasActiveEntity} ? ("+j+"? "+(r?"false":"Disabled")+" : "+I+"? "+(r?"false":"ReadOnly")+" : "+(r?"${ui>/editable} === 'Editable'":C)+") : "+(r?"false":l)+"}");}else if(f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){C="'ReadOnly'";}return("{= !%{IsActiveEntity} && !%{HasActiveEntity} ?"+(r?"${ui>/editable} === 'Editable'":C)+" : "+(r?"false":l)+"}");}}if(I){g=j+" ? "+(r?"false":m)+" :"+I+" ? "+(r?"false":l)+" :"+(r?"${ui>/editable} === 'Editable'":C);k="{= "+g+"}";}else{g=C;k=r?"{= ${ui>/editable} === 'Editable'}":e;}E=h||!D?k:"{= !%{IsActiveEntity} && !%{HasActiveEntity} ? "+(r?"false":l)+" : "+g+"}";return E;},getNavigationContext:function(c){return O.getNavigationPath(c.getPath());}};H.isPropertyFilterable.requiresIContext=true;return H;},true);
