/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/mdc/library','sap/ui/base/ManagedObjectObserver','sap/ui/mdc/base/FieldBase','sap/ui/mdc/base/FieldBaseRenderer','sap/ui/mdc/base/Condition','sap/base/util/deepEqual','sap/base/util/merge'],function(l,M,F,a,C,d,m){"use strict";var b=l.FieldDisplay;var c=F.extend("sap.ui.mdc.Field",{metadata:{library:"sap.ui.mdc",properties:{value:{type:"any",defaultValue:null},additionalValue:{type:"any",defaultValue:null}},events:{change:{parameters:{value:{type:"string"},valid:{type:"boolean"},promise:{type:"Promise"}}}},defaultProperty:"value"},renderer:a});c.prototype.init=function(){this._vValue=null;this._vAdditionalValue=null;F.prototype.init.apply(this,arguments);this.setMaxConditions(1);this.setProperty("_onlyEEQ",true,true);this._oObserver.observe(this,{properties:["value","additionalValue"]});};c.prototype.exit=function(){F.prototype.exit.apply(this,arguments);if(this._iConditionUpdateTimer){clearTimeout(this._iConditionUpdateTimer);delete this._iConditionUpdateTimer;}};c.prototype.bindProperty=function(n,B){if(n==="value"&&!B.formatter){B.targetType="raw";if(!this._oDataType&&B.type){this._oDataType=B.type;}}F.prototype.bindProperty.apply(this,arguments);};c.prototype._handleModelContextChange=function(E){F.prototype._handleModelContextChange.apply(this,arguments);if(!this._oDataType){var B=this.getBinding("value");if(B){this._oDataType=B.getType();}}if(this.getBinding("additionalValue")){this.getBinding("additionalValue").checkUpdate(true);}};c.prototype._initDataType=function(){F.prototype._initDataType.apply(this,arguments);var B=this.getBinding("value");if(B){this._oDataType=B.getType();}};c.prototype.setMaxConditions=function(n){if(n!==1){throw new Error("Only one condition allowed for Field "+this);}return this.setProperty("maxConditions",n,true);};c.prototype._observeChanges=function(o){F.prototype._observeChanges.apply(this,arguments);if(o.name==="value"){this._vValue=h.call(this,o.current,o.old);j.call(this,o.current);f.call(this);}if(o.name==="additionalValue"){this._vAdditionalValue=o.current;f.call(this);}if(o.name==="conditions"){k.call(this,o.current);}};function _(){return this._vValue;}function e(){return this._vAdditionalValue;}function f(){if(this.getDisplay()===b.Value){g.call(this,_.call(this),e.call(this));}else if(!this._iConditionUpdateTimer){this._iConditionUpdateTimer=setTimeout(function(){g.call(this,_.call(this),e.call(this));this._iConditionUpdateTimer=undefined;}.bind(this),0);}}function g(v,A){var n=this.getConditions();if(this._checkValueInitial(v)&&!A){if(n.length>0){this.setConditions([]);}}else{var o=n[0]&&n[0].values[0];var O=n[0]&&n[0].values[1]?n[0].values[1]:null;if(!n[0]||n[0].operator!=="EEQ"||!i.call(this,o,v)||O!==A){var p=C.createItemCondition(v,A);this.setConditions([p]);}}}function h(v,o){var D=this._oDataType?this._oDataType.getMetadata().getName():this.getDataType();if(v&&o&&(D==="sap.ui.model.odata.type.Unit"||D==="sap.ui.model.odata.type.Currency")&&!v[2]&&o[2]!==undefined){v=m([],v);v[2]=o[2];}return v;}function i(v,V,u){var E=v===V;var D=this._oDataType?this._oDataType.getMetadata().getName():this.getDataType();if(!E&&(D==="sap.ui.model.odata.type.Unit"||D==="sap.ui.model.odata.type.Currency"||D==="sap.ui.model.type.Unit"||D==="sap.ui.model.type.Currency")&&Array.isArray(v)&&Array.isArray(V)){var n=v[0];var U=v[1];var o=v.length>=3?v[2]:null;var N=V[0];var p=V[1];var q=V.length>=3?V[2]:null;if(n===N&&U===p&&(((this._bUnitSet||u)&&(!o||!q))||d(o,q))){E=true;}if((o||q)&&!u){this._bUnitSet=true;}}return E;}function j(v){if(!this._bTypeInitialized){var B=this.getBinding("value");var D=B&&B.getType();if(D&&(D.isA("sap.ui.model.odata.type.Unit")||D.isA("sap.ui.model.odata.type.Currency"))&&Array.isArray(v)&&v.length>2&&v[2]!==undefined){D.formatValue(v,"string");this._bTypeInitialized=true;this._mCustomUnits=v[2];}}}c.prototype._fireChange=function(n,v,w,p){var V;if(n){if(v){V=this._getResultForPromise(n);}else{V=w;}}this.fireChange({value:V,valid:v,promise:p});};c.prototype._getResultForPromise=function(n){var v;if(n.length===0&&this._oDataType){v=this._oDataType.parseValue("","string",[]);}else if(n.length===1){v=n[0].values[0];}return v;};function k(n){var v=null;var A=null;var o=this.getValue();var O=this.getAdditionalValue();if(n.length===0&&o===null&&O===null){return;}v=this._getResultForPromise(n);if(n.length===0&&!O){A=O;}else if(n.length===1&&n[0].values.length>1){A=n[0].values[1];}this._vValue=v;this._vAdditionalValue=A;if(!i.call(this,v,o,true)){this.setProperty("value",v,true);}if(A!==O){this.setProperty("additionalValue",A,true);}}return c;},true);
