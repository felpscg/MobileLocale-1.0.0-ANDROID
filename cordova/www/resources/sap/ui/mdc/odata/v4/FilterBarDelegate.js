/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/FilterBarDelegate","sap/ui/mdc/library","sap/ui/core/format/DateFormat"],function(F,m,D){"use strict";var O=Object.assign({},F);var d={"Edm.Boolean":"Bool","Edm.Byte":"Int","Edm.DateTime":"Date","Edm.DateTimeOffset":"DateTimeOffset","Edm.Decimal":"Decimal","Edm.Double":"Float","Edm.Float":"Float","Edm.Guid":"Guid","Edm.Int16":"Int","Edm.Int32":"Int","Edm.Int64":"Int","Edm.SByte":"Int","Edm.Single":"Float","Edm.String":"String","Edm.Time":"TimeOfDay"};O.fetchProperties=function(M,e){var p=[],o,E,s,a;var n=[],r=[],S=[],A={};var l;if(e){return new Promise(function(b){s='/'+e;a=M.getMetaModel();var c=a.getObject(s+"@Org.OData.Capabilities.V1.FilterRestrictions");if(c){if(c.NonFilterableProperties){c.NonFilterableProperties.every(function(P){n.push(P.$PropertyPath);return true;});}if(c.RequiredProperties){c.RequiredProperties.every(function(P){r.push(P.$PropertyPath);return true;});}if(c.FilterExpressionType){c.FilterExpressionType.every(function(P){A[P.Property.$PropertyPath]=P.AllowedExpressions;return true;});}}c=a.getObject(s+"/"+"@com.sap.vocabularies.UI.v1.SelectionFields");if(c){c.every(function(P){S.push(P.$PropertyPath);return true;});}var h,v,V,R,f,g,P,C,i;E=a.getObject(s+"/");for(var k in E){o=E[k];if(o&&o.$kind==="Property"){if(n.indexOf(k)>=0){continue;}if(a.getObject(s+"/"+k+"@com.sap.vocabularies.UI.v1.Hidden")){continue;}h=false;if(a.getObject(s+"/"+k+"@com.sap.vocabularies.UI.v1.HiddenFilter")){h=true;}i=false;if(a.getObject(s+"/"+k+"@com.sap.vocabularies.Common.v1.IsDigitSequence")){i=true;}v=null;g=a.getObject(s+"/"+k+"@com.sap.vocabularies.Common.v1.FilterDefaultValue");if(g){V=g["$"+d[o.$Type]];switch(o.$Type){case"Edm.DateTimeOffset":v=O._parseDateTimeOffset(V);break;default:v=V;}}R=(r.indexOf(k)>=0)?true:false;f=(S.indexOf(k)>=0)?true:false;l=a.getObject(s+"/"+k+"@com.sap.vocabularies.Common.v1.Label")||k;if(o.$MaxLength||o.$Precision||o.$Scale||i){C={};if(o.$MaxLength){C.maxLength=o.$MaxLength;}if(o.$Precision){C.precision=o.$Precision;}if(o.$Scale){C.precision=o.$Scale;}if(i){C.isDigitSequence=i;}}else{C=null;}P={name:k,label:l,type:o.$Type,required:R,hiddenFilter:h,visible:f};if(C){P.constraints=C;}if(v){P.defaultFilterConditions=[{fieldPath:k,operator:"EQ",values:[v]}];}if(A[k]){P.filterExpression=A[k];}else{P.filterExpression="auto";}p.push(P);}}b(p);});}else{return Promise.resolve([]);}};O._parseDateTimeOffset=function(s){var a="\\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12]\\d|3[01])",t="(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(\\.\\d{1,12})?)?",r=new RegExp("^"+a+"T"+t+"(?:Z|[-+](?:0\\d|1[0-3]):[0-5]\\d|[-+]14:00)$","i"),o,M=r.exec(s);if(M){if(M[1]&&M[1].length>4){s=s.replace(M[1],M[1].slice(0,4));}o=D.getDateTimeInstance({pattern:"yyyy-MM-dd'T'HH:mm:ss.SSSX",strictParsing:true}).parse(s.toUpperCase());}if(!o){throw new Error("Not a valid Edm.DateTimeOffset value: "+s);}return o;};return O;},false);
