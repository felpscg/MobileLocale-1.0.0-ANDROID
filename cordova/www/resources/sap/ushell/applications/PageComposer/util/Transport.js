// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/Config","sap/ui/model/odata/v2/ODataModel","sap/ui/core/Component","sap/ushell/applications/PageComposer/i18n/resources"],function(C,O,a,r){"use strict";var T=function(){};T.prototype._getODataModel=function(){if(!this._oODataModel){var t=C.last("/core/pageComposition/transport/serviceUrl");this._oODataModel=new O({serviceUrl:t,headers:{"sap-language":sap.ushell.Container.getUser().getLanguage()},defaultCountMode:"None",skipMetadataAnnotationParsing:true,useBatch:false});}return this._oODataModel;};T.prototype._getTransportLockedInformation=function(p){return this._readTransportInformation(p).then(function(t){return t.results.length?t.results[0]:true;});};T.prototype._readTransportInformation=function(p){var u="/transportSet";var f=new sap.ui.model.Filter("pageId",sap.ui.model.FilterOperator.EQ,p);return new Promise(function(b,c){this._getODataModel().read(u,{filters:[f],success:b,error:c});}.bind(this));};T.prototype._isPackageTransportRequired=function(p){return this._readPackageInformation(p).then(function(b){return b.transportRequired;});};T.prototype._readPackageInformation=function(p){var u="/packageSet('"+encodeURIComponent(p)+"')";return new Promise(function(b,c){this._getODataModel().read(u,{success:b,error:c});}.bind(this));};T.prototype._showTransport=function(p){var P=p.metadata.devclass;if(p&&p.metadata&&!p.metadata.transportId){return this._isPackageTransportRequired(P);}return Promise.resolve(false);};T.prototype._changeHandler=function(d){return function(v){var m=d.getModel();var V=jQuery.extend({},m.getProperty("/validation"),{transport:v});m.setProperty("/validation",V);};};T.prototype.isTransportSupported=function(){return C.last("/core/pageComposition/transport/support");};T.prototype.enhanceDialogWithTransport=function(d,t,o){var c=this._changeHandler(d);c(false);var f=function(p){var P=t.decorateResultWithTransportInformation(p);o(P);};t.attachChangeEventHandler(c);d.attachConfirm(f);d.transportExtensionPoint(t);return d;};T.prototype.checkShowTransport=function(p){if(!this.isTransportSupported()){return Promise.resolve(false);}return this._showTransport(p).then(function(s){return s;});};T.prototype.checkShowLocked=function(p){if(!this.isTransportSupported()){return Promise.resolve(false);}return this._getTransportLockedInformation(p.content.id).then(function(t){if(t.foreignOwner){return t;}return false;});};if(!this.transportHelper){this.transportHelper=new T();}return this.transportHelper;});
