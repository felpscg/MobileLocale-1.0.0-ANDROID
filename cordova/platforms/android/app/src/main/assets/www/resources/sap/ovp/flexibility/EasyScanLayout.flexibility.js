sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/flexibility/changeHandler/CardChangeHandler","sap/ovp/flexibility/changeHandler/RemoveCardContainer","sap/ui/dt/OverlayRegistry","sap/ui/core/ComponentContainer","sap/m/MessageToast","sap/ovp/cards/rta/SettingsDialogConstants","sap/ovp/cards/SettingsUtils","sap/ovp/cards/CommonUtils","sap/ovp/app/resources","sap/base/util/merge"],function(q,C,R,O,a,M,S,b,c,d,m){"use strict";return{"moveControls":{"changeHandler":"default","layers":{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"unhideControl":C.UnhideControlConfig,"unhideCardContainer":C.UnhideCardContainer,"hideCardContainer":C.HideCardContainer,"removeCardContainer":R,"editCardSettings":{changeHandler:{applyChange:function(o,e,p){var f=p.appComponent.getRootControl(),g=f.getController(),h=o.getContent(),i=h.newAppDescriptor,j=f.byId(i.id);o.setRevertData(h.oldAppDescriptor);if(j){if(i.settings.tabs){var D=i.settings.selectedKey;if(!D||D<1){D=1;}S.tabFields.forEach(function(l){var v=i.settings.tabs[D-1][l];if(l!=='entitySet'||(l==='entitySet'&&v)){delete i.settings[l];}if(v){i.settings[l]=v;}});}var k=j.getComponentInstance();k.destroy();}g.recreateRTAClonedCard(i);return true;},revertChange:function(o,e,p){var f=p.appComponent.getRootControl(),g=f.getController(),h=o.getRevertData(),i=f.byId(h.id);if(i){var j=i.getComponentInstance();j.destroy();}g.recreateRTAClonedCard(h);o.resetRevertData();return true;},completeChangeContent:function(o,s,p){return;}},layers:{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"newCardSettings":{changeHandler:{applyChange:function(o,e,p){var f=p.appComponent.getRootControl(),g=f.getController(),h=o.getContent();o.setRevertData(h.id);var n=new a(f.getId()+"--"+h.id),A=p.appComponent,u=g.getUIModel(),j=u.getProperty("/cards"),k=g.getLayout(),N=(h.id.indexOf("newStaticLinkListCard_N")!==-1)&&!b.checkClonedCard(h.id),l=(h.id.indexOf("newKPICard_N")!==-1)&&!b.checkClonedCard(h.id),r=(h.id.indexOf("newCard_N")!==-1)&&!b.checkClonedCard(h.id),s=b.newDataSource;if(l){var t=h.settings.selectedKPI,v=new sap.ui.model.odata.v2.ODataModel(t.ODataURI,{'annotationURI':t.ModelURI,'defaultCountMode':sap.ui.model.odata.CountMode.None}),w=h.model;if(h.settings["sAnnoKey"]){b.setDataSources(h.settings["sAnnoKey"],t.ModelURI);}f.setModel(v,w);A.setModel(v,w);}if(s&&!A.getModel(h.model)){var x=new sap.ui.model.odata.v2.ODataModel(b.newDataSourceModel.serviceURI,{'annotationURI':b.newDataSourceModel.serviceAnnotationURI,'defaultCountMode':sap.ui.model.odata.CountMode.None}),w=h.model;b.setDataSources(b.newDataSourceModel.serviceAnnotation,b.newDataSourceModel.serviceAnnotationURI);f.setModel(x,w);A.setModel(x,w);}h.settings.baseUrl=g._getBaseUrl();if(N||l||r){h.settings.newCard=true;}else{h.settings.cloneCard=true;}var I=-1,i;for(i=0;i<j.length;i++){if(h.id.lastIndexOf(c._getLayerNamespace()+"."+j[i].id,0)===0){I=i;break;}}j.splice(I+1,0,h);u.setProperty("/cards",j);k.insertContent(n,I+1);setTimeout(function(){var y=O.getOverlay(n);y.setSelected(true);y.focus();var z=(N||l||r)?d.getText("OVP_KEYUSER_TOAST_MESSAGE_FOR_NEW"):d.getText("OVP_KEYUSER_TOAST_MESSAGE_FOR_CLONE");M.show(z,{duration:10000});},0);g.recreateRTAClonedCard(h);return true;},revertChange:function(o,e,p){var f=p.appComponent.getRootControl(),A=p.appComponent,g=f.getController(),s=o.getRevertData(),h=o.getContent();var j=f.byId(s),u=g.getUIModel(),k=u.getProperty("/cards"),l=g.getLayout();var I=-1,i;for(i=0;i<k.length;i++){if(s===k[i].id){I=i;break;}}k.splice(I,1);u.setProperty("/cards",k);if(j){var n=j.getComponentInstance(),r=n.getComponentData(),N=(r.cardId.indexOf("newKPICard_N")!==-1)&&!b.checkClonedCard(s);if(N){var t=r.modelName,v=f.getModel(t);v.destroy();if(h.settings["sAnnoKey"]){b.removeDataSources(h.settings["sAnnoKey"]);}f.setModel(null,t);A.setModel(null,t);}n.destroy();}l.removeContent(I);j.destroy();o.resetRevertData();return true;},completeChangeContent:function(o,s,p){return;}},layers:{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"dragAndDropUI":{changeHandler:{applyChange:function(o,p,P){var e=P.appComponent.getRootControl().getController(),f=o.getContent(),g=q.extend(true,{},f),u=e.getUIModel(),h=u.getProperty("/cards"),i=e.getLayout(),v;v=g.position;g.position=g.oldPosition;g.oldPosition=v;o.setRevertData(g);v=h[f.position];h[f.position]=h[f.oldPosition];h[f.oldPosition]=v;u.setProperty("/cards",h);var t=i.getContent()[f.position],j=i.getContent()[f.oldPosition];i.removeContent(j);i.insertContent(j,f.position);i.removeContent(t);i.insertContent(t,f.oldPosition);setTimeout(function(){var k=O.getOverlay(j);k.setSelected(true);k.focus();},0);return true;},revertChange:function(o,e,p){var f=p.appComponent.getRootControl().getController(),g=o.getRevertData(),u=f.getUIModel(),h=u.getProperty("/cards"),i=f.getLayout(),v;v=h[g.position];h[g.position]=h[g.oldPosition];h[g.oldPosition]=v;u.setProperty("/cards",h);var t=i.getContent()[g.position],j=i.getContent()[g.oldPosition];i.removeContent(j);i.insertContent(j,g.position);i.removeContent(t);i.insertContent(t,g.oldPosition);setTimeout(function(){var k=O.getOverlay(j);k.setSelected(true);k.focus();},0);o.resetRevertData();return true;},completeChangeContent:function(o,s,p){return;}},layers:{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"viewSwitch":C.PersonalizationConfigEmpty,"visibility":C.PersonalizationConfigEmpty,"position":C.PersonalizationConfigEmpty};},true);
