// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/model/json/JSONModel","sap/ushell/applications/PageComposer/controller/BaseDialog.controller","sap/ushell/applications/PageComposer/i18n/resources","sap/base/util/merge","sap/ui/core/Fragment","sap/ui/core/library"],function(J,B,r,m,F,c){"use strict";var V=c.ValueState;return B.extend("sap.ushell.applications.PageComposer.controller.CreatePageDialog",{constructor:function(v){this._oView=v;this._oModel=new J({validation:{id:false,title:false}});this.sViewId="createPageDialog";this.sId="sap.ushell.applications.PageComposer.view.CreatePageDialog";},handlePackageNamespaceChange:function(i,f){var t=this._oView.byId("transportContainer");var T=t.getComponentInstance();var p=T&&T.getRootControl().byId("packageInput");if(p&&!p.getValue().length){var P=i.split("/");P.pop();P=P.join("/");if(P){if(f){p.fireLiveChange({value:P});}else{p.setValue(P);p.fireChange({value:P});}}}},onConfirm:function(){var M=this.getModel();var R={content:{id:M.getProperty("/id"),title:M.getProperty("/title")},metadata:{}};if(this._fnConfirm){this._fnConfirm(R);}},_resetModel:function(M){M.setProperty("/id","");M.setProperty("/title","");var v=m({},M.getProperty("/validation"),{id:false,title:false});M.setProperty("/validation",v);},onBeforeOpen:function(){var f=this._oView.byId("createPageDialog");sap.ui.getCore().getMessageManager().registerObject(f,true);f.setModel(r.i18nModel,"i18n");this._resetModel(f.getModel());},onIdChange:function(e){var n=e.getParameters().value;this.handlePackageNamespaceChange(n,false);},onIdLiveChange:function(e){var i=e.getSource(),M=this.getModel(),I=i.getValue(),b=this._isValidID(I),v=m({},M.getProperty("/validation"),{id:b}),s=b?V.None:V.Error;M.setProperty("/validation",v);i.setValueState(s);if(I.length>0){i.setValueStateText(r.i18n.getText("Message.InvalidPageID"));}else{i.setValueStateText(r.i18n.getText("Message.EmptyPageID"));}this.handlePackageNamespaceChange(I,true);},onTitleLiveChange:function(e){var i=e.getSource(),M=this.getModel(),I=i.getValue(),b=this._isValidTitle(I),v=m({},M.getProperty("/validation"),{title:b}),s=b?V.None:V.Error;M.setProperty("/validation",v);i.setValueState(s);},_isValidID:function(i){return/^[\w/]{1,35}$/g.test(i);},_isValidTitle:function(t){return/^.{1,100}$/g.test(t);}});});
