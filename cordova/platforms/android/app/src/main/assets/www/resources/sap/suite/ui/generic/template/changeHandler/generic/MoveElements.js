/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/ui/fl/changeHandler/MoveControls"],function(U,A,M){"use strict";var a={},I="com.sap.vocabularies.UI.v1.Importance",b="com.sap.vocabularies.UI.v1.ImportanceType/High",c="com.sap.vocabularies.UI.v1.ImportanceType/Low";a.applyChange=function(C,o,p){M.applyChange(C,o,p);};a.completeChangeContent=function(C,s,p){var e;var m=U.getMetaModel(s,p);var o=p.modifier.bySelector(s.source.id,p.appComponent);if(s.source.aggregation==='groups'){e=o.getGroups();}else{e=o.getAggregation(s.source.aggregation)||(o.getActions&&o.getActions());}if(!U.isReveal){e.splice(s.movedElements[0].sourceIndex,0,e.splice(s.movedElements[0].targetIndex,1)[0]);}var u=e[s.movedElements[0].sourceIndex];var d=e[s.movedElements[0].targetIndex];var t=s.movedElements[0].targetIndex;var E,D,r;var R=U.getComponent(o).getRootControl().getId();e.some(function(B,i){if(B&&B.getId&&B.getId()===R+"--edit"){E=i;}if(B&&B.getId&&B.getId()===R+"--delete"){D=i;}if(B&&B.getId&&B.getId()===R+"--relatedApps"){r=i;}});var f=u;if(s.custom.fnGetRelevantElement){f=s.custom.fnGetRelevantElement(u);}var g={},h="",j={},k=[],l=[],n="",T=U.getTemplatingInfo(f);if(T&&T.target&&T.annotation){if(o.getId().indexOf("ObjectPage")>-1&&o.getId().indexOf("LineItem")>-1){var q=o.getParent().getEntitySet();h=o.getParent().getModel().getMetaModel().getODataEntitySet(q).entityType;}else{h=T.target;}j=m.getODataEntityType(h);n=T.annotation;k=j[n];}else{if(o.getId().indexOf("ObjectPage")>-1&&o.getId().indexOf("LineItem")>-1){var q=o.getParent().getEntitySet();h=o.getParent().getModel().getMetaModel().getODataEntitySet(q).entityType;}else{h=U.getEntityType(o);}j=m.getODataEntityType(h);n=s.custom.annotation;k=j[n];}l=JSON.parse(JSON.stringify(k));if(u&&u.setOrder){u.setOrder(s.movedElements[0].targetIndex);}if(U.isReveal){U.isReveal=false;}else{e.splice(s.movedElements[0].targetIndex,0,(e.splice(s.movedElements[0].sourceIndex,1))[0]);}if(s.custom.fnPerformCustomMove){var P=p.modifier.bySelector(s.source.id,p.appComponent);var v=p.modifier.bySelector(s.target.id,p.appComponent);var w=s.movedElements[0].sourceIndex;var x=s.movedElements[0].targetIndex;s.custom.fnPerformCustomMove(P,v,w,x,k);}else{var w=s.custom.fnGetAnnotationIndex(u,k);var x=s.custom.fnGetAnnotationIndex(d,k);var y=E||D||r;if(y){if(t<y){k[w][I]={EnumMember:b};}else{k[w][I]={EnumMember:c};}}if(typeof(s.custom.elements)==="undefined"){s.custom.elements=k;}s.custom.elements.splice(x,0,s.custom.elements.splice(w,1)[0]);}if(s.custom.MoveConcreteElement){s.custom.MoveConcreteElement.completeChangeContent(C,s,p);}if(w>=0&&x>=0){var g=A.createCustomAnnotationTermChange(h,k,l,n);var z=A.createCustomChanges(g);jQuery.extend(true,C.getContent(),z);}};return a;},true);
