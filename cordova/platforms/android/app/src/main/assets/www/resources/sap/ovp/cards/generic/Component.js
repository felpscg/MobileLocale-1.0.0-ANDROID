sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ovp/cards/CommonUtils","sap/ui/Device","sap/ui/model/resource/ResourceModel","sap/ui/core/mvc/ViewType","sap/base/util/merge"],function(q,U,J,C,D,R,V,m){"use strict";return U.extend("sap.ovp.cards.generic.Component",{metadata:{properties:{"contentFragment":{"type":"string"},"controllerName":{"type":"string","defaultValue":"sap.ovp.cards.generic.Card"},"headerExtensionFragment":{"type":"string"},"contentPosition":{"type":"string","defaultValue":"Middle"},"headerFragment":{"type":"string","defaultValue":"sap.ovp.cards.generic.Header"},"footerFragment":{"type":"string"},"identificationAnnotationPath":{"type":"string","defaultValue":"com.sap.vocabularies.UI.v1.Identification"},"selectionAnnotationPath":{"type":"string"},"filters":{"type":"object"},"parameters":{"type":"object"},"addODataSelect":{"type":"boolean","defaultValue":false}},version:"1.71.3",library:"sap.ovp",includes:[],dependencies:{libs:[],components:[]},config:{}},setSelectionVariant:function(s,S){if(/^@/.test(s)){s=s.slice(1);}S.selectionAnnotationPath=s;},setPresentationVariant:function(p,s,e){if(/^@/.test(p)){p=p.slice(1);}s.presentationAnnotationPath=p;var a=p.split("/");var v=a.length===1?e[p].Visualizations:e[a[0]][a[1]][a[2]].Visualizations;var i;for(i=0;i<v.length;i++){var b=v[i].AnnotationPath;if(b){if(/^@/.test(b)){b=b.slice(1);}if(/.LineItem/.test(b)){s.annotationPath=b;break;}}}for(i=0;i<v.length;i++){var b=v[i].AnnotationPath;if(b){if(/^@/.test(b)){b=b.slice(1);}if(/.Chart/.test(b)){s.chartAnnotationPath=b;break;}}}},setDataPointAnnotationPath:function(d,s){if(/^@/.test(d)){d=d.slice(1);}s.dataPointAnnotationPath=d;},getCustomPreprocessor:function(){},getPreprocessors:function(p){var c=this.getComponentData(),s=c.settings,M=c.model,o,e,E,a;if(s.description&&!s.subTitle){s.subTitle=s.description;}if(M){o=M.getMetaModel();if(s.entitySet){var b=o.getODataEntitySet(s.entitySet);var d=o.getODataEntitySet(s.entitySet,true);e=o.getODataEntityType(b.entityType);a=o.createBindingContext(d);E=o.createBindingContext(e.$path);}}var f=this._getCardPropertyDefaults();var g=this._completeLayoutDefaults(f,s);var h,j,k=true;if(c.appComponent&&c.appComponent.getModel("ui")&&c.appComponent.getModel("ui").oData){var l=c.appComponent.getModel("ui").oData;h=l.showDateInRelativeFormat;j=l.disableTableCardFlexibility;k=l.enableFiori3;}else{if(c.showDateInRelativeFormat){h=c.showDateInRelativeFormat;}if(c.disableTableCardFlexibility){j=c.disableTableCardFlexibility;}}var A={metaModel:o,entityType:e,webkitSupport:D.browser.webkit,layoutDetail:g&&g.cardLayout?g.cardLayout.containerLayout:'fixed',showDateInRelativeFormat:h,disableTableCardFlexibility:j,cardId:c.cardId,enableFiori3:k};if(!!c&&!!c.cardId){var n=c.mainComponent;var t=null;if(!!n){t=n._getCardFromManifest(c.cardId)?n._getCardFromManifest(c.cardId).template:null;}else{t=c.template;}if(!!t){A.template=t;}}f.densityStyle=C._setCardpropertyDensityAttribute();if(c.errorReason){var r=c.errorReason;var P=r.getParameters();var u="sap-icon://message-error";if(P&&P.response){f.errorStatusCode=P.response.statusCode;f.errorStatusText=P.response.statusText;f.responseText=P.response.responseText;f.sMessageIcon=P.response.sIcon?P.response.sIcon:u;}}if(g){A.cardLayout=g.cardLayout;}if(f.state!=="Loading"&&f.state!=="Error"){if(s&&s.kpiAnnotationPath){var K=e[s.kpiAnnotationPath];var v=f.contentFragment;if(K&&(v==="sap.ovp.cards.charts.analytical.analyticalChart"||v==="sap.ovp.cards.charts.smart.analyticalChart")){var S=K.SelectionVariant&&K.SelectionVariant.Path?K.SelectionVariant.Path:s.kpiAnnotationPath+"/SelectionVariant";if(S){this.setSelectionVariant(S,s);}var w=K.Detail&&K.Detail.DefaultPresentationVariant&&K.Detail.DefaultPresentationVariant.Path?K.Detail.DefaultPresentationVariant.Path:s.kpiAnnotationPath+"/Detail/DefaultPresentationVariant";if(w){this.setPresentationVariant(w,s,e);}var x=K.DataPoint&&K.DataPoint.Path?K.DataPoint.Path:s.kpiAnnotationPath+"/DataPoint";if(x){this.setDataPointAnnotationPath(x,s);}}}else if(s&&s.selectionPresentationAnnotationPath){var y=e[s.selectionPresentationAnnotationPath];if(y){var S=y.SelectionVariant&&y.SelectionVariant.Path;if(S){this.setSelectionVariant(S,s);}var w=y.PresentationVariant&&y.PresentationVariant.Path;if(w){this.setPresentationVariant(w,s,e);}}}}if(c.ovpCardsAsApi&&s.ignoreSelectionVariant){s.selectionAnnotationPath="";var I=[];for(var z=0;!!s.filters&&z<s.filters.length;z++){I.push({id:"headerFilterText--"+(z+1),index:z});}s.idForExternalFilters=I;}if(!!A.entityType&&!!s.selectionAnnotationPath&&!!A.entityType[s.selectionAnnotationPath]){var B=A.entityType[s.selectionAnnotationPath].SelectOptions;for(var F=0;!!B&&F<B.length;F++){B[F].id="headerFilterText--"+(F+1);}A.entityType[s.selectionAnnotationPath].SelectOptions=B;}if(A.template==="sap.ovp.cards.linklist"&&!!s.staticContent){for(var i=0;i<s.staticContent.length;i++){s.staticContent[i].id="linkListItem--"+(i+1);}}if(A.template==='sap.ovp.cards.charts.analytical'){s.dataStep=s.dataStep?s.dataStep:10;}f=q.extend(true,{},A,f,s);var O=new J(f);var G=new J(D);G.setDefaultBindingMode("OneWay");var H={dontIncludeUOM:true,firstDataPointIndex:0,secondDataPointIndex:1,thirdDataPointIndex:2,fourthDataPointIndex:3,fifthDataPointIndex:4,sixthDataPointIndex:5,firstDataFieldIndex:0,secondDataFieldIndex:1,thirdDataFieldIndex:2,fourthDataFieldIndex:3,fifthDataFieldIndex:4,sixthDataFieldIndex:5};var L=new J(H);var N={xml:{bindingContexts:{entityType:E,entitySet:a},models:{device:G,entityType:o,entitySet:o,ovpMeta:o,ovpCardProperties:O,ovplibResourceBundle:p,ovpConstants:L},ovpCardProperties:O,dataModel:M,_ovpCache:{}}};return q.extend(true,{},this.getCustomPreprocessor(),N);},_completeLayoutDefaults:function(c,s){var o={},a=this.getComponentData(),b=null,d=null;if(a.appComponent){b=a.appComponent.getOvpConfig();}if(!b){return null;}if(b.containerLayout==="resizable"&&a.cardId&&c.contentFragment!=="sap.ovp.cards.quickview.Quickview"){d=a.appComponent.getDashboardLayoutUtil();var e=a.cardId;var f=d.aCards.filter(function(i){return i.id===e;});o.cardLayout=f[0].dashboardLayout;o.cardLayout.containerLayout=b.containerLayout;o.cardLayout.iRowHeightPx=d.ROW_HEIGHT_PX;o.cardLayout.iCardBorderPx=d.CARD_BORDER_PX;o.cardLayout.headerHeight=f[0].dashboardLayout.headerHeight;}return o;},_getCardPropertyDefaults:function(){var c={};var p=this.getMetadata().getAllProperties();var P;for(var a in p){P=p[a];if(P.defaultValue!==undefined){c[P.name]=P.defaultValue;}}return c;},getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=r?new R({bundleUrl:r.oUrlInfo.url}):null;}return this.ovplibResourceBundle;},_getCacheKeys:function(){},createContent:function(){var c=this.getComponentData&&this.getComponentData();var M=c.model;var p;var P;var o=c&&c.mainComponent;var a=o&&o.oModelViewMap;var s=c&&c.modelName;var f=function(){if(M&&s){M.bIncludeInCurrentBatch=false;if(a&&s&&a[s]&&a[s][c.cardId]){delete a[s][c.cardId];if(Object.keys(a[s]).length>0){M.bIncludeInCurrentBatch=true;}}}};if(c&&c.mainComponent){p=c.mainComponent._getOvplibResourceBundle();}else{p=this.getOvplibResourceBundle();}P=this.getPreprocessors(p);var v={preprocessors:P,type:V.XML,viewName:"sap.ovp.cards.generic.Card"};var b=this._getCacheKeys();if(b&&b.length&&b.length>0){v.async=true;v.cache={keys:b};}var l=this._getCardPropertyDefaults().state;var i=c.cardId+(l?l:"Original");if(!l){i=i+(c.settings.selectedKey?"_Tab"+c.settings.selectedKey:"");}if(M&&M.bUseBatch&&!v.async){f();}var d=sap.ui.view(c.containerId==="dialogCard"?undefined:i,v);if(v.async){var O=d.onControllerConnected;d.onControllerConnected=function(){if(M&&M.bUseBatch){f();}O.apply(d,arguments);};}d.setModel(M);if(c.i18n){d.setModel(c.i18n,"@i18n");}d.setModel(P.xml.ovpCardProperties,"ovpCardProperties");d.setModel(p,"ovplibResourceBundle");return d;}});});
