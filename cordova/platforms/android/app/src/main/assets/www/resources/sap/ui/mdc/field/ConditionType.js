/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/model/SimpleType','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/ui/model/type/String','sap/ui/mdc/library','sap/ui/mdc/base/FilterOperatorConfig','sap/ui/mdc/base/Condition','sap/base/util/merge'],function(S,F,P,V,a,l,b,C,m){"use strict";var c=l.FieldDisplay;var d=S.extend("sap.ui.mdc.field.ConditionType",{constructor:function(w,x){S.apply(this,arguments);this.sName="Condition";this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");}});d.prototype.destroy=function(){S.prototype.destroy.apply(this,arguments);if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}if(this._oFilterOperatorConfig){this._oFilterOperatorConfig.destroy();delete this._oFilterOperatorConfig;}this._bDestroyed=true;};d.prototype.formatValue=function(w,I){if(w==undefined||w==null||this._bDestroyed){return null;}if(typeof w!=="object"||!w.operator||!w.values||!Array.isArray(w.values)){throw new F("No valid condition provided");}if(!I){I="string";}var T=n.call(this);var O=o.call(this);var x=this.oFormatOptions.isUnit;s.call(this,w,O);if(x){w=m({},w);if(w.values[0]&&Array.isArray(w.values[0])){w.values[0]=w.values[0][1];}if(w.operator!=="EQ"&&w.operator!=="EEQ"){w.operator="EQ";if(w.values[1]){w.values.splice(1,1);}}}s.call(this,w,T);switch(this.getPrimitiveType(I)){case"string":case"any":if(this.oFormatOptions.onlyEEQ&&w.operator==="EQ"){w=m({},w);w.operator="EEQ";}var D=k.call(this);var y=q.call(this);if(w.operator==="EEQ"&&D!==c.Value&&!w.values[1]&&y){var E=function(G){if(G instanceof F&&!y.getValidateInput()){return w;}else{throw G;}};var z=function(A){w=m({},w);if(A&&typeof A==="object"){w=u.call(this,w,A);}else if(w.values.length===1){w.values.push(A);}else{w.values[1]=A;}return w;};var B=this.oFormatOptions.bindingContext;var A;try{A=y.getTextForKey(w.values[0],w.inParameters,w.outParameters,B);}catch(G){return E.call(this,G);}if(A instanceof Promise){return A.then(function(A){w=z.call(this,A);return _.call(this,w);}.bind(this)).catch(function(G){w=E.call(this,G);return _.call(this,w);}.bind(this));}else{w=z.call(this,A);}}return _.call(this,w);default:if(T&&w.values.length>=1){return T.formatValue(w.values[0],I);}throw new F("Don't know how to format Condition to "+I);}};function _(w){var D=k.call(this);var T=n.call(this);var x=p.call(this);if(this.oFormatOptions.hideOperator&&w.values.length>=1){return T.formatValue(w.values[0],"string");}var O=x.getOperator(w.operator);return O.format(w.values,w,T,D);}d.prototype.parseValue=function(w,I){if(this._bDestroyed){return null;}if(!I){I="string";}else if(I==="any"&&typeof w==="string"){I="string";}var N=this.oFormatOptions.navigateCondition;if(N){var O=this.formatValue(N,I);if(O===w){return m({},N);}}var D=k.call(this);var x=q.call(this);var T=n.call(this);var y=o.call(this);var z=T.getMetadata().getName();var A=p.call(this);var B=this.oFormatOptions.isUnit;var E;if(w===null||w===undefined||(w===""&&!x)){if(!r.call(this,T)&&!B){return null;}}t.call(this,T);t.call(this,y);switch(this.getPrimitiveType(I)){case"string":var G=w;var H;var J=false;if(this.oFormatOptions.onlyEEQ){H=A.getOperator("EEQ");if(!H.test(w,T)){G="=="+w;}}else{var K=A.getMatchingOperators(z,G);if(K.length===0){if(x&&!r.call(this,T)){H=A.getOperator("EEQ");if(!H.test(w,T)){G="=="+w;}J=true;}else{E=A.getDefaultOperator(z);H=A.getOperator(E);G=H?H.format([w]):w;}}else{H=K[0];}}if(H){var L;try{L=H.getCondition(G,T,D);}catch(M){if(M instanceof P&&y){y.parseValue(w,"string",y._aCurrentValue);}throw M;}if(!L){throw new P("Cannot parse value "+w);}if(!r.call(this,T)){if(H.name==="EEQ"&&x){if(L.values[0]!==null&&L.values[0]!==undefined){L=f.call(this,L,T,x,J,A,w,D);if(L instanceof Promise){return v.call(this,L);}}else if(L.values[1]!==null&&L.values[1]!==undefined){L=g.call(this,L,T,x,true,J,A,w,D);if(L instanceof Promise){return v.call(this,L);}}else if(w===""){L=null;}}else if(w===""){L=null;}}return e.call(this,L,T);}throw new P("Cannot parse value "+w);default:if(T){if(this.oFormatOptions.onlyEEQ){E="EEQ";}else{E=A.getDefaultOperator(z);}return C.createCondition(E,[T.parseValue(w,I)]);}throw new P("Don't know how to parse Condition from "+I);}};function e(w,T){var I=this.oFormatOptions.isUnit;var O=o.call(this);var U=null;if(I){var M;if(O._aCurrentValue){M=O._aCurrentValue[0];}if(w){if(w.operator!=="EEQ"&&w.operator!=="EQ"){throw new P("unsupported operator");}U=w.values[0];w.values=[[M,U],undefined];}else{w=C.createCondition("EEQ",[[M,null],undefined]);}s.call(this,w,O);}else if(w){var N=T.getMetadata().getName();if((N==="sap.ui.model.odata.type.Unit"||N==="sap.ui.model.odata.type.Currency"||N==="sap.ui.model.type.Unit"||N==="sap.ui.model.type.Currency")&&!w.values[0][1]&&T._aCurrentValue){U=T._aCurrentValue[1]?T._aCurrentValue[1]:null;w.values[0][1]=U;if(w.operator==="BT"){w.values[1][1]=U;}}s.call(this,w,T);s.call(this,w,O);}return w;}function f(w,T,x,y,z,A,D){var B;var E=function(I){if(I&&!(I instanceof P)&&!(I instanceof F)&&!(I instanceof V)){throw I;}if(D===c.Value){if(y){return i.call(this,T,z,A,D);}else if(!x.getValidateInput()){return j.call(this,T,z,A,D);}else{throw new P(I.message);}}else{w.values[1]=w.values[0];w.values[0]=null;return g.call(this,w,T,x,false,y,z,A,D);}};var G=function(B){if(B){if(typeof B==="object"){w=u.call(this,w,B);}else{w.values[1]=B;}}else{if(A===""){w=null;}else{w=E.call(this,new P(this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[A])));}}return w;};try{T.validateValue(w.values[0]);var H=this.oFormatOptions.bindingContext;B=x.getTextForKey(w.values[0],undefined,undefined,H);}catch(I){return E.call(this,I);}if(B instanceof Promise){return B.then(function(B){w=G.call(this,B);return e.call(this,w,T);}.bind(this)).catch(function(I){w=E.call(this,I);return e.call(this,w,T);}.bind(this));}else{return G.call(this,B);}}function g(w,T,x,y,z,A,B,D){if(w.values[1]===""){return h.call(this,w,T,x,y,z,A,B,D,undefined);}var E=function(I){if(I&&!(I instanceof P)&&!(I instanceof F)){throw I;}if(I._bNotUnique){if(!x.getValidateInput()){return j.call(this,T,A,B,D);}else{throw I;}}else{return h.call(this,w,T,x,y,z,A,B,D,I);}};var G=function(K){if(K===null||K===undefined){return h.call(this,w,T,x,y,z,A,B,D,undefined);}if(K&&typeof K==="object"){w=u.call(this,w,K);}else{w.values[0]=K;}return w;};var H=this.oFormatOptions.bindingContext;var K;try{K=x.getKeyForText(w.values[1],H);}catch(I){return E.call(this,I);}if(K instanceof Promise){return K.then(function(K){w=G.call(this,K);return y?e.call(this,w,T):w;}.bind(this)).catch(function(I){w=E.call(this,I);return y?e.call(this,w,T):w;}.bind(this));}else{return G.call(this,K);}}function h(w,T,x,y,z,A,B,D,E){var G=null;var H=function(E){if(E&&!(E instanceof P)&&!(E instanceof F)){throw E;}w.values[1]=null;if(z){return i.call(this,T,A,B,D);}else if(!x.getValidateInput()){return j.call(this,T,A,B,D);}throw new P(E.message);};var I=function(G){if(G){if(typeof G==="object"){w=u.call(this,w,G);}else{w.values[1]=G;}}else{if(B===""){w=null;}else{w=H.call(this,E||new P(this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[B])));}}return w;};try{w.values[0]=T.parseValue(w.values[1],"string");T.validateValue(w.values[0]);}catch(M){y=false;}if(y){var J=this.oFormatOptions.bindingContext;try{G=x.getTextForKey(w.values[0],undefined,undefined,J);}catch(M){return H.call(this,M);}if(G instanceof Promise){return G.then(function(G){return I.call(this,G);}.bind(this)).catch(function(E){return H.call(this,E);}.bind(this));}}else if(E){return H.call(this,E);}return I.call(this,G);}function i(T,w,x,D){var y=T.getMetadata().getName();var z=w.getDefaultOperator(y);var O=w.getOperator(z);var A=O?O.format([x]):x;var B=O.getCondition(A,T,D);return B;}function j(T,w,x,D){var O;if(this.oFormatOptions.onlyEEQ){O="EEQ";}else{if(x.startsWith("==")){O="EEQ";x=x.slice(2);}else if(x.startsWith("=")){O="EQ";x=x.slice(1);}}var y=T.parseValue(x,"string");var z=C.createCondition(O,[y]);return z;}d.prototype.validateValue=function(w){var T=n.call(this);var I=this.oFormatOptions.isUnit;if(w===undefined||this._bDestroyed){return null;}else if(w===null){if(this.oFormatOptions.onlyEEQ){try{if(T._sParsedEmptyString===""){T.validateValue("");}else{T.validateValue(null);}}catch(E){if(E instanceof V){throw E;}else{return null;}}}return null;}if(typeof w!=="object"||!w.operator||!w.values||!Array.isArray(w.values)){throw new V(this._oResourceBundle.getText("field.VALUE_NOT_VALID"));}var x=p.call(this);var O=x.getOperator(w.operator);if(I){w=m({},w);if(w.values[0]&&Array.isArray(w.values[0])){w.values[0]=w.values[0][1];}}O.validate(w.values,T);};function k(){var D=this.oFormatOptions.display;if(!D){D=c.Value;}return D;}function n(){var T=this.oFormatOptions.valueType;if(!T){if(!this._oDefaultType){this._oDefaultType=new a();}T=this._oDefaultType;}return T;}function o(){return this.oFormatOptions.originalDateType;}function p(){var w=this.oFormatOptions.filterOperatorConfig;if(!w){if(!this._oFilterOperatorConfig){this._oFilterOperatorConfig=new b();}w=this._oFilterOperatorConfig;}return w;}function q(){var I=this.oFormatOptions.fieldHelpID;if(I){return sap.ui.getCore().byId(I);}return null;}function r(T){return T&&T.isA("sap.ui.model.CompositeType");}function s(w,T){if(r.call(this,T)&&w&&w.values[0]){T._aCurrentValue=w.values[0];}}function t(T){if(r.call(this,T)&&!T._aCurrentValue){T._aCurrentValue=[];}}function u(w,R){w.values=[R.key,R.description];if(R.inParameters){w.inParameters=R.inParameters;}if(R.outParameters){w.outParameters=R.outParameters;}return w;}function v(w){if(this.oFormatOptions.asyncParsing){this.oFormatOptions.asyncParsing(w);}return w;}return d;});
