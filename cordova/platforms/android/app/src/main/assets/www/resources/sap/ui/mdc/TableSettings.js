/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/p13n/Util","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarLayoutData"],function(U,O,a){"use strict";var r;var T={createSortButton:function(i,e){if(!r){this._loadResourceBundle();}return this._createButton(i+"-sort",{icon:"sap-icon://sort",text:r.getText("table.SETTINGS_SORT","Sort"),press:e,tooltip:r.getText("table.SETTINGS_SORT","Sort"),layoutData:new a({closeOverflowOnInteraction:false})});},createColumnsButton:function(i,e){if(!r){this._loadResourceBundle();}return this._createButton(i+"-settings",{icon:"sap-icon://action-settings",text:r.getText("table.SETTINGS_COLUMN2","Add/Remove Columns"),press:e,tooltip:r.getText("table.SETTINGS_COLUMN2","Add/Remove Columns"),layoutData:new a({closeOverflowOnInteraction:false})});},_createButton:function(i,s){return new O(i,s);},_loadResourceBundle:function(){r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");},showPanel:function(c,p,s,i){return new Promise(function(b,d){T["_getP13nStateOf"+p](c).then(function(P){U["showP13n"+p](c,s,P,b);});});},_getP13nStateOfSort:function(c){return new Promise(function(b){sap.ui.require([this.getMetadataDelegate()],function(M){if(!M||!M.fetchProperties||!M.createColumn){return b([]);}var p={};p.items=[];var e=M.getCurrentState(this).sorters;var E=e.reduce(function(m,P){m[P.name]=P;return m;},{});M.fetchProperties(this).then(function(P){P.forEach(function(o){var d=E[o.name]?true:false;p.items.push({name:o.name,label:d?E[o.name].label||E[o.name].name:o.label||o.name,sortOrder:d?E[o.name].sortOrder:"",selected:d,position:d?E[o.name].index:-1});});b(p);});}.bind(this));}.bind(c));},_getP13nStateOfColumns:function(c){return new Promise(function(b){sap.ui.require([this.getMetadataDelegate()],function(M){var p={};p.items=[];var e=M.getCurrentState(this).visibleFields;var E=e.reduce(function(m,P,i){m[P.name]=P;m[P.name].position=i;return m;},{});M.fetchProperties(this).then(function(P){P.forEach(function(o){var d=E[o.name]?true:false;p.items.push({id:d?E[o.name].id:undefined,name:o.name,label:d?E[o.name].label||E[o.name].name:o.label||o.name,selected:d,position:d?E[o.name].position:-1});});b(p);});}.bind(this));}.bind(c));},createSort:function(c,p,R){sap.ui.require([c.getMetadataDelegate()],function(M){if(!M||!M.getCurrentState){return;}var C=[],d=false;M.getCurrentState(c).sorters.forEach(function(P){if(p===P.name){d=P.sortOrder==="Ascending";}if(R){C.push({selectorElement:c,changeSpecificData:{changeType:"removeSort",content:P}});}});C.push({selectorElement:c,changeSpecificData:{changeType:"addSort",content:{name:p,sortOrder:d?"Descending":"Ascending"}}});U.handleUserChanges(C);});},moveColumn:function(c,d,n){this._moveItem(c,d,n,"removeColumn","addColumn");},_moveItem:function(c,d,n,R,A){sap.ui.require([c.getMetadataDelegate()],function(M){if(!M||!M.getCurrentState){return;}var C=[];var v=M.getCurrentState(c).visibleFields||[];var m=v[d];m.index=d;m.preventRebind=true;C.push({selectorElement:c,changeSpecificData:{changeType:R,content:m}});var b=Object.assign({},m);b.index=n;C.push({selectorElement:c,changeSpecificData:{changeType:A,content:b}});U.handleUserChanges(C);});}};return T;},false);
