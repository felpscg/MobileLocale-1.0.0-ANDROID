sap.ui.define(["sap/ui/base/Object"],function(B){"use strict";function g(c,t,v,s){var i=t.oComponentUtils.isDraftEnabled();var b=t.oServices.oApplication.getBusyHelper();var V=c.getView();var u=V.getModel("ui");var C;var I=false;var a=false;var f;var d;if(i&&t.oComponentUtils.getViewLevel()!==1){d=jQuery.noop;}function F(){d();f=null;d=null;}function e(){a=false;if(I){C.close();}else{F();}}function o(k,l){C=C||t.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.fragments.DiscardEditPopover",{onDiscardConfirm:function(){if(!I||a){return;}f();},beforeClose:function(){I=false;F();}},"discard",function(p,m){m.setProperty("/placement",sap.m.PlacementType.Top);});I=true;var m=C.getModel("discard");m.setProperty("/isCreate",l);C.openBy(k);}function h(){if(i){var k=V.getBindingContext();return t.oServices.oApplication.getNavigateAfterDraftCancelPromise(k).then(function(N){return function(){t.oServices.oViewDependencyHelper.setRootPageToDirty();t.oServices.oViewDependencyHelper.unbindChildren(c.getOwnerComponent());t.oServices.oApplication.invalidatePaginatorInfo();N();};});}return Promise.resolve(function(){var T=t.oComponentUtils.getTemplatePrivateModel();T.setProperty("/objectPage/displayMode",1);v.setEditable(false);if(t.oComponentUtils.isNonDraftCreate()){t.oServices.oNavigationController.navigateBack();}});}function n(){if(i){var k=V.getBindingContext();var p=k.getPath();var l=t.oServices.oApplication.getIsDraftModified(p)||s.saveScenarioHandler.hasValidationMessageOnDetailsViews();return l;}var H=!!s.aUnsavedDataCheckFunctions&&s.aUnsavedDataCheckFunctions.some(function(U){return U();});var m=V.getModel();return H||m.hasPendingChanges();}function j(){if(i){var k=V.getBindingContext();var E=k.getObject();var l=E.hasOwnProperty("HasActiveEntity")&&!k.getProperty("IsActiveEntity")&&!k.getProperty("HasActiveEntity");return l;}return t.oComponentUtils.isNonDraftCreate();}function D(k){if(d){return Promise.reject();}if(!(t.oComponentUtils.isComponentActive()&&u.getProperty("/editable"))){return Promise.reject();}var r=new Promise(function(R,l){d=l;var E=h();var p=function(){if(k&&b.isBusy()){F();return;}var m=function(){a=true;var q=E.then(function(A){var S=function(){d=R;A();e();};var w;if(i){w=t.oServices.oCRUDManager.deleteEntity(false,true).then(S);w.catch(e);}else{S();}t.oCommonUtils.resetChangesAndFireCancelEvent(w);return w;});b.setBusy(q);};if(k&&n()){f=m;o(k,j());}else{m();}};t.oServices.oApplication.performAfterSideEffectExecution(p);});r.catch(jQuery.noop);return r;}return{discardEdit:D};}return B.extend("sap.suite.ui.generic.template.detailTemplates.DiscardEditHandler",{constructor:function(c,t,v,s){Object.assign(this,g(c,t,v,s));}});});
