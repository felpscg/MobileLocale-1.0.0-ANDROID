sap.ui.define(["sap/base/Log","sap/ui/core/routing/HashChanger","sap/suite/ui/generic/template/extensionAPI/NavigationController","sap/suite/ui/generic/template/lib/MessageButtonHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/DiscardEditHandler","sap/suite/ui/generic/template/detailTemplates/PaginatorButtonsHelper","sap/suite/ui/generic/template/ObjectPage/extensionAPI/DraftTransactionController","sap/suite/ui/generic/template/ObjectPage/extensionAPI/NonDraftTransactionController","sap/m/DraftIndicator"],function(L,H,N,M,t,D,P,a,b){"use strict";var c=sap.m.DraftIndicatorState;function g(C,o,v){function i(){var T=o.getTemplatePrivateModel();T.setProperty("/objectPage",{displayMode:0,headerInfo:{objectTitle:"",objectSubtitle:""}});o.setStatePreserverPromise(v);}function e(B,I){if(!o.isDraftEnabled()){var U=C.getModel("ui");var T=o.getTemplatePrivateModel();var l=o.isNonDraftCreate();U.setProperty("/createMode",l);if(l||o.getEditableNDC()){U.setProperty("/editable",true);T.setProperty("/objectPage/displayMode",l?4:2);}else{U.setProperty("/editable",false);T.setProperty("/objectPage/displayMode",1);}}(v.onComponentActivate||jQuery.noop)(B,I);}function u(){var B=C.getBindingContext();var l=o.registerContext(B);var T=C.getModel("_templPrivGlobal");T.setProperty("/generic/draftIndicatorState",c.Clear);(v.applyHeaderContextToSmartTablesDynamicColumnHide||jQuery.noop)(B);var U=C.getModel("ui");var I;var m=o.getTemplatePrivateModel();if(l.bIsDraft){I=true;U.setProperty("/enabled",true);m.setProperty("/objectPage/displayMode",l.bIsCreate?4:2);}else{I=o.getEditableNDC();m.setProperty("/objectPage/displayMode",I?2:1);U.setProperty("/enabled",true);}U.setProperty("/createMode",l.bIsCreate);U.setProperty("/editable",I);}function f(){return o.getDraftRootPath();}function n(){v.navigateUp();}function h(p,A){return v.oStatePreserverPromise.then(function(s){return s.getUrlParameterInfo(p,A);});}function j(O){return v.getMessageFilters(O);}function k(l){return v.getScrollFunction&&v.getScrollFunction(l);}return{init:i,onActivate:e,getTitle:o.getTitleFromTreeNode,updateBindingContext:u,currentDraftModified:f,navigateUp:n,getUrlParameterInfo:h,getMessageFilters:j,getScrollFunction:k};}function d(v,T,C){var o;var p;var h;function G(){return h||H.getInstance();}function s(i){var I=!T.oComponentUtils.isDraftEnabled();if(I||!i){var U=C.getView().getModel("ui");U.setProperty("/editable",i);}if(I){T.oComponentUtils.setEditableNDC(i);}}function O(){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var i=T.oComponentUtils.isDraftEnabled();if(!i){s(false);}T.oServices.oNavigationController.navigateBack();},jQuery.noop,o.state);}function A(){var y=T.oServices.oApplication.getLinksToUpperLayers();var V=T.oComponentUtils.getViewLevel();var z;if(T.oComponentUtils.isDraftEnabled()){var B=T.oComponentUtils.getTemplatePrivateModel();z=B.getProperty("/objectPage/displayMode");}else{z=1;}v.navigateUp=y[V-1].navigate.bind(null,z);var E=v.aBreadCrumbs;var I=E?E.length:0;for(var i=0;i<I;i++){var J=E[i];var K=y[i+1];K.adaptBreadCrumbLink(J);var Q=T.oCommonUtils.getControlInformation(J,function(R){});Q.navigate=K.navigate.bind(null,z);}}function e(i){var y=i.getBindingContext();var z=G().getHash();return T.oServices.oApplicationController.propertyChanged(z,y);}function n(){v.navigateUp();}function f(i){var B=T.oServices.oApplication.getBusyHelper();var U=C.getView().getModel("ui");var y=C.getOwnerComponent().getModel("_templPrivGlobal");var z=e(i).then(function(R){if(!o.fclInfo.isContainedInFCL||y.getProperty("/generic/FCL/isVisuallyFullScreen")){n();}},function(){B.getUnbusy().then(function(R){if(!o.fclInfo.isContainedInFCL||y.getProperty("/generic/FCL/isVisuallyFullScreen")){T.oCommonUtils.processDataLossTechnicalErrorConfirmation(function(){n();U.setProperty("/enabled",true);},jQuery.noop,o.state);}else{T.oCommonUtils.processDataLossTechnicalErrorConfirmation(jQuery.noop,jQuery.noop,o.state,"StayOnPage");}});});B.setBusy(z);}function j(E){var i=E.getSource();o.state.saveScenarioHandler.handleSaveScenario(2,f.bind(null,i));}var k;function l(i){k=k||new D(C,T,v,o.state);return k.discardEdit(i);}function m(){o.state.messageButtonHelper.toggleMessagePopover();}function q(i){return o.state.messageButtonHelper&&o.state.messageButtonHelper.getMessageFilters(i);}function r(){var i;return function(){i=i||new N(T,C,o.state);return i;};}function u(){var i;return function(){if(!i){var y=T.oComponentUtils.isDraftEnabled()?a:b;i=new y(T,C,o.state);}return i;};}function w(){p.handleShowNextObject();}function x(){p.handleShowPrevObject();}var G=t.testable(G,"getHashChangerInstance");var A=t.testable(A,"adaptLinksToUpperLevels");o={onInit:function(R,i){if(!R||R.footerBar){var I=T.oComponentUtils.isODataBased();var y={controller:C,prepareAllMessagesForNavigation:i};o.state.messageButtonHelper=new M(T,y,I);o.state.saveScenarioHandler=T.oServices.oApplication.getSaveScenarioHandler(C,T.oCommonUtils);T.oServices.oTemplateCapabilities.oMessageButtonHelper=o.state.messageButtonHelper;o.state.onCancel=l;}if(!R||R.paginatorButtons){p=new P(o,C,T);}v.getScrollFunction=function(z){var B=T.oCommonUtils.getPositionableControlId(z);return B&&T.oCommonUtils.focusControl.bind(null,B);};},handlers:{handleShowNextObject:w,handleShowPrevObject:x,onShowMessages:m,applyAndUp:j,onSave:function(){L.error("Save for this floorplan not implemented yet");},onBack:O},extensionAPI:{getNavigationControllerFunction:r,getTransactionControllerFunction:u},fclInfo:{isContainedInFCL:false},state:{},onComponentActivate:function(B,i){if(o.state.messageButtonHelper){o.state.messageButtonHelper.adaptToContext(B);}T.oComponentUtils.setBackNavigation(O);A();if(p){p.computeAndSetVisibleParamsForNavigationBtns();}v.oStatePreserverPromise.then(function(S){S.applyAppState(B,i);});}};v.navigateUp=n;v.setEditable=s;v.getMessageFilters=q;var F=T.oComponentUtils.getFclProxy();if(F.oActionButtonHandlers){o.handlers.fclActionButtonHandlers=F.oActionButtonHandlers;o.fclInfo.isContainedInFCL=true;}o.stateChanged=function(){v.oStatePreserverPromise.then(function(S){S.stateChanged();});};return o;}return{getComponentBase:g,getControllerBase:d};});
