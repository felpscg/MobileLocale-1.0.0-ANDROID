sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/suite/ui/generic/template/js/AnnotationHelper"],function(B,L,A){"use strict";var C={isPreliminary:function(){return false;}};function g(c,o){var t=o.oTemplateContract.mRoutingTree[o.route];var h;var H;var a;var b;var I=false;var d=[];var e;var E=[];function f(){return!!t.createNonDraftInfo&&c.getComponentContainer().getBindingContext()===t.createNonDraftInfo.createContext;}function r(i){if(t.createNonDraftInfo&&t.createNonDraftInfo.bindingPath===i){return t.createNonDraftInfo.createContext;}delete t.createNonDraftInfo;return null;}function j(){return c.getModel("_templPriv");}function k(){return j().getProperty("/generic/viewLevel");}function l(){return o.preprocessorsData;}function m(){return o.oParameterModel;}function n(){var i=c.getModel("i18n").getResourceBundle();return{dataLoadFailedTitle:i.getText("ST_ERROR"),dataLoadFailedText:i.getText("ST_GENERIC_ERROR_LOAD_DATA_TEXT")};}function p(i,q1,r1){if(typeof r1!=="function"){throw new Error("Event handler must be a function");}E.push({template:i,event:q1,handler:r1});}function D(q1,r1,s1){for(var i=E.length;i--;){if(E[i].handler===s1&&E[i].event===r1&&E[i].template===q1){E.splice(i,1);}}}function F(q1,r1,s1){for(var i=0;i<E.length;i++){if(E[i].event===r1&&E[i].template===q1){E[i].handler(s1);}}}function q(i){return i.getMetadata().getName();}function s(){return o.oApplication.isComponentActive(c);}function u(){return o.oNavigationObserver.getProcessFinished(true);}function P(i,q1){var r1=u();r1.then(function(){if(s()){if(q1){O(true);}F(q(o.oController),"PageDataLoaded",{context:i});if(g1()){var s1=i.getObject();if(!s1.IsActiveEntity){o.oApplication.getDraftSiblingPromise(i);}}}});}function v(){h.then(function(i){if(i){P(i);}});}function S(){o.oHeaderLoadingObserver.startProcess();if(!b){var i=new Promise(function(q1){b=q1;});o.oApplication.getBusyHelper().setBusy(i);}}function N(){if(!H){h=new Promise(function(i){H=i;});}}if(t.contextPath){N();}else{h=Promise.resolve();}function w(i){L.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;N();if(!c.getComponentContainer().getElementBinding().isSuspended()){S();}}function x(){if(b){b();b=null;}o.oHeaderLoadingObserver.stopProcess();}function y(i){var q1=i.getSource().getBoundContext();if(q1){return q1;}if(c.getComponentContainer().getElementBinding().isSuspended()){q1=null;}else{q1=C;}U();return q1;}function z(){var i=n();var q1=c.getAppComponent().getNavigationController();q1.navigateToMessagePage({title:i.dataLoadFailedTitle,text:i.dataLoadFailedText,description:"",viewLevel:k()});}function G(){I=false;if(!a){return;}if(a===C){z();U();}else if(!c.getComponentContainer().getElementBinding().isSuspended()){(o.methods.updateBindingContext||jQuery.noop)();if(H){H(a);}}else{return;}H=null;a=null;}function J(i){L.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");x();if(I){a=y(i);}G();}function K(i){var q1=y(i);if(q1&&q1.isPreliminary()){return;}a=q1;G();o.oHeaderLoadingObserver.stopProcess();}function R(i){var q1={createPreliminaryContext:true,canonicalRequest:!o.oTemplateContract.bCreateRequestsCanonical};var r1=l();if(r1.rootContextExpand&&r1.rootContextExpand.length){q1.expand=r1.rootContextExpand.join(",");}o.oHeaderLoadingObserver.startProcess();if(o.methods.beforeRebind){o.methods.beforeRebind();}N();a=null;c.getComponentContainer().bindElement({path:i,events:{dataRequested:w,dataReceived:J,change:K},parameters:q1,batchGroupId:"Changes",changeSetId:"Changes"});if(o.methods.afterRebind){o.methods.afterRebind();}}function U(){N();var i=c.getComponentContainer();i.unbindElement();a=null;I=false;x();}function M(){var q1=b1();var r1=(q1.length===d.length);for(var i=0;i<q1.length&&r1;i++){r1=q1[i]===d[i];}d=q1;return!r1;}function O(i){o.reuseComponentsReady.then(function(q1){for(var r1 in q1){q1[r1].pathUnchangedCallBack(i);}});}function Q(i,q1){var r1=Object.create(null);for(var s1 in i){var t1=i[s1];r1[s1]=q1(t1,s1);}return r1;}function T(){var i=j();for(var q1 in o.routeConfig.embeddedComponents){var r1=!!o.routeConfig.embeddedComponents[q1].hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+q1+"/hidden",r1);}}function V(i,q1){var r1=M();if(r1&&!q1){T();}if(!i){if(o.routingSpec&&o.routingSpec.noOData){P(null,r1);}return;}var s1=c.getComponentContainer();if(!s1){return;}var t1=r(i);if(t1){U();if(H){H(t1);H=null;}else{h=Promise.resolve(t1);}if(!q1){v();}s1.setBindingContext(t1);Promise.all([o.oViewRenderedPromise,o.viewRegistered]).then(O.bind(null,true));}else{var u1=s1.getElementBinding();if(u1){if(u1.getPath()===i){if(u1.isSuspended()){u1.resume();G();}if(I){S();}o.oApplication.getBusyHelper().getUnbusy().then(O.bind(null,r1&&o.routingSpec.noOData));if(!q1){v();}return;}else if(!q1){U();}}var v1=c.getModel("ui");v1.setProperty("/enabled",false);v1.setProperty("/editable",false);R(i);v();}}function W(){var i=c.getComponentContainer().getElementBinding();if(i){c.getModel().invalidateEntry(i.getBoundContext());if(i.isSuspended()){U();}else{i.refresh(true);}}}function X(i){i=i||c.getIsRefreshRequired();if(i||!jQuery.isEmptyObject(o.mRefreshInfos)){(o.methods.refreshBinding||jQuery.noop)(i,o.mRefreshInfos);c.setIsRefreshRequired(false);o.mRefreshInfos=Object.create(null);}O(i);}function Y(i){if(g1()){var q1=c.getComponentContainer();var r1=q1.getElementBinding();if(r1&&!r1.isSuspended()){r1.suspend();i.catch(function(){r1.resume();});}}}function Z(){var i=c.getComponentContainer();if(f()){i.setBindingContext();delete t.createNonDraftInfo;return;}var q1=i.getElementBinding();if(q1&&!q1.isSuspended()){if(o.oTemplateContract.oValidationMessageBinding.getLength()){U();}else{q1.suspend();}x();}}function $(i){o.oApplication.setBackNavigation(i);}function _(i){var q1=k();return o.oApplication.registerContext(i,q1,c.getEntitySet());}function a1(){return o.oApplication.getBreadCrumbInfo(c.getEntitySet());}function b1(){return o.oApplication.getCurrentKeys(k());}function c1(i){return o.oApplication.getCommunicationObject(c,i);}function d1(i,q1,r1,s1){o.oTemplateContract.oNavigationControllerProxy.navigateToChild(i,r1,q1,s1);}function e1(){var i=c.getEntitySet();var t=o.oTemplateContract.mEntityTree[i];return t.headerTitle;}function f1(i){o.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function g1(){if(e===undefined){var i=c.getEntitySet();var t=o.oTemplateContract.mEntityTree[i];e=!!(t&&t.isDraft);}return e;}function h1(){if(g1()){var i=o.oApplication.getHierarchySectionsFromCurrentHash();return"/"+i[0];}}function i1(){return!(o.routingSpec&&o.routingSpec.noOData);}function j1(){return h;}function k1(){return o.oTemplateContract.oPaginatorInfo[k()-1];}function l1(i,q1){var r1=k();if(!q1){r1--;}o.oTemplateContract.oPaginatorInfo[r1]=i;}function m1(i,q1){o.reuseComponentsReady.then(function(r1){var s1=q1.getComponentInstance();for(var t1 in r1){if(s1===r1[t1].component){var u1=j();u1.setProperty("/generic/embeddedComponents/"+t1+"/isInVisibleArea",i);return;}}});}function n1(i){i.oStatePreserverPromise=o.reuseComponentsReady.then(function(q1){var r1={appStateName:encodeURI("sap-iapp-state-"+o.routeConfig.entitySet),getCurrentState:function(){var t1=i.getCurrentState?i.getCurrentState():Object.create(null);var u1=function(v1,w1){if(v1.component.stGetCurrentState){var x1=v1.component.stGetCurrentState();for(var y1 in x1){t1["$embeddedComponent$"+w1.length+"$"+w1+"$"+y1]=x1[y1];}}};Q(q1,u1);return t1;},applyState:function(t1,u1){var v1=Object.create(null);var w1=Object.create(null);for(var x1 in t1){if(x1.indexOf("$embeddedComponent$")===0){var y1=x1.substring(19);var z1=y1.indexOf("$");var A1=Number(y1.substring(0,z1));var B1=y1.substring(z1+1,z1+A1+1);var C1=w1[B1];if(!C1){C1=Object.create(null);w1[B1]=C1;}var D1=y1.substring(z1+A1+2);C1[D1]=t1[x1];}else{v1[x1]=t1[x1];}}(i.applyState||jQuery.noop)(v1,u1);var E1=function(F1,G1){if(F1.component.stApplyState){F1.component.stApplyState(w1[G1]||Object.create(null),u1);}};Promise.all([o.oViewRenderedPromise,h]).then(Q.bind(null,q1,E1));},oComponent:c};var s1=o.oApplication.getStatePreserver(r1);o.oApplication.registerStateChanger(s1.getAsStateChanger());return s1;});o.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([o.oTemplateContract.oStatePreserversAvailablePromise,i.oStatePreserverPromise]);}function o1(){var i=o.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:jQuery.noop,isListAndFirstEntryLoadedOnStartup:t.level?null:jQuery.noop};}function p1(){return t.page.component.settings||{};}return{setEditableNDC:function(i){o.oApplication.setEditableNDC(i);},getEditableNDC:function(){return o.oApplication.getEditableNDC();},getBusyHelper:function(){return o.oApplication.getBusyHelper();},isNonDraftCreate:f,attach:function(i,q1,r1){p(q(i),q1,r1);},detach:function(i,q1,r1){D(q(i),q1,r1);},fire:function(i,q1,r1){F(q(i),q1,r1);},isListReportTemplate:function(){return A.isListReportTemplate(o.routeConfig);},getPreprocessorsData:l,getParameterModelForTemplating:m,bindComponent:V,refreshBinding:X,refreshBindingUnconditional:W,suspendBinding:Z,setBackNavigation:$,getTemplatePrivateModel:j,registerContext:_,getViewLevel:k,getBreadCrumbInfo:a1,getCurrentKeys:b1,getDraftRootPath:h1,getCommunicationObject:c1,navigateRoute:d1,getTitleFromTreeNode:e1,setText:f1,onBeforeDraftTransfer:Y,isDraftEnabled:g1,isODataBased:i1,isComponentActive:s,navigateToDataLoadedFailedPage:z,getHeaderDataAvailablePromise:j1,getPaginatorInfo:k1,setPaginatorInfo:l1,onVisibilityChangeOfReuseComponent:m1,getNavigationFinishedPromise:u,setStatePreserverPromise:n1,unbind:U,getFclProxy:o1,getSettings:p1};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(c,o){Object.assign(this,g(c,o));}});});
