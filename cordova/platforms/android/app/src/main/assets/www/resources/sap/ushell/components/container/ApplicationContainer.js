// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","sap/ushell/utils","sap/ushell/ApplicationType","sap/m/MessagePopover","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/thirdparty/URI","sap/ushell/EventHub","sap/ui/core/Icon","sap/ushell/System","sap/ushell/User","sap/m/Text","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/util/uid","sap/base/security/encodeXML"],function(D,u,A,M,C,a,b,U,E,I,S,c,T,d,f,g,h){"use strict";var p="sap.ushell.components.container.",s=p+"ApplicationContainer",i="sap.ushell.Container.dirtyState.",l,o,H,r;var j=["sap-ach","sap-target-navmode","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-defaultedParameterNames","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url"];function k(e){var a1=sap.ushell.Container.getService("CrossApplicationNavigation");a1.isUrlSupported(e.url).done(function(){e.promise.resolve({"allowed":true,"id":e.id});}).fail(function(){e.promise.resolve({"allowed":false,"id":e.id});});}function m(e){var a1={"asyncURLHandler":_.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(a1);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(m);l=new u.Map();function n(e){return l.get(e.getId());}function q(){return o;}function t(e){var a1=new d(e).mParams,b1=a1["sap-xapp-state"],c1;delete a1["sap-xapp-state"];c1={startupParameters:a1};if(b1){c1["sap-xapp-state"]=b1;}return c1;}function v(e,a1){if(!r){r=jQuery.sap.resources({url:jQuery.sap.getModulePath(p)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return r.getText(e,a1);}function w(){return new I({size:"2rem",src:"sap-icon://error",tooltip:_.prototype._getTranslatedText("an_error_has_occured")});}function x(e){var a1=e.getAggregation("child"),b1;if(a1 instanceof a){b1=a1.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");jQuery.sap.log.debug("unloading component "+b1,null,s);}e.destroyAggregation("child");}function y(e,a1,b1){var c1,d1,e1,f1,g1,h1,i1,j1={},k1,l1;e1=a1.indexOf("?");if(e1>=0){h1=_.prototype._getParameterMap(a1);j1=h1.startupParameters;a1=a1.slice(0,e1);}if(a1.slice(-1)!=="/"){a1+="/";}if(/\.view\.(\w+)$/i.test(b1)){g1=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(b1);if(!g1){jQuery.sap.log.error("Invalid SAPUI5 URL",b1,s);return _.prototype._createErrorControl();}i1=g1[1];k1=g1[2];l1=g1[3].toUpperCase();if(i1){k1=i1+"."+k1;}else{f1=k1.lastIndexOf(".");if(f1<1){jQuery.sap.log.error("Missing namespace",b1,s);return _.prototype._createErrorControl();}i1=k1.slice(0,f1);}}else{i1=b1.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(i1,a1+i1.replace(/\./g,"/"));_.prototype._destroyChild(e);if(k1){if(e.getApplicationConfiguration()){j1.config=e.getApplicationConfiguration();}d1=sap.ui.view({id:e.getId()+"-content",type:l1,viewData:j1||{},viewName:k1});e.fireEvent("applicationConfiguration");}else{jQuery.sap.log.debug("loading component "+i1,null,s);var m1=h1?{startupParameters:h1.startupParameters}:{startupParameters:{}};if(h1&&h1["sap-xapp-state"]){m1["sap-xapp-state"]=h1["sap-xapp-state"];}if(e.getApplicationConfiguration()){m1.config=e.getApplicationConfiguration();}c1=sap.ui.component({id:e.getId()+"-component",componentData:m1,name:i1});e.fireEvent("applicationConfiguration",{"configuration":c1.getMetadata().getConfig()});d1=new a({id:e.getId()+"-content",component:c1});}d1.setWidth(e.getWidth());d1.setHeight(e.getHeight());d1.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",d1,true);return d1;}function z(e,a1){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,a1);},0);}function B(e,a1,b1){var c1,d1,e1,f1,g1={startupParameters:{}},h1,i1=e.getComponentHandle(),j1=sap.ushell.Container.getService("PluginManager"),k1,l1;u.addTime("createUi5Component");c1=a1.indexOf("?");if(c1>=0){f1=_.prototype._getParameterMap(a1);g1={startupParameters:f1.startupParameters};if(f1["sap-xapp-state"]){g1["sap-xapp-state"]=f1["sap-xapp-state"];}a1=a1.slice(0,c1);}if(e.getApplicationConfiguration()){g1.config=e.getApplicationConfiguration();}if(a1.slice(-1)!=="/"){a1+="/";}_.prototype._destroyChild(e);h1={id:e.getId()+"-component",name:b1,componentData:g1};jQuery.sap.log.debug("Creating component instance for "+b1,JSON.stringify(h1),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:b1});if(i1){d1=i1.getInstance(h1);}else{jQuery.sap.registerModulePath(b1,a1);jQuery.sap.log.error("No component handle available for '"+b1+"'; fallback to component.load()",null,s);d1=sap.ui.component({id:e.getId()+"-component",name:b1,componentData:g1});}e.fireEvent("applicationConfiguration",{"configuration":d1.getMetadata().getConfig()});e1=new a({id:e.getId()+"-content",component:d1});e1.setHeight(e.getHeight());e1.setWidth(e.getWidth());e1.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=_.prototype._disableRouter.bind(this,d1);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",e1,true);if(j1){k1=j1.getPluginLoadingPromise("RendererExtensions");l1=k1&&k1.state();if(l1==="pending"){k1.done(function(){_.prototype._publishExternalEvent("appComponentLoaded",{component:d1});}).fail(function(){_.prototype._publishExternalEvent("appComponentLoaded",{component:d1});});}if(l1==="resolved"||l1==="rejected"){_.prototype._publishExternalEvent("appComponentLoaded",{component:d1});}}else{_.prototype._publishExternalEvent("appComponentLoaded",{component:d1});}return e1;}function F(e){var rt;if((e instanceof C)&&(typeof e.getRouter==="function")){rt=e.getRouter();if(rt&&(typeof rt.stop==="function")){jQuery.sap.log.info("router stopped for instance "+e.getId());rt.stop();}}}function G(e){var a1=document.createElement("a"),b1=new d(e).get("sap-client"),c1;a1.href=e;c1=a1.protocol+"//"+a1.host;return new S({alias:b1?c1+"?sap-client="+b1:c1,baseUrl:c1,client:b1||undefined,platform:"abap"});}function J(e,a1){var b1=false,c1=e.getDomRef(),d1,e1;if(new d(window.location.href).get("sap-post")==="true"&&c1&&c1.getAttribute&&c1.getAttribute("sap-iframe-app")=="true"){c1=jQuery("#"+c1.getAttribute("id")+"-iframe")[0];}if(c1){d1=U(c1.src||window.location&&window.location.href||"");e1=d1.protocol()+"://"+d1.host();b1=(a1.source===c1.contentWindow)||(a1.origin===e1);}return b1;}function K(e,a1,b1){var c1=JSON.stringify({type:"request",service:a1,request_id:g(),body:{}});jQuery.sap.log.debug("Sending post message request to origin ' "+b1+"': "+c1,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(c1,b1);}function L(){var e=this.getDomRef();if(!e||e.tagName!=="IFRAME"){if(new d(window.location.href).get("sap-post")==="true"&&e&&e.getAttribute&&e.getAttribute("sap-iframe-app")=="true"){return jQuery("#"+e.getAttribute("id")+"-iframe")[0];}return null;}return e;}function N(e,a1){var b1=e.getUi5ComponentName&&e.getUi5ComponentName(),c1=a1.data;if(typeof b1==="string"){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(c1)+"' on container of UI5 application '"+b1+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(!e.getActive()){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(c1)+"' on inactive container '"+e.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}H(e,a1);}function O(e,a1){var b1=e._getIFrame(),c1=e.getApplicationType();if(u.isApplicationTypeEmbeddedInIframe(e.getApplicationType(c1))&&b1){var d1=new U(b1.src);var e1=d1.protocol()+"://"+d1.host();b1.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),e1);a1.preventDefault();}}function P(e,a1,b1){e.write("<div").writeControlData(a1).writeAccessibilityState(a1).addClass("sapUShellApplicationContainer").writeClasses(a1).addStyle("height",a1.getHeight()).addStyle("width",a1.getWidth()).writeStyles().write(">").renderControl(b1);e.write("</div>");}function Q(e,a1,b1,c1){var d1,e1=function(){var l1=u.getParameterValueBoolean("sap-accessibility");if(l1!==undefined){return l1;}return sap.ushell.Container.getUser().getAccessibilityMode();},f1=function(){var l1=new d(e)||{mParams:{}};if(l1.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(c.prototype.constants.themeFormat.NWBC);}return undefined;},g1=function(){var l1=false,m1=new d(e)||{mParams:{}};l1=sap.ui.getCore().getConfiguration().getStatistics()&&m1.mParams["sap-statistics"]===undefined;return l1;},h1=function(){var l1=window.hasher&&window.hasher.getHash(),j1="",m1;if(l1&&l1.length>0&&l1.indexOf("sap-iapp-state=")>0){m1=/(?:sap-iapp-state=)([^&/]+)/.exec(l1);if(m1&&m1.length===2){j1=m1[1];}}return j1;},i1=function(){var l1="";var m1=(!!jQuery("body.sapUiSizeCompact").length);var n1=(!!jQuery("body.sapUiSizeCozy").length);if(m1===true){l1="0";}else if(n1){l1="1";}return l1;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";d1=f1();if(d1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(d1);}if(b1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(b1);}if(e1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(g1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(c1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var j1=h1();if(j1&&j1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+j1;}var k1=i1();if(k1&&k1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+k1;}return u.appendSapShellParam(e,a1);}function R(e,a1,b1,c1){var d1=a1.getAggregation("child");if(!d1||a1._bRecreateChild){d1=_.prototype._createUi5Component(a1,b1,c1);a1._bRecreateChild=false;}_.prototype._renderControlInDiv(e,a1,d1);}function V(e,a1,b1){var c1=e.getProperty(a1);if(f(c1,b1)){return;}e.setProperty(a1,b1);e._bRecreateChild=true;}function W(e,a1,b1,c1,d1){var e1;localStorage.removeItem(a1.globalDirtyStorageKey);if(d1&&d1.indexOf("SAPUI5.Component=")===0&&b1===A.URL.type){R(e,a1,c1,d1.replace(/^SAPUI5\.Component=/,""));return;}if(d1&&d1.indexOf("SAPUI5=")===0&&b1===A.URL.type){_.prototype._renderControlInDiv(e,a1,_.prototype._createUi5View(a1,c1,d1));return;}jQuery.sap.log.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+d1);if(!a1.getActive()){jQuery.sap.log.debug("Skipping rendering container iframe","Container '"+a1.getId()+"' is inactive");return;}try{c1=a1.getFrameSource(b1,c1,d1);}catch(ex){jQuery.sap.log.error(ex.message||ex,null,s);a1.fireEvent("applicationConfiguration");e.renderControl(_.prototype._createErrorControl());return;}if(sap.ushell.Container){e1=_.prototype._getLogoutHandler(a1);if(!e1){if(u.isApplicationTypeEmbeddedInIframe(b1)){e1=_.prototype._logout.bind(null,a1);l.put(a1.getId(),e1);sap.ushell.Container.attachLogoutEvent(e1);sap.ushell.Container.addRemoteSystem(_.prototype._createSystemForUrl(c1));}}else if(!u.isApplicationTypeEmbeddedInIframe(b1)){sap.ushell.Container.detachLogoutEvent(e1);l.remove(a1.getId());}}if(u.isApplicationTypeEmbeddedInIframe(b1)){var g1=a1.getTargetNavigationMode();c1=_.prototype._adjustNwbcUrl(c1,b1,g1,a1.getIsStateful());u.localStorageSetItem(a1.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}var h1=new U();if(h1.query(true).hasOwnProperty("sap-isolation-enabled")){var i1=sap.ushell.Container.getService("URLParsing"),j1=i1.getHash(h1.toString());if(j1){var k1=i1.parseShellHash("#"+j1),l1=i1.paramsToString(k1.params);if(l1&&l1.length>=0){var m1=sap.ushell.Container.getService("AppState").createEmptyAppState(),n1=sap.ushell.Container.getService("AppState").createEmptyAppState(),o1="";if(l1.indexOf("sap-intent-param")>=0){o1=encodeURIComponent(l1);}else{m1.setData(l1);m1.save();o1=encodeURIComponent("sap-intent-param="+m1.getKey());}n1.setData("sap-startup-params="+o1);n1.save();c1=c1.split("#")[0]+"&sap-intent-param="+n1.getKey()+"#"+window.hasher.getHash();}else{c1=c1.split("#")[0]+"#"+window.hasher.getHash();}}else{c1+="#"+window.hasher.getHash();}}if(new d(window.location.href).get("sap-post")==="true"&&u.isApplicationTypeEmbeddedInIframe(b1)){a1.oDeferredRenderer=new jQuery.Deferred();c1=_.prototype._filterURLParams(c1);var p1=[];var q1=_.prototype._getParamKeys(c1,p1);_.prototype._generateRootElementForIFrame(e,a1,true);if(q1.length>0){var r1=sap.ushell.Container.getService("CrossApplicationNavigation");r1.getAppStateData(q1).then(function(f1){var s1;var t1=jQuery("#"+a1.getId());if(t1){s1=sap.ui.getCore().createRenderManager();_.prototype._buildHTMLElements(s1,a1,f1,p1,c1,true);s1.flush(t1[0]);s1.destroy();a1.oDeferredRenderer.resolve();}},function(f1){_.prototype._buildHTMLElements(e,a1,undefined,p1,c1,true);a1.oDeferredRenderer.resolve();});}else{_.prototype._buildHTMLElements(e,a1,undefined,p1,c1,false);a1.oDeferredRenderer.resolve();}_.prototype._generateRootElementForIFrame(e,a1,false);return;}a1.fireEvent("applicationConfiguration");e.write("<iframe").writeControlData(a1).writeAccessibilityState(a1).writeAttributeEscaped("src",c1).addClass("sapUShellApplicationContainer").writeClasses(a1).addStyle("height",a1.getHeight()).addStyle("width",a1.getWidth()).writeStyles().write("></iframe>");}function X(e){var a1=new U(e);a1=a1.removeSearch(j);return a1.toString();}function Y(e,a1){var b1=[],c1;if(e.indexOf("sap-intent-param=")>0){c1=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(c1&&c1.length===2){b1.push([c1[1]]);a1.push("sap-intent-param-data");}}if(e.indexOf("sap-xapp-state=")>0){c1=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(c1&&c1.length===2){b1.push([c1[1]]);a1.push("sap-xapp-state-data");}}if(e.indexOf("sap-iapp-state=")>0){c1=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(c1&&c1.length===2){b1.push([c1[1]]);a1.push("sap-iapp-state-data");}}return b1;}function Z(e,a1,b1,c1,d1,e1){var f1=a1.getId()+"-form";var g1="";var h1="";if(b1===undefined){b1=[];}b1.push([sap.ushell.Container.getFLPUrl(true)]);c1.push("sap-flp-url");var i1="";c1.forEach(function(k1,l1){if(b1[l1][0]){if(typeof b1[l1][0]==="object"){i1=JSON.stringify(b1[l1][0]);}else{i1=b1[l1][0];}g1="<input name=\""+k1+"\" value=\""+h(i1)+"\"/>";h1+=g1;}});a1.fireEvent("applicationConfiguration");e.write("<form").writeAttributeEscaped("method","post").writeAttributeEscaped("id",f1).writeAttributeEscaped("name",f1).writeAttributeEscaped("target",a1.getId()+"-iframe").writeAttributeEscaped("action",d1).addStyle("display","none").writeStyles().write(">").writeAttributeEscaped(h1).write("</form>");var j1=a1.sId;if(!e1){a1.toggleStyleClass("hidden",false);}a1.sId+="-iframe";e.write("<iframe").writeAttributeEscaped("name",a1.getId()).writeControlData(a1).writeAccessibilityState(a1).addClass("sapUShellApplicationContainer").writeClasses(a1).addStyle("height",a1.getHeight()).addStyle("width",a1.getWidth()).writeStyles().write("></iframe>");a1.sId=j1;if(!e1){a1.toggleStyleClass("hidden",true);}}function $(e,a1,b1){if(b1){e.write("<div").writeControlData(a1).writeAccessibilityState(a1).writeAttributeEscaped("sap-iframe-app","true").addClass("sapUShellApplicationContainer").writeClasses(a1).addStyle("height",a1.getHeight()).addStyle("width",a1.getWidth()).writeStyles().write(">");}else{e.write("</div>");}}var _=b.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:p+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{defaultValue:undefined,type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},beforeAppCloseEvent:{type:"object"}},events:{"applicationConfiguration":{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,a1=this;if(sap.ushell.Container){e=_.prototype._getLogoutHandler(a1);if(e){sap.ushell.Container.detachLogoutEvent(e);l.remove(a1.getId());}}localStorage.removeItem(a1.globalDirtyStorageKey);if(a1._unloadEventListener){removeEventListener("unload",a1._unloadEventListener);}if(a1._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",a1._disableRouterEventHandler);}if(a1._storageEventListener){removeEventListener("storage",a1._storageEventListener);}if(a1._messageEventListener){removeEventListener("message",a1._messageEventListener);}_.prototype._destroyChild(a1);if(b.exit){b.exit.apply(a1);}},setHandleMessageEvent:function(e){H=e;},init:function(){var e=this;e.globalDirtyStorageKey=i+g();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(a1){var b1=e.getApplicationType();if(a1.key===e.globalDirtyStorageKey&&a1.newValue===sap.ushell.Container.DirtyState.PENDING&&u.isApplicationTypeEmbeddedInIframe(b1)){var c1=e._getIFrame();if(c1){jQuery.sap.log.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var d1=new U(c1.src);var e1=d1.protocol()+"://"+d1.host();c1.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),e1);}}};addEventListener("storage",e._storageEventListener);e._messageEventListener=_.prototype._handleMessageEvent.bind(null,e);addEventListener("message",e._messageEventListener);},onAfterRendering:function(){var e=this;this.rerender=function(){};if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){if(!e.bFirst){var a1=document.getElementById(e.getId()+"-form");if(a1){a1.submit();}e.bFirst=true;}});}},renderer:function(e,a1){var b1=a1.getApplication(),c1=a1.launchpadData,d1;if(!a1.getVisible()){_.prototype._renderControlInDiv(e,a1);return;}if(a1.error){delete a1.error;_.prototype._renderControlInDiv(e,a1,_.prototype._createErrorControl());}else if(!b1){_.prototype._render(e,a1,a1.getApplicationType(),a1.getUrl(),a1.getAdditionalInformation());}else if(!b1.isResolvable()){_.prototype._render(e,a1,b1.getType(),b1.getUrl(),"");}else if(c1){_.prototype._render(e,a1,c1.applicationType,c1.Absolute.url.replace(/\?$/,""),c1.applicationData);}else{jQuery.sap.log.debug("Resolving "+b1.getUrl(),null,s);b1.resolve(function(e1){jQuery.sap.log.debug("Resolved "+b1.getUrl(),JSON.stringify(e1),s);a1.launchpadData=e1;_.prototype._destroyChild(a1);},function(e1){var f1=b1.getMenu().getDefaultErrorHandler();if(f1){f1(e1);}_.prototype._destroyChild(a1);a1.error=e1;});d1=new T({text:_.prototype._getTranslatedText("loading",[b1.getText()])});_.prototype._destroyChild(a1);a1.setAggregation("child",d1);_.prototype._renderControlInDiv(e,a1,d1);}}});_.prototype.getFrameSource=function(e,a1){if(!Object.prototype.hasOwnProperty.call(A.enum,e)){throw new Error("Illegal application type: "+e);}return a1;};_.prototype.setUrl=function(e){V(this,"url",e);};_.prototype.setAdditionalInformation=function(e){V(this,"additionalInformation",e);};_.prototype.setApplicationType=function(e){V(this,"applicationType",e);};_.prototype.createPostMessageRequest=function(e,a1){var b1=Date.now().toString();return{"type":"request","request_id":b1,"service":e,"body":a1};};_.prototype.setNewTRApplicationContext=function(e){var a1=this._getIFrame();if(!a1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}e=u.appendSapShellParam(e);var b1=this.createPostMessageRequest("sap.its.startService",{"url":e});return this.postMessageToIframe(b1,a1,true).catch(function(c1){return Promise.reject({eventData:c1,message:"Failed to change application context."});});};_.prototype.postMessageToIframe=function(a1,b1,c1){var d1=this;var e1=a1.request_id;return new Promise(function(f1,g1){function h1(l1){var m1;try{m1=JSON.parse(l1.data,d1);if(e1!==m1.request_id){return;}if(m1.status==="success"){f1(m1);}else{g1(m1);}window.removeEventListener("message",h1);}catch(e){f1();jQuery.sap.log.warning("Obtained bad response from framework in response to message "+a1.request_id);jQuery.sap.log.debug("Underlying framework returned invalid response data: '"+l1.data+"'");}}var i1=JSON.stringify(a1);jQuery.sap.log.debug("Sending postMessage "+i1+" to application container '"+d1.getId()+"'");var j1=new U(b1.src);var k1=j1.protocol()+"://"+j1.host();if(c1){window.addEventListener("message",h1,false);b1.contentWindow.postMessage(i1,k1);}else{b1.contentWindow.postMessage(i1,k1);f1();}});};_.prototype.postMessageToCurrentIframe=function(e,a1){if(a1===undefined){a1=false;}var b1=this._getIFrame();if(!b1){if(a1){return Promise.reject({message:"Expected opened iframe not found."});}return;}return this.postMessageToIframe(e,b1,a1);};_.prototype.setNewApplicationContext=function(e,a1){var b1=this;var c1=this["setNew"+e+"ApplicationContext"];if(!c1){return Promise.reject({message:"Unsupported application type"});}var d1=this._getIFrame();if(!d1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var e1=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(e1,d1,true).then(function(){return c1.call(b1,a1);},function(f1){return Promise.reject({eventData:f1,message:"Failed to change application context."});});};_.prototype.onApplicationOpened=function(e){var a1=this.getIsStateful();if(!a1){return Promise.resolve();}var b1=this.getApplicationType();if(b1==="TR"&&e!=="TR"){var c1=this._getIFrame();if(!c1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var d1=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(d1,c1,false).catch(function(e1){return Promise.reject({eventData:e1,message:"Failed to change application context."});});}return Promise.resolve();};_.prototype.postMessageRequest=function(e,a1){var b1=this._getIFrame();if(!b1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var c1=this.createPostMessageRequest(e,a1||{});return this.postMessageToIframe(c1,b1,false).catch(function(d1){return Promise.reject({eventData:d1,message:"Failed to post message."});});};_.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),a1;if(e&&e.enabled&&e.enabled===true){a1=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(a1,this._getIFrame(),true);}else{return undefined;}};_.prototype._getCommunicationHandlers=q;_.prototype._adaptIsUrlSupportedResultForMessagePopover=k;_.prototype._getLogoutHandler=n;_.prototype._getParameterMap=t;_.prototype._getTranslatedText=v;_.prototype._createErrorControl=w;_.prototype._destroyChild=x;_.prototype._createUi5View=y;_.prototype._publishExternalEvent=z;_.prototype._createUi5Component=B;_.prototype._disableRouter=F;_.prototype._createSystemForUrl=G;_.prototype._isTrustedPostMessageSource=J;_.prototype._handleMessageEvent=N;_.prototype._logout=O;_.prototype._renderControlInDiv=P;_.prototype._adjustNwbcUrl=Q;_.prototype._render=W;_.prototype._getParamKeys=Y;_.prototype._buildHTMLElements=Z;_.prototype._generateRootElementForIFrame=$;_.prototype._backButtonPressedCallback=K;_.prototype._getIFrame=L;_.prototype._filterURLParams=X;return _;},true);
