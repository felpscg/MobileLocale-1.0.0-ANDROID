// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/components/SharedComponentUtils","sap/ushell/Config","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/utils"],function(r,A,s,C,q,L,u){"use strict";function _(){return sap.ushell.Container.getRenderer("fiori2");}function a(){return A.getElementsModel().getModel();}function G(v,i,j,k,t,o,l,m,n,p,M,w,x){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId(v)){if(j==="xml"){this.view=sap.ui.xmlview(v,i);}else{this.view=sap.ui.jsview(v,i);}}if(M){this.view.setModel(M);}return this.view;};return{entryHelpID:k,title:t,valueResult:null,onSave:o?o.bind(this):function(){if(this.getView().getController().onSave){return this.getView().getController().onSave();}}.bind(this),onCancel:l?l.bind(this):function(){if(this.getView().getController().onCancel){return this.getView().getController().onCancel();}}.bind(this),contentFunc:m?m.bind(this):function(){if(this.getView().getController().getContent){return this.getView().getController().getContent();}}.bind(this),valueArgument:n?n.bind(this):function(){var y=new q.Deferred(),z=this;setTimeout(function(){if(z.getView().getController().getValue){z.getView().getController().getValue().done(function(B){y.resolve(B);});}},0);return y.promise();}.bind(this),editable:typeof p==="function"?p():p,contentResult:null,icon:w,defaultVisibility:x};}function c(m){return function(){return this.getView().getController()[m]();};}function b(p){var E={entryHelpID:p.entryHelpId,title:r.i18n.getText(p.i18nTitleKey),editable:true,valueResult:null,contentResult:null,icon:p.icon,getView:function(){var i=p.viewType==="xml"?sap.ui.xmlview:sap.ui.jsview;var v=sap.ui.getCore().byId(p.viewId);if(!v){v=i(p.viewId,p.componentNamespace);}return v;}};E.valueArgument=c("getValue").bind(E);E.onSave=c("onSave").bind(E);E.onCancel=c("onCancel").bind(E);E.contentFunc=c("getContent").bind(E);return E;}function d(){return b({entryHelpId:"language",i18nTitleKey:"languageRegionTit",icon:"sap-icon://globe",viewId:"languageRegionSelector",componentNamespace:"sap.ushell.components.shell.UserSettings.LanguageRegionSelector"});}function U(){return b({entryHelpId:"UserActivitiesEntry",i18nTitleKey:"userActivities",icon:"sap-icon://laptop",viewId:"userActivitiesHandler",componentNamespace:"sap.ushell.components.shell.UserSettings.userActivitiesHandler"});}function e(){var S=_().getShellConfig();var i=S.enableUserImgConsent;var v=i?"userAccountSelector":"userAccountSetting";var j=i?"sap.ushell.components.shell.UserSettings.userAccount.UserAccountSelector":"sap.ushell.components.shell.UserSettings.userAccount.UserAccountSetting";return b({entryHelpId:"userAccountEntry",i18nTitleKey:"UserAccountFld",icon:"sap-icon://account",viewId:v,componentNamespace:j,viewType:"xml"});}function f(){var m=a(),o=sap.ushell.Container.getUser();var t=new G("userPrefThemeSelector","sap.ushell.components.shell.UserSettings.ThemeSelector","xml","themes",r.i18n.getText("Appearance"),function(){var w=this.getView().getController().onSave();w.done(function(){if(C.last("/core/home/enableTilesOpacity")){u.handleTilesOpacity();}});return w;},undefined,undefined,undefined,function(){if(C.last("/core/shell/model/setTheme")!==undefined){return C.last("/core/shell/model/setTheme")&&o.isSetThemePermitted();}return o.isSetThemePermitted();},m,"sap-icon://palette");var i=new G("userPrefUsageAnalyticsSelector","sap.ushell.components.shell.UserSettings.UsageAnalyticsSelector","js","usageAnalytics",r.i18n.getText("usageAnalytics"),undefined,undefined,undefined,undefined,sap.ushell.Container.getService("UsageAnalytics").isSetUsageAnalyticsPermitted());var j=new G("defaultParametersSelector","sap.ushell.components.shell.UserSettings.DefaultParameters","js","defaultParameters",r.i18n.getText("defaultsValuesEntry"),undefined,undefined,undefined,undefined,true,undefined,undefined,false);var k=new G("userProfilingView","sap.ushell.components.shell.UserSettings.UserProfiling","js","userProfiling",r.i18n.getText("userProfiling"),undefined,undefined,undefined,undefined,false,m,"sap-icon://user-settings",false);var l=[new e(),t,new d()],p=[];p.push(i);var n=C.last("/core/shell/enableRecentActivity");if(n){l.push(new U());}l.push(k);if(C.last("/core/shell/model/enableNotifications")===true){var N=sap.ushell.Container.getService("Notifications")._getNotificationSettingsAvalability(),v;v=new G("notificationSettings","sap.ushell.components.shell.Notifications.Settings","js","notification",r.i18n.getText("notificationSettingsEntry_title"),undefined,undefined,undefined,undefined,true,undefined,"sap-icon://bell",false);l.push(v);N.done(function(S){if(S.settingsAvailable){v.visible=true;C.last("/core/shell/model/userPreferences/entries").every(function(w,x){if(w.title===r.i18n.getText("notificationSettingsEntry_title")){m.setProperty("/userPreferences/entries/"+x+"/visible",true);return false;}return true;});}});}if(C.last("/core/shell/model/userDefaultParameters")){l.push(j);}var E=C.last("/core/home/enableHomePageSettings");if(E!==false){l.push(g());}return{dialogTitle:r.i18n.getText("userSettings"),isDetailedEntryMode:false,activeEntryPath:null,entries:l,profiling:p};}function g(){var R=_(),o=r.i18n;var i;var E={title:o.getText("FlpSettings_entry_title"),entryHelpID:"flpSettingsEntry",valueArgument:function(){return q.Deferred().resolve(" ");},contentFunc:function(){var D=new q.Deferred();s.getEffectiveHomepageSetting("/core/home/homePageGroupDisplay","/core/home/enableHomePageSettings").then(function(j){i=sap.ui.xmlview({viewName:"sap.ushell.components.shell.UserSettings.FlpSettings",viewData:{initialDisplayMode:j||"scroll"}});D.resolve(i);});return D;},onSave:function(){var D=i.getController().onSave();var j=s.getPersonalizer("homePageGroupDisplay",R).setPersData(D);j.fail(function(k){L.error("Failed to save the anchor bar mode in personalization",k,"sap.ushell.components.flp.settings.FlpSettings");});C.emit("/core/home/homePageGroupDisplay",D);return q.Deferred().resolve();},onCancel:function(){return q.Deferred().resolve();},icon:"sap-icon://home"};return E;}function h(){var i=C.last("/core/shell/model/userPreferences/entries");var D=f();D.entries=D.entries.concat(i);D.entries=_().reorderUserPrefEntries(D.entries);a().setProperty("/userPreferences",D);}return{setModel:h};});
