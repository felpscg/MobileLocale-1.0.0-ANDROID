sap.ui.define(["sap/ui/thirdparty/jquery","sap/m/Dialog","sap/m/Button","sap/ovp/cards/PayLoadUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/rta/SettingsDialogConstants","sap/ovp/cards/CommonUtils","sap/ui/Device","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/m/Link","sap/m/MessageBox","sap/ovp/cards/AnnotationHelper","sap/ui/core/mvc/ViewType","sap/ui/model/json/JSONModel","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/Log","sap/base/util/merge"],function(Q,D,B,P,O,S,C,a,M,b,L,c,A,V,J,d,e,f,m){"use strict";var r=d;function g(i,q,h1){var i1=i.getComponentInstance(),j1=i1.getComponentData(),k1=j1.appComponent,l1=j1.mainComponent,m1=(h1)?"":j1.cardId,n1=m1+"Dialog",o1=(h1)?"":j1.modelName,p1=(!o1)?undefined:k1.getModel(o1),q1=q.getModel().getData(),r1={cards:{}};r1.cards[n1]={template:q1.template,settings:q1};if(g1.bNewKPICardFlag){var s1=q1.selectedKPI;p1=new sap.ui.model.odata.v2.ODataModel(s1.ODataURI,{'annotationURI':s1.ModelURI,'defaultCountMode':sap.ui.model.odata.CountMode.None});o1=C._getLayerNamespace()+".kpi_card_model_"+k(s1.ODataURI);}if(p1&&!!o1){r1.cards[n1].model=o1;q.setModel(p1,o1);}r1.cards[n1]=l1._getTemplateForChart(r1.cards[n1]);q.getController()._oManifest=r1;if(g1.bNewKPICardFlag){p1.getMetaModel().loaded().then(function(){var t1=O.createCardComponent(q,r1,"dialogCard");t1.then(function(){q.setBusy(false);}).catch(function(){n(r1.cards[n1].settings,"OVP_KEYUSER_ANNOTATION_FAILURE");l(q,r1,n1);});},function(t1){f.error(t1);});p1.attachMetadataFailed(function(){n(r1.cards[n1].settings,"OVP_KEYUSER_METADATA_FAILURE");l(q,r1,n1);});}else{O.createCardComponent(q,r1,"dialogCard");}}function s(i,q){if(!this.oNewDataSources[i]){this.oNewDataSources[i]={uri:q};}}function h(i){if(this.oNewDataSources[i]){delete this.oNewDataSources[i];}}function j(i){var q=this.oAppComponent.getMetadata(),h1=q.getManifestEntry("sap.app").dataSources;if(this.oNewDataSources[i]){return this.oNewDataSources;}return h1;}function k(i){var q=i.split("/");return q[q.length-1]?q[q.length-1]:q[q.length-2];}function l(i,q,h1){q.cards[h1].template="sap.ovp.cards.error";q.cards[h1].model=undefined;var i1=O.createCardComponent(i,q,"dialogCard");var j1=i.getController();i1.then(function(){i.setBusy(false);j1.setBusy(false);}).catch(function(){i.setBusy(false);j1.setBusy(false);});}function n(i,q){if(i){i.errorStatusText=d.getText(q);}}function o(i){if(i.indexOf('#')!==-1){return i.split('#')[1];}else{return"Default";}}function p(i,q){if(i){var h1,i1,j1;if(i.indexOf("{")===0&&i.indexOf("}")===i.length-1){i=i.slice(1,-1);if(i.indexOf(">")!=-1){h1=i.split(">");j1=h1[0];i1=h1[1];}else if(i.indexOf("&gt;")!=-1){h1=i.split("&gt;");j1=h1[0];i1=h1[1];}if(!!i1&&j1==="@i18n"&&g1.oi18nModel){return g1.oi18nModel.getProperty(i1);}else{return i;}}else{return i;}}else{return q;}}function t(i,q,h1,i1){if(q[i]&&q[i][h1]){return p(q[i][h1].String,i1);}else{return i1;}}function u(i,q){var h1=o(q),i1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[h1]);i1=(i1)?i1:h1;if(q.indexOf(",")!==-1){q=q.split(",")[0];}if(q.indexOf(".Identification")!==-1){if(i[q]){var j1=A.sortCollectionByImportance(i[q]);for(var k1=0;k1<j1.length;k1++){var l1=j1[k1];if(l1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(l1&&l1["Label"]){return p(l1["Label"].String,i1);}else{return l1["SemanticObject"].String+"-"+l1["Action"].String;}}if(l1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(l1&&l1["Label"]){return p(l1["Label"].String,i1);}else{return l1["Url"].String;}}}}return d.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION");}else if(q.indexOf(".LineItem")!==-1){var m1=A.sortCollectionByImportance(i[q]);m1.forEach(function(p1,k1){if(p1["RecordType"]&&p1["RecordType"].indexOf(".DataField")!==-1&&p1["Label"]){m1[k1]["Label"]={String:p(p1["Label"].String,i1)};}});return m1;}else if(q.indexOf(".HeaderInfo")!==-1){if(i[q]&&i[q]["Description"]&&i[q]["Description"].Label){return p(i[q]["Description"].Label.String,i1);}else{return i1;}}else if(q.indexOf(".PresentationVariant")!==-1||q.indexOf(".SelectionVariant")!==-1||q.indexOf(".SelectionPresentationVariant")!==-1){return t(q,i,"Text",i1);}else if(q.indexOf(".DataPoint")!==-1){return t(q,i,"Title",i1);}else if(q.indexOf(".Chart")!==-1){return t(q,i,"Description",i1);}else if(q.indexOf(".FieldGroup")!==-1){return t(q,i,"Label",i1);}else{var n1="";if(h1!=="Default"){n1="#"+h1;}var o1="com.sap.vocabularies.Common.v1.Label"+n1;if(i[q]&&i[q][o1]){return p(i[q][o1].String,i1);}else{return i1;}}}function v(i,q,h1){switch(q){case"cardPreview":return(O.getSupportedCardTypes().indexOf(i)!==-1);case"noOfRows":case"noOfColumns":case"stopResizing":var i1=["sap.ovp.cards.stack"];return(i1.indexOf(i)===-1);case"listType":case"listFlavor":var j1=["sap.ovp.cards.list"];return(j1.indexOf(i)!==-1);case"listFlavorForLinkList":var k1=["sap.ovp.cards.linklist"];return(k1.indexOf(i)!==-1);case"isViewSwitchSupportedCard":case"showViewSwitch":case"kpiHeader":var l1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(l1.indexOf(i)!==-1);case"chartSPVorKPI":case"chart":var m1=["sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(m1.indexOf(i)!==-1);case"sortOrder":case"sortBy":case"lineItem":if(!h1){var n1=["sap.ovp.cards.list","sap.ovp.cards.table"];return(n1.indexOf(i)!==-1);}else{var n1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.linklist","sap.ovp.cards.stack"];return(n1.indexOf(i)!==-1);}break;case"identification":var o1=["sap.ovp.cards.stack"];return(o1.indexOf(i)!==-1);case"addViewSwitch":var p1=["sap.ovp.cards.list","sap.ovp.cards.table"];return(p1.indexOf(i)!==-1);case"addKPIHeader":var p1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.charts.analytical"];return(p1.indexOf(i)!==-1);case"selecionOrPresentation":var q1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.linklist"];return(q1.indexOf(i)!==-1);case"addODataSelect":var r1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.stack"];return(r1.indexOf(i)!==-1);case"addCustomActions":var r1=["sap.ovp.cards.stack"];return(r1.indexOf(i)!==-1);case"setCardProperties":if(h1){var n1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.linklist","sap.ovp.cards.stack"];return(n1.indexOf(i)!==-1);}break;default:break;}}function w(i){return!!i.kpiAnnotationPath;}function x(i){return!!i.selectionPresentationAnnotationPath;}function y(i){return x(i)||w(i);}function z(i){return i.substring(i.lastIndexOf("_")+1,i.length).indexOf("C")!==-1;}function E(i){if(i.NewKPICard){return i.NewKPICard;}else if(i.selectedKPICardID){return i.selectedKPICardID.indexOf("newKPICard")!==-1;}else{return false;}}function F(i,q,h1,i1,j1){var k1=true;var l1=true;var m1=false;var n1=false;var o1=false;if(h1){if(i.mainViewSelected){l1=false;}else{k1=false;}}if(i.addNewCard&&i.model){var n1=true;if(i.template){o1=true;if(i.entitySet){m1=true;}}}var p1;switch(q){case"cardPreview":p1=v(i.template,"cardPreview");break;case"noOfRows":case"noOfColumns":case"stopResizing":p1=k1&&v(i.template,q);break;case"title":p1=k1;break;case"dynamicSwitchSubTitle":p1=k1&&!!i.dynamicSubTitle;break;case"dynamicSwitchStateSubTitle":p1=!!i.dynamicSubtitleAnnotationPath;break;case"subTitle":if(!i.addNewCard){if(!i.subTitle){i.subTitle=" ";p1=true;}else{p1=k1&&!i.dynamicSubtitleAnnotationPath;}}else{p1=k1;}break;case"dynamicSubTitle":p1=k1&&!!i.dynamicSubtitleAnnotationPath;break;case"valueSelectionInfo":if(!i.addNewCard){if(!i.valueSelectionInfo){i.valueSelectionInfo=" ";}p1=k1&&(v(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath)&&!E(i);}else{p1=k1&&n1&&o1&&m1&&i.addKPIHeaderCheckBox&&v(i.template,"addKPIHeader");}break;case"dataPoint":if(!i.addNewCard){p1=l1&&!w(i)&&(v(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath);}else{p1=l1&&n1&&o1&&m1&&i.addKPIHeaderCheckBox&&v(i.template,"addKPIHeader");}break;case"listType":case"listFlavor":case"listFlavorForLinkList":if(!i.addNewCard){p1=k1&&v(i.template,q);}else{p1=k1&&n1&&o1&&m1&&v(i.template,q);}break;case"identification":if(!i.addNewCard){p1=l1&&(!i.staticContent)&&!v(i.template,q);}else{p1=l1&&n1&&o1&&m1&&!v(i.template,q);}break;case"selectionPresentationVariant":if(!i.addNewCard){p1=l1&&x(i)&&!w(i)&&v(i.template,"kpiHeader");}else{p1=l1&&n1&&o1&&m1&&v(i.template,"selecionOrPresentation")&&!!(Array.isArray(i.selectionPresentationVariant)&&i.selectionPresentationVariant.length);}break;case"KPI":case"dataPointSelectionMode":if(!i.addNewCard){p1=l1&&w(i)&&!x(i)&&v(i.template,"chart")&&!E(i);}else{p1=l1&&n1&&o1&&m1&&v(i.template,"chart");}break;case"presentationVariant":case"selectionVariant":if(!i.addNewCard){p1=l1&&!y(i)&&(!i.staticContent)&&v(i.template,"kpiHeader");}else{p1=l1&&n1&&o1&&m1&&!(Array.isArray(i.selectionPresentationVariant)&&i.selectionPresentationVariant.length)&&v(i.template,"selecionOrPresentation");}break;case"kpiHeader":p1=k1&&!w(i)&&v(i.template,q);break;case"lineItem":case"chart":if(!i.addNewCard){p1=l1&&!y(i)&&v(i.template,q);}else{p1=l1&&n1&&o1&&m1&&v(i.template,q,i.addNewCard);}break;case"chartSPVorKPI":p1=l1&&y(i)&&!E(i)&&v(i.template,q);break;case"presentationVariantSPVorKPI":case"selectionVariantSPVorKPI":p1=l1&&y(i)&&!E(i)&&(!i.staticContent)&&v(i.template,"kpiHeader");break;case"showViewName":p1=h1&&l1;break;case"showDefaultView":if(h1&&l1){if(i.defaultViewSelected!=i.selectedKey){p1=true;}}else{p1=false;}break;case"showEntitySet":if(h1&&l1){if(i.selectedKey>0&&i.tabs[i.selectedKey-1].entitySet){p1=true;}else{p1=false;}}else{p1=false;}break;case"showMore":case"removeVisual":case"lineItemSubTitle":case"lineItemTitle":case"staticLink":case"links":var q1=(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent);if(q==="staticLink"){p1=(q1&&!!i.staticContent[i1].targetUri);}else if(q==="links"){p1=(q1&&!!i.staticContent[i1].semanticObject);}else if(q==="removeVisual"){p1=(q1&&(!!i.staticContent[i1].targetUri||!!i.staticContent[i1].semanticObject));}else{p1=q1;}break;case"selectCardType":p1=k1&&n1;break;case"addKPIHeader":p1=k1&&n1&&o1&&v(i.template,q);break;case"setEntitySet":p1=l1&&n1&&o1;break;case"setCardProperties":p1=k1&&n1&&o1&&m1&&v(i.template,q,i.addNewCard);break;case"setGeneralCardProperties":p1=k1&&n1&&o1&&m1;break;case"setAnnotationCardProperties":p1=l1&&n1&&o1&&m1;break;case"subTitleRequired":p1=n1&&o1&&m1&&i.addKPIHeaderCheckBox;break;case"addODataSelect":if(!i.addNewCard){p1=l1&&v(i.template,q);}else{p1=l1&&n1&&o1&&m1&&v(i.template,q);}break;case"isViewSwitchSupportedCard":case"showViewSwitch":p1=n1&&o1&&(m1||!!i.showViewSwitchButton)&&v(i.template,q);break;case"dataSource":p1=k1;break;case"dataSourceExisting":p1=!i.newDataSource;break;case"dataSourceNew":p1=i.newDataSource;break;case"addCustomActions":p1=k1&&v(i.template,q);break;default:break;}return p1;}function G(i){var q=false;this.oVisibility.viewSwitchEnabled=false;this.oVisibility.showViewSwitch=false;if(!this.bAddNewCardFlag){if(v(i.template,"isViewSwitchSupportedCard")&&!E(i)){if(i.tabs&&i.tabs.length){q=true;this.oVisibility.showViewSwitch=true;}this.oVisibility.viewSwitchEnabled=true;}}else{if(i.tabs&&i.tabs.length){q=true;this.oVisibility.showViewSwitch=F(i,"showViewSwitch");}this.oVisibility.viewSwitchEnabled=F(i,"isViewSwitchSupportedCard");}this.oVisibility.cardPreview=F(i,"cardPreview");this.oVisibility.stopResizing=F(i,"stopResizing",q);this.oVisibility.noOfRows=F(i,"noOfRows",q);this.oVisibility.noOfColumns=F(i,"noOfColumns",q);this.oVisibility.title=F(i,"title",q);this.oVisibility.subTitle=F(i,"subTitle",q);this.oVisibility.valueSelectionInfo=F(i,"valueSelectionInfo",q);this.oVisibility.listType=F(i,"listType",q);this.oVisibility.listFlavor=F(i,"listFlavor",q);this.oVisibility.listFlavorForLinkList=F(i,"listFlavorForLinkList",q);if(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent){var h1=i.staticContent,i1={},j1={},k1={},l1={};for(var m1=0;m1<h1.length;m1++){var n1=h1[m1].index;i1[n1]=F(i,"staticLink",null,m1);j1[n1]=F(i,"links",null,m1);k1[n1]=F(i,"removeVisual",null,m1);l1[n1]=F(i,"showMore",null,m1);}this.oVisibility.staticLink=i1;this.oVisibility.links=j1;this.oVisibility.removeVisual=k1;this.oVisibility.showMore=l1;}this.oVisibility.lineItemTitle=F(i,"lineItemTitle");this.oVisibility.lineItemSubTitle=F(i,"lineItemSubTitle");this.oVisibility.showViewName=F(i,"showViewName",q);this.oVisibility.showDefaultView=F(i,"showDefaultView",q);this.oVisibility.showEntitySet=F(i,"showEntitySet",q);this.aVariantNames.forEach(function(p1){this.oVisibility[p1.sPath]=F(i,p1.sPath,q)&&!!i[p1.sPath]&&!!i[p1.sPath].length;}.bind(this));this.oVisibility.kpiHeader=F(i,"kpiHeader",q)&&!!i["dataPoint"]&&!!i["dataPoint"].length;this.oVisibility.dynamicSwitchSubTitle=F(i,"dynamicSwitchSubTitle",q);this.oVisibility.dynamicSwitchStateSubTitle=F(i,"dynamicSwitchStateSubTitle",q);this.oVisibility.dataSource=F(i,"dataSource",q);this.oVisibility.dataSourceExisting=F(i,"dataSourceExisting",q);this.oVisibility.dataSourceNew=F(i,"dataSourceNew",q);this.oVisibility.selectCardType=F(i,"selectCardType",q);this.oVisibility.addKPIHeader=F(i,"addKPIHeader",q);this.oVisibility.setEntitySet=F(i,"setEntitySet",q);this.oVisibility.setCardProperties=F(i,"setCardProperties",q);this.oVisibility.setGeneralCardProperties=F(i,"setGeneralCardProperties",q);this.oVisibility.subTitleRequired=F(i,"subTitleRequired",q);this.oVisibility.dataPointSelectionMode=F(i,"dataPointSelectionMode",q);var o1;for(var m1=0;m1<this.aVisiblePropertiesForAnnotation.length;m1++){if(this.oVisibility[this.aVisiblePropertiesForAnnotation[m1].sProperty]){o1=true;break;}}this.oVisibility.setAnnotationCardProperties=o1?F(i,"setAnnotationCardProperties",q):false;this.oVisibility.addODataSelect=F(i,"addODataSelect",q);this.oVisibility.addCustomActions=F(i,"addCustomActions",q);this.oVisibility.moveToTheTop=false;this.oVisibility.moveUp=false;this.oVisibility.moveDown=false;this.oVisibility.moveToTheBottom=false;this.oVisibility.delete=false;}function H(i){var q=i.getProperty("/staticContent");for(var h1=0;h1<q.length;h1++){q[h1].index="Index--"+(h1+1);}i.setProperty("/staticContent",q);}function I(q){var h1=0;for(var i=q.length-1;i>=0;i--){if(/^\d+$/.test(q[i])){h1=parseInt(q[i],10);break;}}return h1;}function K(i){if(i.lineItem){i.lineItem.forEach(function(h1){if(h1.value===i.annotationPath){i.lineItemQualifier=h1.name;}});}if(i.tabs&&i.tabs.length&&i.selectedKey){i.viewName=i.tabs[i.selectedKey-1].value;i.isDefaultView=false;if(i.selectedKey===i.defaultViewSelected){i.isDefaultView=true;}}var q=i.sortOrder;i.sortOrder="descending";if(q&&q.toLowerCase()!=="descending"){i.sortOrder="ascending";}i.isExtendedList=false;if(i.listType==="extended"){i.isExtendedList=true;}i.isBarList=false;if(i.listFlavor==="bar"){i.isBarList=true;}i.hasKPIHeader=false;if(i.dataPointAnnotationPath){i.hasKPIHeader=true;}return i;}function N(i){var q=i.kpiAnnotationPath;var h1=i.template;var i1=i.entityType;var j1="";if(q&&i1&&h1==="sap.ovp.cards.charts.analytical"){var k1=i1[q];var l1=k1&&k1.Detail;if(l1&&l1.RecordType==="com.sap.vocabularies.UI.v1.KPIDetailType"&&l1.SemanticObject&&l1.Action){j1="#"+l1.SemanticObject.String+"-"+l1.Action.String;}}i["KPINav"]=j1;}function R(i){var q=[],h1=i.metaModel,i1=(!!h1)?h1.getODataEntityContainer().entitySet:[];if(h1){var j1=h1.getODataEntityContainer().namespace+".";}i1.forEach(function(k1){if(!i.addNewCard){var l1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[k1.name]),m1=h1.getODataEntityType(k1.entityType)["sap:label"];q.push({name:p(m1,l1),value:k1.name});}else{var l1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[k1.name]),m1=h1.getODataEntityType(k1.entityType)["sap:label"],n1=k1.entityType.split(j1)[1];q.push({name:p(m1,l1),value:k1.name,entityType:n1});}});if(q.length>0){i["allEntitySet"]=q;}}function T(i){var q=i.metaModel&&i.metaModel.getObject('/dataServices/schema')&&i.metaModel.getObject('/dataServices/schema')[0].entityType;if(q){q.forEach(function(h1){var i1=0;this.aVariantNames.forEach(function(j1){for(var k1 in h1){if(k1.indexOf(j1.sVariant)!==-1){i1++;}}});if(!i1){i.allEntitySet=i.allEntitySet.filter(function(j1){return j1.entityType!==h1.name;});}}.bind(this));}}function U(i){var q=i.entityType;if(!i["allEntitySet"]){R(i);}N(i);if(i.addNewCard){T.call(this,i);}this.aVariantNames.forEach(function(k1){var l1=[],m1=1;for(var n1 in q){if(q.hasOwnProperty(n1)&&n1.indexOf(k1.sVariant)!==-1){if(k1.sVariant===".LineItem"){var o1={name:r.getText("OVP_KEYUSER_LABEL_LINEITEM_OPTIONS",[m1]),value:n1,fields:u(q,n1)};l1.push(o1);m1++;}else{l1.push({name:u(q,n1),value:n1});}}}if(l1.length!==0){i[k1.sPath]=l1;}});if(i.entityType&&i.entityType.property){i["modelProperties"]=i.entityType.property.map(function(k1){return{name:k1.name,value:k1.name};});}if(!!i.tabs&&i.tabs.length){var h1=false,i1=i.tabs[i.tabs.length-1].value,j1=i1.split(' ');i.newViewCounter=I(j1);i.defaultViewSelected=i.selectedKey;i.isViewResetEnabled=false;i.aViews=[{text:r&&r.getText("OVP_KEYUSER_LABEL_MAIN_VIEW"),key:0,isLaterAddedView:false,isViewResetEnabled:false}];h1=i.tabs.some(function(k1){return k1.dataPointAnnotationPath;});i.tabs.forEach(function(k1,l1){var m1=k1.value;if(h1&&!k1.dataPointAnnotationPath&&k1.dataPoint&&k1.dataPoint.length){k1.dataPointAnnotationPath=k1.dataPoint[0].value;}if(l1+1===i.selectedKey){m1=k1.value;if(r){m1+=" ("+r.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";}else{m1+=" (Default view)";}}i.aViews.push({text:m1,key:l1+1,initialSelectedKey:l1+1,isLaterAddedView:false,isViewResetEnabled:false});});}else if(v(i.template,"isViewSwitchSupportedCard")){i.newViewCounter=0;i.aViews=[{text:r.getText("OVP_KEYUSER_SHOWS_DIFFERENT_VIEWS"),key:0,initialSelectedKey:0,isLaterAddedView:false,isViewResetEnabled:false}];}return i;}function W(q){var h1=q.getData();if(sap.ushell&&sap.ushell.Container){sap.ushell.Container.getService("CrossApplicationNavigation").getLinks().done(function(i1){var j1=[],k1={};for(var i=0;i<i1.length;i++){j1.push(i1[i].intent);k1[i1[i].intent]=i1[i].text;}sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(j1).done(function(l1){var i1=[];for(var m1 in l1){if(l1.hasOwnProperty(m1)&&l1[m1].supported===true&&k1&&k1[m1]){i1.push({name:k1[m1],value:m1});}}var n1=h1;if(i1.length!==0||i1.length!==0){n1["links"]=i1;}q.refresh();}).fail(function(l1){f.error(l1);});}).fail(function(i){f.error(i);});}}function X(i){this.oResetButton.setEnabled(i);}function Y(i){this.oSaveButton.setEnabled(i);var q=this.oMessagePopOver.getModel(),h1=q.getProperty("/Counter/Error");this.bError=(h1>0);}function Z(i){var q=new RegExp("((http|https)(:\/\/))?([a-zA-Z0-9]+[.]{1}){2}[a-zA-z0-9]+(\/{1}[a-zA-Z0-9]+)*\/?","i");return q.test(i);}function $(i,q){if(q==="targetUri"){return!Z(i)&&(!!i||i==="");}else{return!(i.trim().length);}}function _(q){var h1=q.getParameter("path"),i1="",j1,i,k1,l1,m1,n1;if(h1==="/title"||h1==="title"||h1==="/viewName"||h1==="targetUri"||h1==="value"){var o1=q.getParameter("value"),p1=$(o1,h1),q1,r1=q.getParameter("context");if(h1==="/viewName"){q1=q.getSource().getProperty("/selectedKey");i1=d.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");h1="/tabs/"+(q1-1)+"/value";}if(h1==="value"){i1=d.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");h1=r1.getPath()+"/"+h1;}if(h1.indexOf("/title")!==-1){i1=d.getText("OVP_KEYUSER_INPUT_ERROR");}if(r1&&r1.getPath().indexOf("staticContent")!==-1){j1=r1.getPath().split("/");if(h1==="title"){i1=d.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_TITLE")+(parseInt(j1[j1.length-1],10)+1);}else if(h1==="targetUri"){i1=d.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_URL")+" "+(parseInt(j1[j1.length-1],10)+1);}h1=r1.getPath()+"/"+h1;}k1=this.oMessagePopOver.getModel();l1=k1.getProperty("/Messages");m1=k1.getProperty("/Counter/All");n1=k1.getProperty("/Counter/Error");if(p1){Y.bind(this)(true);for(i=0;i<l1.length;i++){if(l1[i].fieldName===h1){l1.splice(i,1);m1--;n1--;i--;}}l1.push({"type":"Error","title":i1,"fieldName":h1,"counter":n1+1});m1++;n1++;}else{Y.bind(this)(true);for(i=0;i<l1.length;i++){if(l1[i].fieldName===h1){l1.splice(i,1);m1--;n1--;i--;}}}k1.setProperty("/Messages",l1);k1.setProperty("/Counter/All",m1);k1.setProperty("/Counter/Error",n1);k1.refresh(true);}else if(h1==="/staticContent,title"||h1==="/staticContent,targetUri"||h1==="/tabs,value"){j1=h1.split(",");k1=this.oMessagePopOver.getModel();l1=k1.getProperty("/Messages");m1=k1.getProperty("/Counter/All");n1=k1.getProperty("/Counter/Error");Y.bind(this)(true);for(i=0;i<l1.length;i++){if(l1[i].fieldName.indexOf(j1[0])!==-1&&l1[i].fieldName.indexOf(j1[1])!==-1){l1.splice(i,1);m1--;n1--;i--;}}k1.setProperty("/Messages",l1);k1.setProperty("/Counter/All",m1);k1.setProperty("/Counter/Error",n1);k1.refresh(true);}}function a1(){var i=this.oMessagePopOver.getModel();i.setProperty("/Messages",[]);i.setProperty("/Counter/All",0);i.setProperty("/Counter/Error",0);i.setProperty("/Counter/Success",0);i.setProperty("/Counter/Warning",0);i.setProperty("/Counter/Information",0);i.refresh(true);}function b1(){var i=new L({text:"Show more information",href:"",target:"_blank"});var q=new b({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}",fieldName:"{fieldName}",link:i});this.oMessagePopOver=new M({items:{path:"/Messages",template:q}});var h1={"Counter":{"All":0,"Error":0,"Success":0,"Warning":0,"Information":0},"Messages":[]};var i1=new J(h1);this.oMessagePopOver.setModel(i1);this.oMessagePopOverButton.setModel(i1);}function c1(i,q){var h1=i.byId("sapOvpSettingsForm");if(h1){var i1=h1.getDomRef();if(i1){i1.style.width=q;}}}function d1(i){var q=this.dialogBox.getContent()[0],h1=q.getModel(),i1=q.getModel("deviceMediaProperties");switch(i.name){case"S":case"M":i1.setProperty("/deviceMedia","Column");c1(q,"100%");break;case"L":case"XL":default:i1.setProperty("/deviceMedia","Row");c1(q,"calc(100% - "+(h1.getProperty("/dialogBoxWidth")+1)+"rem)");break;}i1.refresh(true);}function e1(){a.media.detachHandler(d1.bind(this),null,"SettingsViewRangeSet");a.media.removeRangeSet("SettingsViewRangeSet");}function f1(){a.media.initRangeSet("SettingsViewRangeSet",[520,760,960],"px",["S","M","L","XL"]);a.media.attachHandler(d1.bind(this),null,"SettingsViewRangeSet");d1.bind(this)(a.media.getCurrentRange("SettingsViewRangeSet"));}var g1={dialogBox:undefined,oSaveButton:undefined,oResetButton:undefined,oMessagePopOverButton:undefined,oMessagePopOver:undefined,oAppDescriptor:undefined,oOriginalAppDescriptor:undefined,oMainComponent:undefined,oAppComponent:undefined,oNewDataSources:{},sApplicationId:"",oi18nModel:undefined,iContentHeightForDialog:38,iContentHeightForDialogWithViewSwitch:33,aVariantNames:S.aVariantNames,aVisiblePropertiesForAnnotation:S.aVisiblePropertiesForAnnotation,getDataSources:j,removeDataSources:h,setDataSources:s,attachWindowResizeHandler:f1,detachWindowResizeHandler:e1,settingFormWidth:c1,addKPINavApplicationName:N,addManifestSettings:K,setVisibilityForFormElements:G,getVisibilityOfElement:F,checkForEmptyString:p,enableResetButton:X,enableSaveButton:Y,checkClonedCard:z,resetErrorHandling:a1,createErrorCard:l,setErrorMessage:n,getQualifier:o,getTrimmedDataURIName:k,addSupportingObjects:U,oVisibility:S.oVisibility,bError:false,bNewStaticLinkListCardFlag:false,bNewKPICardFlag:false,bAddNewCardFlag:false,aListType:S.aListType,aListFlavour:S.aListFlavour,aDataPointSelectionMode:S.aDataPointSelectionMode,aSortOrder:S.aSortOrder,aCardType:S.aCardType,aLinkListFlavour:S.aLinkListFlavour,getDialogBox:function(i){return new Promise(function(h1,i1){if(!this.dialogBox){this.oSaveButton=new B("settingsSaveBtn",{text:d.getText("save"),type:"Emphasized"});var j1=new B("settingsCancelBtn",{text:d.getText("cancelBtn")});this.oResetButton=new B("settingsResetBtn",{text:d.getText("resetCardBtn")});this.oMessagePopOverButton=new B("settingsMessagePopOverBtn",{text:"{/Counter/All}",type:"Emphasized",icon:"sap-icon://message-popup",visible:"{= ${/Counter/All} === 0 ? false : true}"}).addStyleClass("sapOvpSettingsMessagePopOverBtn");this.dialogBox=new D("settingsDialog",{title:d.getText("settingsDialogTitle"),buttons:[this.oMessagePopOverButton,this.oSaveButton,j1,this.oResetButton],afterClose:function(_1){var Z1=this.dialogBox.getContent()[0],a2=Z1.byId("sapOvpSettingsLineItemTitle"),b2=Z1.byId("sapOvpSettingsLineItemSubTitle");if(a2){a2.destroy();}if(b2){b2.destroy();}this.bNewStaticLinkListCardFlag=false;this.bNewKPICardFlag=false;this.bAddNewCardFlag=false;this.newDataSource=false;this.dialogBox.destroyContent();this.detachWindowResizeHandler();}.bind(this)});this.dialogBox.setBusyIndicatorDelay(0);j1.attachPress(function(_1){this.dialogBox.close();}.bind(this));}this.oResetButton.setVisible(!this.bNewKPICardFlag);b1.bind(this)();var k1=this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag||this.bAddNewCardFlag;var l1=i.getComponentInstance(),m1=l1.getRootControl().getModel("ovpCardProperties"),n1;this.oi18nModel=l1.getComponentData().i18n;if(this.bNewStaticLinkListCardFlag){n1={"title":"New Title","subTitle":"New Subtitle","staticContent":[],"listFlavor":"standard","template":"sap.ovp.cards.linklist","layoutDetail":m1.getProperty("/layoutDetail")};}else if(this.bNewKPICardFlag){var o1=l1.getComponentData().mainComponent.getView().getModel("JSONModelForSSB").getProperty("/d/results"),p1=o1[0];n1={"entitySet":p1.ODataEntityset,"kpiAnnotationPath":"com.sap.vocabularies.UI.v1.KPI#"+p1.KPIQualifier,"title":p1.GroupTitle,"subTitle":p1.KPITitle,"template":"sap.ovp.cards.charts.analytical","layoutDetail":m1.getProperty("/layoutDetail"),"selectedKPI":p1,"errorStatusText":undefined,"KPIData":o1};}else if(this.bAddNewCardFlag){n1={"addNewCard":true,"newDataSource":false,"title":"","subTitle":"","cardType":this.aCardType,"aListType":this.aListType,"aListFlavour":this.aListFlavour,"valueSelectionInfo":"","navigation":this.aDataPointSelectionMode,"aLinkListFlavour":this.aLinkListFlavour,"authorization":""};}else{n1=m1.getData();}var q1=Q.extend(true,{},n1);q1=U.call(this,q1);q1=this.addManifestSettings(q1);var r1=new J(q1),s1=i.getDomRef().offsetHeight,t1=new J(a.system),u1=new J({"deviceMedia":"Row"}),v1=l1.getComponentData(),w1=v1.mainComponent,x1=v1.appComponent,y1=(k1)?"":v1.cardId;this.oAppComponent=x1;this.oAppDescriptor=w1._getCardFromManifest(y1);this.sApplicationId=w1._getApplicationId();this.oMainComponent=w1;this.oOriginalAppDescriptor=x1._getOvpCardOriginalConfig(y1);t1.setDefaultBindingMode("OneWay");q1.dialogBoxHeight=s1;q1.dialogBoxWidth=20;var z1=C._getLayer();if(z1===e.Layers.vendor){r1.setProperty("/layer",z1);var A1=[];if(q1.customParams||q1.staticParameters){r1.setProperty("/addCustomParameters",true);if(q1.staticParameters&&Object.keys(q1.staticParameters).length){for(var B1 in q1.staticParameters){A1.push({"key":B1,"value":q1.staticParameters[B1]});}r1.setProperty("/aAllStaticParameters",A1);}}else{r1.setProperty("/addCustomParameters",false);}if(q1.objectStreamCardsSettings&&q1.objectStreamCardsSettings.customActions){r1.setProperty("/addCustomActions",true);}else{r1.setProperty("/addCustomActions",false);}var C1=sap.ui.getCore().byId("mainView").getModel("i18n").oData.bundle.aCustomBundles;if(C1[0]&&C1[0].aPropertyFiles[0]&&C1[0].aPropertyFiles[0].mProperties){var D1=C1[0].aPropertyFiles[0].mProperties;var E1=[];var F1=[];var G1=[];var H1=[];if(!q1.addNewCard){var I1=S.oI18nKeyValueProperty;for(var B1 in I1){if(B1==="title"){F1.push({key:"",value:q1[B1]});}if(B1==="subTitle"){G1.push({key:"",value:q1[B1]});}if(B1==="valueSelectionInfo"){H1.push({key:"",value:q1[B1]});}}for(var B1 in D1){if(D1.hasOwnProperty(B1)){F1.push({key:B1,value:D1[B1]});}}for(var B1 in D1){if(D1.hasOwnProperty(B1)){G1.push({key:B1,value:D1[B1]});}}for(var B1 in D1){if(D1.hasOwnProperty(B1)){H1.push({key:B1,value:D1[B1]});}}r1.setProperty("/ai18nPropertiesAndTitle",F1);r1.setProperty("/ai18nPropertiesAndSubTitle",G1);r1.setProperty("/ai18nPropertiesAndValSelInfo",H1);}for(var B1 in D1){if(D1.hasOwnProperty(B1)){E1.push({key:B1,value:D1[B1]});}}r1.setProperty("/ai18nProperties",E1);}}if(q1.template==="sap.ovp.cards.linklist"){r1.setProperty("/listFlavorName",d.getText("OVP_KEYUSER_CAROUSEL"));}else{r1.setProperty("/listFlavorName",d.getText("OVP_KEYUSER_BARLIST"));}if(q1.layoutDetail==="resizable"){if(!q1.defaultSpan){q1.defaultSpan={};r1.setProperty("/defaultSpan/cols",r1.getProperty("/cardLayout/colSpan"));r1.setProperty("/defaultSpan/rows",q1.template==="sap.ovp.cards.list"||q1.template==="sap.ovp.cards.table"?r1.getProperty("/cardLayout/noOfItems"):r1.getProperty("/cardLayout/rowSpan"));}else{if(!q1.defaultSpan.rows){r1.setProperty("/defaultSpan/rows",q1.template==="sap.ovp.cards.list"||q1.template==="sap.ovp.cards.table"?r1.getProperty("/cardLayout/noOfItems"):r1.getProperty("/cardLayout/rowSpan"));}if(!q1.defaultSpan.cols){r1.setProperty("/defaultSpan/cols",r1.getProperty("/cardLayout/colSpan"));}}q1.NoOfColumns=[];var J1=1,K1=6;for(var q=J1;q<=K1;q++){q1.NoOfColumns.push({value:q});}if(v(q1.template,'chart')||q1.template==='sap.ovp.cards.linklist'){var L1=i.getComponentInstance().getComponentData().mainComponent,M1=L1.getLayout(),N1=M1.getDashboardLayoutUtil(),O1=w1._getCardId(i.getId()),P1=N1.calculateCardProperties(O1),Q1=N1._getCardController(O1).getView().byId('bubbleText')?43:0,R1=P1.headerHeight+P1.dropDownHeight+Q1+50,S1=Math.ceil(P1.minCardHeight/N1.getRowHeightPx())+1;q1.NoOfRows=[];q1.NoOfRows.push({name:"None",value:0});q1.NoOfRows.push({name:"Small",value:S1});q1.NoOfRows.push({name:"Standard",value:Math.ceil((R1+480)/N1.getRowHeightPx())+1});if(this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag){r1.setProperty("/defaultSpan/cols",1);r1.setProperty("/defaultSpan/rows",S1);}}}if(q1.addNewCard){r1.setProperty("/addViewSwitchCheckBox",false);r1.setProperty("/addKPIHeaderCheckBox",false);var T1=[];var U1=w1.oCardsModels;if(U1){for(var B1 in U1){if(B1.indexOf("kpi_card_model_")<0){T1.push(Q.extend({},{Title:B1},U1[B1]));}}r1.setProperty("/datasources",T1);r1.setProperty("/datasourcesFromManifest",T1);}}var V1={};var W1=new J(V1);W(W1);if(q1.template==="sap.ovp.cards.linklist"&&q1.staticContent){H(r1);r1.setProperty("/lineItemId","linkListItem--1");r1.setProperty("/lineItemIdCounter",q1.staticContent.length);}if(q1.template==="sap.ovp.cards.charts.analytical"){var X1=w1._getCardId(i.getId());r1.setProperty("/NewKPICard",this.bNewKPICardFlag);r1.setProperty("/selectedKPICardID",X1);}this.setVisibilityForFormElements(q1);var Y1=new J(this.oVisibility);if(!this.bAddNewCardFlag){r1.attachPropertyChange(_.bind(this));}var Z1=new sap.ui.view("settingsView",{viewName:"sap.ovp.cards.rta.SettingsDialog",type:V.XML,preprocessors:{xml:{bindingContexts:{ovpCardProperties:r1.createBindingContext("/")},models:{ovpCardProperties:r1,deviceSystemProperties:t1}}}});Z1.setModel(W1,"staticCardProperties");var $1=d.oResourceModel;Z1.setModel(r1);Z1.setModel($1,"ovpResourceModel");Z1.setModel(u1,"deviceMediaProperties");Z1.setModel(Y1,"visibility");if(this.oi18nModel){Z1.setModel(this.oi18nModel,"@i18n");}this.dialogBox.addContent(Z1);this.attachWindowResizeHandler();Z1.loaded().then(function(_1){if(!this.bAddNewCardFlag){var a2=_1.byId("dialogCard");if(!a2.getVisible()){a2=_1.byId("dialogCardNoPreview");var b2=Z1.getModel().getProperty("/template").split("."),c2=b2[b2.length-1],d2=d.getText("OVP_KEYUSER_NO_CARD_PREVIEW_MSG",[c2]);a2.setText(d2);}else{a2.setWidth(q1.dialogBoxWidth+"rem");}}g(i,_1,k1);this.dialogBox.open();_1.getController().settingsResolve=h1;}.bind(this));}.bind(this));}};g1.fnEditCardHandler=function(i,q){var h1=i.getComponentInstance().getComponentData().mainComponent,i1=h1.getLayout(),j1=h1.getUIModel();return g1.getDialogBox(i).then(function(k1){var l1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_changeCard",content:k1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"editCardSettings",content:k1.flexibilityChange}}];if(k1.viewSwitchChange){l1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"viewSwitch",content:k1.viewSwitchChange}});}if(j1.getProperty('/containerLayout')==='resizable'){var m1=i1.getDashboardLayoutModel(),n1=i1.getDashboardLayoutUtil(),o1=h1._getCardId(i.getId()),p1=m1.getCardById(o1),q1=n1.calculateCardProperties(o1),r1=m1.getColCount(),s1='C'+r1,t1=k1.flexibilityChange.newAppDescriptor.settings.defaultSpan,u1,v1=[];if(t1&&t1.cols){l1.forEach(function(w1){if(w1.changeSpecificData.changeType==='editCardSettings'){var x1=w1.changeSpecificData.content.oldAppDescriptor;x1.settings.defaultSpan={rowSpan:p1.dashboardLayout.rowSpan,colSpan:p1.dashboardLayout.colSpan,showOnlyHeader:p1.dashboardLayout.showOnlyHeader};}});if(t1.rows===0){p1.dashboardLayout.autoSpan=false;u1=Math.ceil((q1.headerHeight+2*n1.CARD_BORDER_PX)/n1.getRowHeightPx());}else{p1.dashboardLayout.autoSpan=true;if(p1.template==='sap.ovp.cards.list'||p1.template==='sap.ovp.cards.table'){p1.dashboardLayout.noOfItems=t1.rows;}else{u1=t1.rows;}}m1._arrangeCards(p1,{row:u1,column:t1.cols},'resize',v1);m1._removeSpaceBeforeCard(v1);v1.forEach(function(w1){var x1={};x1.dashboardLayout={};x1.cardId=w1.content.cardId;x1.dashboardLayout[s1]=w1.content.dashboardLayout;l1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"dragOrResize",content:x1}});});}}return l1;});};g1.fnCloneCardHandler=function(i,q){return P.getPayLoadForCloneCard(i).then(function(h1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:h1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:h1.flexibilityChange}}];});};g1.fnAddStaticLinkListCardHandler=function(i,q){g1.bNewStaticLinkListCardFlag=true;return g1.getDialogBox(i).then(function(h1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:h1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:h1.flexibilityChange}}];});};g1.fnAddKPICardHandler=function(i,q){g1.bNewKPICardFlag=true;return g1.getDialogBox(i).then(function(h1){var i1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:h1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:h1.flexibilityChange}}];if(h1.addODataAnnotation){i1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:h1.addODataAnnotation}});}return i1;});};g1.fnAddNewCardHandler=function(i,q){g1.bAddNewCardFlag=true;return g1.getDialogBox(i).then(function(h1){var i1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:h1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:h1.flexibilityChange}}];if(h1.addODataAnnotation){i1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:h1.addODataAnnotation}});}return i1;});};g1.fnRemoveCardHandler=function(i,q){return new Promise(function(h1,i1){c.confirm(d.getText("OVP_KEYUSER_MESSAGE_BOX_WARNING_MESSAGE_DELETE"),{actions:[c.Action.DELETE,c.Action.CANCEL],icon:c.Icon.WARNING,title:d.getText("OVP_KEYUSER_MESSAGE_BOX_TITLE_DELETE"),initialFocus:c.Action.CANCEL,onClose:function(j1){if(j1==="DELETE"){h1(P.getPayLoadForRemoveCard(i));}else{i1(null);}}});}).then(function(h1){var i1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_removeCard",content:h1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"removeCardContainer",content:h1.flexibilityChange}}];if(h1.removeDataSourceChange){h1.removeDataSourceChange.forEach(function(j1){i1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_removeDataSource",content:j1}});});}return i1;},function(h1){return[];});};return g1;},true);
